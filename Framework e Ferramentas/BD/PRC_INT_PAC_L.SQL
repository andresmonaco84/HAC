CREATE OR REPLACE PROCEDURE "PRC_INT_PAC_L"
(
  pATD_ATE_ID IN TB_ATD_ATE_ATENDIMENTO.ATD_ATE_ID%type DEFAULT NULL,
  pCAD_LAT_ID_LOCAL_ATENDIMENTO IN TB_CAD_LAT_LOCAL_ATENDIMENTO.CAD_LAT_ID_LOCAL_ATENDIMENTO%type,
  pCAD_UNI_ID_UNIDADE IN TB_CAD_UNI_UNIDADE.CAD_UNI_ID_UNIDADE%type,
  io_cursor OUT PKG_CURSOR.t_cursor
   -- , TESTE OUT LONG
)
IS
/********************************************************************
*    Procedure: PRC_INT_PAC_L
*
*    Data Criacao:    17/8/2011   Por: pedro
*
*
*    Alteracao:
*
*    Funcao: Listar os internacoes ativas
*
*******************************************************************/
v_cursor PKG_CURSOR.t_cursor;
  V_WHERE  varchar2(3000);
  V_SELECT  varchar2(30000);
begin

IF pATD_ATE_ID IS NOT NULL THEN V_WHERE:= V_WHERE || ' AND ATE.ATD_ATE_ID = ' || pATD_ATE_ID; END IF;
V_SELECT:=
'
  SELECT
       ATE.ATD_ATE_TP_PACIENTE,
       ATE.ATD_ATE_ID,
       ATE.ATD_ATE_DT_ATENDIMENTO,
       ATE.ATD_ATE_HR_ATENDIMENTO,
       ATE.CODPAD,
       ATE.ATD_ATE_FL_CARATER_SOLIC,
       ATE.ATD_ATE_DS_INDCLINICA,
       ATE.ATD_ATE_FL_INDIC_RN_OK,
       ATE.ATD_ATE_FL_RETORNO_OK,
       ATE.ATD_ATE_DS_OBSERVACAO,
       ATE.ATD_ATE_DT_ULTIMA_ATUALIZACAO,
       ATE.SEG_USU_ID_USUARIO,
       ATE.TIS_TSC_CD_TIPOSAIDACONSULTA,
       ATE.CAD_LAT_ID_LOCAL_ATENDIMENTO,
       ATE.CAD_CID_CD_CID10,
       ATE.TIS_TAT_CD_TPATENDIMENTO,
       ATE.TIS_IAC_CD_INDACIDENTE,
       ATE.CAD_UNI_ID_UNIDADE,
       ATE.TIS_CBO_CD_CBOS,
       ATE.CAD_SET_ID,
       ATE.CAD_UNI_ID_UNID_PROC,
       ATE.CODCLI,
       ATE.CAD_PRO_ID_PROF_EXEC,
       ATE.ATD_ATE_NR_CONSELHO_SOLIC,
       ATE.ATD_ATE_CD_UFCONSELHO_SOLIC,
       ATE.ATD_ATE_FL_STATUS,
       ATE.TIS_CPR_CD_CONSELHOPROF_SOLIC,
       ATE.ATD_ATE_NR_SENHA_CHAMADA,
       ATE.ATD_ATE_FL_LIBERA_EMISSAO
  FROM    TB_ATD_ATE_ATENDIMENTO    ATE
  JOIN    TB_ATD_AIC_ATE_INT_COMPL  AIC ON AIC.ATD_ATE_ID = ATE.ATD_ATE_ID
  WHERE   ATE.ATD_ATE_TP_PACIENTE = ''I''
  AND     ATE.ATD_ATE_FL_STATUS = ''A''
  AND     AIC.ATD_AIC_TP_SITUACAO_PAC  = ''I''
  AND     ATE.CAD_UNI_ID_UNIDADE = ' || pCAD_UNI_ID_UNIDADE || '
  AND     ATE.CAD_LAT_ID_LOCAL_ATENDIMENTO = ' || pCAD_LAT_ID_LOCAL_ATENDIMENTO ||
  ' ' || V_WHERE 
;
  -- TESTE :=  V_SELECT ;
   --dbms_output.put_line(V_SELECT);
  OPEN v_cursor FOR
  --  SELECT 1 FROM DUAL;
   V_SELECT ;
    io_cursor := v_cursor;
END PRC_INT_PAC_L;
 