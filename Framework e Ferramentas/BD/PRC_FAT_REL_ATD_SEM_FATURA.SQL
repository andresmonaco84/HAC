CREATE OR REPLACE PROCEDURE SGS."PRC_FAT_REL_ATD_SEM_FATURA"
(
    pATD_ATE_DT_ATENDIMENTO_INI VARCHAR2 DEFAULT NULL,
    pATD_ATE_DT_ATENDIMENTO_FIM VARCHAR2 DEFAULT NULL,
    pATD_ATE_FL_CARATER_SOLIC_U IN TB_ATD_ATE_ATENDIMENTO.ATD_ATE_FL_CARATER_SOLIC%TYPE DEFAULT NULL,
    pATD_ATE_FL_CARATER_SOLIC_E IN TB_ATD_ATE_ATENDIMENTO.ATD_ATE_FL_CARATER_SOLIC%TYPE DEFAULT NULL,
    pCAD_UNI_ID_UNIDADE IN TB_ATD_ATE_ATENDIMENTO.CAD_UNI_ID_UNIDADE%TYPE DEFAULT NULL,
    pCAD_LAT_ID_LOCAL_ATENDIMENTO IN TB_ATD_ATE_ATENDIMENTO.CAD_LAT_ID_LOCAL_ATENDIMENTO%TYPE DEFAULT NULL,
    pCAD_SET_ID IN TB_CAD_SET_SETOR.CAD_SET_ID%TYPE DEFAULT NULL,
    pATD_ATE_TP_PACIENTE IN TB_ATD_ATE_ATENDIMENTO.ATD_ATE_TP_PACIENTE%TYPE DEFAULT NULL,
    pTIS_TIN_CD_INTER IN TB_ATD_AIC_ATE_INT_COMPL.TIS_TIN_CD_INTERNACAO%TYPE DEFAULT NULL,
    pTIS_TRI_CD_TP_REGINT IN TB_ATD_AIC_ATE_INT_COMPL.TIS_TRI_CD_REGINTENNACAO%TYPE DEFAULT NULL,
    pCAD_PRD_ID IN TB_CAD_PRD_PRODUTO.CAD_PRD_ID%TYPE DEFAULT NULL,
    pTIS_CBO_CD_CBOS IN TB_TIS_CBO_CBOS.TIS_CBO_CD_CBOS%TYPE DEFAULT NULL,
    pCAD_PRO_ID_PROF_EXEC IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_ID_PROFISSIONAL%TYPE DEFAULT NULL,
    pCAD_CNV_ID_CONVENIO     IN TB_CAD_CNV_CONVENIO.CAD_CNV_ID_CONVENIO%TYPE DEFAULT NULL,
    pCAD_PLA_ID_PLANO        IN TB_CAD_PLA_PLANO.CAD_PLA_ID_PLANO%TYPE DEFAULT NULL,
    pCAD_UNI_ID_UNID_PROC    IN TB_ATD_ATE_ATENDIMENTO.CAD_UNI_ID_UNID_PROC%TYPE DEFAULT NULL,
    pCAD_PLA_CD_TIPOPLANO_GB IN TB_CAD_PLA_PLANO.CAD_PLA_CD_TIPOPLANO%TYPE DEFAULT NULL, --ACS
    pCAD_PLA_CD_TIPOPLANO_PL IN TB_CAD_PLA_PLANO.CAD_PLA_CD_TIPOPLANO%TYPE DEFAULT NULL, --ACS
    pCAD_PLA_CD_TIPOPLANO_FU IN TB_CAD_PLA_PLANO.CAD_PLA_CD_TIPOPLANO%TYPE DEFAULT NULL,
    pCAD_PLA_CD_TIPOPLANO_NP IN TB_CAD_PLA_PLANO.CAD_PLA_CD_TIPOPLANO%TYPE DEFAULT NULL,
    pCAD_PLA_CD_TIPOPLANO_PA IN TB_CAD_PLA_PLANO.CAD_PLA_CD_TIPOPLANO%TYPE DEFAULT NULL,
    pCAD_PLA_CD_TIPOPLANO_SP IN TB_CAD_PLA_PLANO.CAD_PLA_CD_TIPOPLANO%TYPE DEFAULT NULL,
    pATD_ATE_TP_PACIENTE_I IN TB_ATD_ATE_ATENDIMENTO.ATD_ATE_TP_PACIENTE%TYPE DEFAULT NULL,
    pATD_ATE_TP_PACIENTE_E IN TB_ATD_ATE_ATENDIMENTO.ATD_ATE_TP_PACIENTE%TYPE DEFAULT NULL,
    pATD_ATE_TP_PACIENTE_A IN TB_ATD_ATE_ATENDIMENTO.ATD_ATE_TP_PACIENTE%TYPE DEFAULT NULL,
    pATD_ATE_TP_PACIENTE_U IN TB_ATD_ATE_ATENDIMENTO.ATD_ATE_TP_PACIENTE%TYPE DEFAULT NULL,
    pFAT_CCP_MES_FAT IN TB_FAT_CCP_CONTA_CONS_PARC.FAT_CCP_MES_FAT%TYPE DEFAULT NULL,
    pFAT_CCP_ANO_FAT IN TB_FAT_CCP_CONTA_CONS_PARC.FAT_CCP_ANO_FAT%TYPE DEFAULT NULL,
    pFATURADO   VARCHAR2 DEFAULT NULL,
   -- pLOTEGERADO VARCHAR2 DEFAULT NULL,
    pAUDITORIA  VARCHAR2 DEFAULT NULL,
    pEMITIDO    VARCHAR2 DEFAULT NULL,
    pDIGITADO   VARCHAR2 DEFAULT NULL,
    pALTA   VARCHAR2 DEFAULT NULL,
    pTIS_TAT_CD_TPATENDIMENTO IN TB_ATD_ATE_ATENDIMENTO.TIS_TAT_CD_TPATENDIMENTO%TYPE DEFAULT NULL,
    pATD_ATE_FL_LIBERA_EMISSAO VARCHAR2 DEFAULT NULL,
    IO_CURSOR OUT PKG_CURSOR.T_CURSOR
    --, TESTE OUT LONG
)
IS
/********************************************************************
*    PROCEDURE: PRC_FAT_REL_ATD_SEM_FATURA
*
*    Data Alteração: 15/05/2013 Por: Pedro
*    Alteração: Limpeza
*
******************************************************************\*/
v_cursor PKG_CURSOR.t_cursor;
  V_WHERE  varchar2(2000);
  V_WHERE_CCP  varchar2(1000);
  V_WHERE_INA  varchar2(1000);
 -- V_WHERE2  varchar2(3000);
  V_SELECT  varchar2(30000);
  begin
    V_WHERE := NULL;
    IF pCAD_UNI_ID_UNIDADE IS NOT NULL THEN V_WHERE := V_WHERE || ' AND CCI.CAD_UNI_ID_UNIDADE = ' || pCAD_UNI_ID_UNIDADE; END IF;
    IF pCAD_LAT_ID_LOCAL_ATENDIMENTO IS NOT NULL THEN V_WHERE := V_WHERE || ' AND CCI.CAD_LAT_ID_LOCAL_ATENDIMENTO = ' || pCAD_LAT_ID_LOCAL_ATENDIMENTO;   END IF;
   -- IF pCAD_SET_ID IS NOT NULL THEN V_WHERE := V_WHERE || ' AND ATE.CAD_SET_ID = ' || pCAD_SET_ID; END IF;
    IF pCAD_CNV_ID_CONVENIO IS NOT NULL THEN V_WHERE := V_WHERE || ' AND CCI.CAD_CNV_ID_CONVENIO = ' || pCAD_CNV_ID_CONVENIO; END IF;
   -- IF pCAD_PLA_ID_PLANO IS NOT NULL THEN V_WHERE := V_WHERE || ' AND PAC.CAD_PLA_ID_PLANO = ' || pCAD_PLA_ID_PLANO; END IF;
    IF pFAT_CCP_MES_FAT IS NOT NULL THEN V_WHERE := V_WHERE || ' AND CCI.FAT_CCI_MES_FECHAMENTO = ' || pFAT_CCP_MES_FAT; END IF;
    IF pFAT_CCP_ANO_FAT IS NOT NULL THEN V_WHERE := V_WHERE || ' AND CCI.FAT_CCI_ANO_FECHAMENTO = ' || pFAT_CCP_ANO_FAT; END IF;
 --   IF pTIS_CBO_CD_CBOS IS NOT NULL THEN V_WHERE := V_WHERE || ' AND ATE.TIS_CBO_CD_CBOS = ' ||CHR(39)|| pTIS_CBO_CD_CBOS ||CHR(39); END IF;
   -- IF pCAD_PRO_ID_PROF_EXEC IS NOT NULL THEN  V_WHERE := V_WHERE || ' AND ATE.CAD_PRO_ID_PROF_EXEC = ' || pCAD_PRO_ID_PROF_EXEC;  END IF;
  --  IF pCAD_PRD_ID IS NOT NULL THEN  V_WHERE := V_WHERE || ' AND CCI.CAD_PRD_ID = ' || pCAD_PRD_ID; END IF;
    IF pATD_ATE_DT_ATENDIMENTO_INI IS NOT NULL THEN V_WHERE := V_WHERE || ' AND   TRUNC(CCI.FAT_CCI_DT_INICIO_CONSUMO) >= ' ||CHR(39)|| pATD_ATE_DT_ATENDIMENTO_INI ||CHR(39);    END IF;
    IF pATD_ATE_DT_ATENDIMENTO_FIM IS NOT NULL THEN V_WHERE := V_WHERE || ' AND TRUNC(CCI.FAT_CCI_DT_INICIO_CONSUMO) <= ' ||CHR(39)|| pATD_ATE_DT_ATENDIMENTO_FIM ||CHR(39);    END IF;
    

    
    IF pATD_ATE_FL_LIBERA_EMISSAO IS NOT NULL THEN V_WHERE := V_WHERE || ' AND ATE.ATD_ATE_FL_LIBERA_EMISSAO = ''' || pATD_ATE_FL_LIBERA_EMISSAO || ''''; END IF;
    
   -- IF pTIS_TIN_CD_INTER IS NOT NULL THEN V_WHERE := V_WHERE || ' AND TIN.TIS_TIN_CD_INTERNACAO = ' ||CHR(39)|| pTIS_TIN_CD_INTER ||CHR(39);    END IF;
  --  IF pTIS_TRI_CD_TP_REGINT IS NOT NULL THEN V_WHERE := V_WHERE || ' AND TRI.TIS_TRI_CD_TP_REGINTERNACAO = ' ||CHR(39)|| pTIS_TRI_CD_TP_REGINT ||CHR(39);    END IF;
   -- IF pCAD_UNI_ID_UNID_PROC IS NOT NULL THEN V_WHERE := V_WHERE || ' AND ATE.CAD_UNI_ID_UNID_PROC = ' || pCAD_UNI_ID_UNID_PROC; END IF;
  --  IF pTIS_TAT_CD_TPATENDIMENTO IS NOT NULL THEN V_WHERE := V_WHERE || ' AND ATE.TIS_TAT_CD_TPATENDIMENTO = ' ||CHR(39)|| pTIS_TAT_CD_TPATENDIMENTO ||CHR(39);    END IF;
  V_WHERE_CCP := NULL;
   IF pATD_ATE_DT_ATENDIMENTO_INI IS NOT NULL THEN V_WHERE_CCP := V_WHERE_CCP || ' AND TRUNC(CCP.FAT_CCP_DT_PARCELA) >= ' ||CHR(39)|| pATD_ATE_DT_ATENDIMENTO_INI ||CHR(39);    END IF;
   IF pATD_ATE_DT_ATENDIMENTO_FIM IS NOT NULL THEN V_WHERE_CCP := V_WHERE_CCP || ' AND TRUNC(CCP.FAT_CCP_DT_PARCELA) <= ' ||CHR(39)|| pATD_ATE_DT_ATENDIMENTO_FIM ||CHR(39);    END IF;
   IF pFAT_CCP_MES_FAT IS NOT NULL THEN V_WHERE_CCP := V_WHERE_CCP || ' AND CCP.FAT_CCP_MES_FAT = ' || pFAT_CCP_MES_FAT; END IF;
   IF pFAT_CCP_ANO_FAT IS NOT NULL THEN V_WHERE_CCP := V_WHERE_CCP || ' AND CCP.FAT_CCP_ANO_FAT = ' || pFAT_CCP_ANO_FAT; END IF;
 --
  V_WHERE_INA := NULL;
   IF pATD_ATE_DT_ATENDIMENTO_INI IS NOT NULL THEN V_WHERE_INA := V_WHERE_INA || ' AND TRUNC(INA.ATD_INA_DT_ALTA_ADM) >= ' ||CHR(39)|| pATD_ATE_DT_ATENDIMENTO_INI ||CHR(39);    END IF;
   IF pATD_ATE_DT_ATENDIMENTO_FIM IS NOT NULL THEN V_WHERE_INA := V_WHERE_INA || ' AND TRUNC(INA.ATD_INA_DT_ALTA_ADM) <= ' ||CHR(39)|| pATD_ATE_DT_ATENDIMENTO_FIM ||CHR(39);    END IF;
   V_SELECT :='
    SELECT
            DECODE(ATE.ATD_ATE_TP_PACIENTE,' ||chr(39)|| 'A' ||chr(39)|| ',' ||chr(39)|| 'AMBULATORIO' ||chr(39)|| ',' || chr(39) || 'U' || chr(39) || ',' || chr(39) || 'URGENCIA' || chr(39) || ',' || chr(39) || 'I' || chr(39) || ',' || chr(39) || 'INTERNADO' || chr(39) || ',' || chr(39) || 'E' || chr(39) || ',' || chr(39) || 'EXTERNO' || chr(39) || ') TP_PACIENTE,
            CCI.ATD_ATE_TP_PACIENTE,
            CNV.CAD_CNV_CD_HAC_PRESTADOR,
            CNV.CAD_CNV_NM_FANTASIA,
            PLA.CAD_PLA_CD_PLANO_HAC,
            PLA.CAD_PLA_NM_NOME_PLANO,
            UNI.CAD_UNI_DS_UNIDADE,
            UNI.CAD_UNI_CD_UNID_HOSPITALAR,
            LAT.CAD_LAT_DS_LOCAL_ATENDIMENTO,
            PAC.CAD_PAC_NR_PRONTUARIO,
            CCI.ATD_ATE_ID,
            PES.CAD_PES_NM_PESSOA,
            PES.CAD_PES_DT_NASCIMENTO ,
            PES.CAD_PES_TP_SEXO,
            ATE.ATD_ATE_DT_ATENDIMENTO ,
            CASE WHEN CCI.ATD_ATE_TP_PACIENTE != ' ||chr(39)|| 'I' ||chr(39)|| ' THEN  ATE.ATD_ATE_DT_ATENDIMENTO
                 ELSE NVL(CCP.FAT_CCP_DT_PARCELA,INA.ATD_INA_DT_ALTA_ADM)
            END DT_ALTA,
            CCP.FAT_CCP_ID,
            CCP.FAT_CCP_VL_TOT_CONTA,
            nvl(CCP.FAT_CCP_MES_FAT,cci.fat_cci_mes_fechamento) FAT_CCP_MES_FAT,
            nvl(CCP.FAT_CCP_ANO_FAT,cci.fat_cci_ANO_fechamento) FAT_CCP_ANO_FAT,
            --TCO.FAT_TCO_DS_COMANDA,
            --setor.cad_set_ds_setor,
            --PRD.CAD_PRD_DS_DESCRICAO,
            NVL(CCP.FAT_CCP_VL_TOT_CONTA,SUM(CCI.FAT_CCI_VL_FATURADO)) FAT_CCI_VL_FATURADO
   FROM      TB_FAT_CCI_CONTA_CONSU_ITEM CCI
   LEFT JOIN TB_FAT_CCP_CONTA_CONS_PARC  CCP
   ON        CCP.FAT_CCP_ID          = CCI.FAT_CCP_ID
   AND       CCP.ATD_ATE_ID          = CCI.ATD_ATE_ID
   AND       CCP.CAD_PAC_ID_PACIENTE = CCI.CAD_PAC_ID_PACIENTE
   AND       CCP.FAT_COC_ID          = CCI.FAT_COC_ID
   ' || V_WHERE_CCP || '
   AND       (CCP.FAT_CCP_FL_STATUS   = '||chr(39)||'A'||chr(39)||')
   AND       (CCP.FAT_NOF_ID IS NULL)
    JOIN      TB_ATD_ATE_ATENDIMENTO      ATE   ON      ATE.ATD_ATE_ID                = CCI.ATD_ATE_ID
    JOIN      TB_CAD_PAC_PACIENTE         PAC   ON      PAC.CAD_PAC_ID_PACIENTE       = CCI.CAD_PAC_ID_PACIENTE
    JOIN      TB_CAD_PLA_PLANO            PLA   ON      PLA.CAD_PLA_ID_PLANO          = PAC.CAD_PLA_ID_PLANO
    JOIN      TB_CAD_CNV_CONVENIO         CNV   ON      CCI.CAD_CNV_ID_CONVENIO       = CNV.CAD_CNV_ID_CONVENIO
    JOIN      TB_CAD_PES_PESSOA           PES   ON      PAC.CAD_PES_ID_PESSOA         = PES.CAD_PES_ID_PESSOA
    JOIN      TB_CAD_UNI_UNIDADE          UNI   ON      UNI.CAD_UNI_ID_UNIDADE        = CCI.CAD_UNI_ID_UNIDADE
    JOIN      TB_CAD_LAT_LOCAL_ATENDIMENTO LAT  ON      LAT.CAD_LAT_ID_LOCAL_ATENDIMENTO = CCI.CAD_LAT_ID_LOCAL_ATENDIMENTO
    LEFT JOIN TB_ATD_INA_INT_ALTA         INA   ON      INA.ATD_ATE_ID                = CCI.ATD_ATE_ID
    ' || V_WHERE_INA || '
   -- LEFT JOIN TB_ATD_AIC_ATE_INT_COMPL    AIC   ON      AIC.ATD_ATE_ID                = CCI.ATD_ATE_ID
   -- JOIN TB_CAD_PRD_PRODUTO          PRD        ON      PRD.CAD_PRD_ID                = CCI.CAD_PRD_ID
   -- JOIN TB_FAT_MCC_MOV_COM_CONSUMO  MCC        ON      MCC.FAT_MCC_ID                = CCI.FAT_MCC_ID
   -- JOIN tb_fat_tco_tipo_comanda     TCO        ON      TCO.FAT_TCO_ID                = MCC.FAT_TCO_ID
  --  JOIN tb_cad_set_setor          setor        on      setor.cad_set_id              = mcc.cad_set_id
 WHERE  (ATE.ATD_ATE_FL_STATUS = ' ||chr(39)|| 'A' ||chr(39)|| ')
   AND    (CCI.FAT_CCI_FL_STATUS = ' ||chr(39)|| 'A' ||chr(39)|| ')
   AND    (CCI.FAT_CCI_TP_DESTINO_ITEM NOT IN  (' ||chr(39)|| 'H' ||chr(39)|| ','||chr(39)|| 'T' ||chr(39)|| '))
   AND     (CCI.FAT_CCI_FL_PACOTE = '||chr(39)||'N'||chr(39)||' OR CCI.FAT_CCI_FL_PACOTE IS NULL)
   AND    (UNI.CAD_UNI_FL_FATURA_UNID_OK = '||chr(39)||'S'||chr(39)||')
   ' || V_WHERE || '
   and    (' ||chr(39)|| pALTA  ||chr(39)|| ' IS NOT NULL AND (((CCP.FAT_CCP_DT_PARCELA is not null)  OR (INA.ATD_INA_DT_ALTA_ADM is not null)) AND CCI.ATD_ATE_TP_PACIENTE IN ('||chr(39)||'I'||chr(39)||'))
    OR    (' ||chr(39)|| pALTA  ||chr(39)|| ' IS NULL))
 AND    (' ||chr(39)|| pATD_ATE_TP_PACIENTE_I ||chr(39)|| ' IS NOT NULL AND CCI.ATD_ATE_TP_PACIENTE = ' ||chr(39)|| 'I' ||chr(39)|| '
        OR ' ||chr(39)|| pATD_ATE_TP_PACIENTE_E ||chr(39)|| ' IS NOT NULL AND CCI.ATD_ATE_TP_PACIENTE = ' ||chr(39)|| 'E' ||chr(39)|| '
        OR ' ||chr(39)|| pATD_ATE_TP_PACIENTE_A ||chr(39)|| ' IS NOT NULL AND CCI.ATD_ATE_TP_PACIENTE = ' ||chr(39)|| 'A' ||chr(39)|| '
        OR ' ||chr(39)|| pATD_ATE_TP_PACIENTE_U ||chr(39)|| ' IS NOT NULL AND CCI.ATD_ATE_TP_PACIENTE = ' ||chr(39)|| 'U' ||chr(39)|| ')
  AND    (' ||chr(39)|| pCAD_PLA_CD_TIPOPLANO_GB ||chr(39)|| ' IS not NULL and CNV.CAD_TPE_CD_CODIGO = '||chr(39)||'ACS'||chr(39)||'
       OR ' ||chr(39)|| pCAD_PLA_CD_TIPOPLANO_PA ||chr(39)|| ' IS NOT NULL AND CNV.CAD_TPE_CD_CODIGO = '||chr(39)||'PA'||chr(39)||'
       OR ' ||chr(39)|| pCAD_PLA_CD_TIPOPLANO_SP ||chr(39)|| ' IS NOT NULL AND CNV.CAD_TPE_CD_CODIGO = '||chr(39)||'SP'||chr(39)||'
       OR ' ||chr(39)|| pCAD_PLA_CD_TIPOPLANO_NP ||chr(39)|| ' IS NOT NULL AND CNV.CAD_TPE_CD_CODIGO = '||chr(39)||'NP'||chr(39)||'
       OR ' ||chr(39)|| pCAD_PLA_CD_TIPOPLANO_FU ||chr(39)|| ' IS NOT NULL AND CNV.CAD_TPE_CD_CODIGO = '||chr(39)||'FU'||chr(39)||')
   AND     ( (' ||chr(39)|| pAUDITORIA ||chr(39)|| ' IS NOT NULL AND CCP.FAT_CCP_FL_STATUS_AUDIT = ' ||chr(39)|| 'E' ||chr(39)|| ')
  OR  (' ||chr(39)|| pEMITIDO ||chr(39)|| ' IS NOT NULL AND CCP.FAT_CCP_FL_EMITIDA = ' ||chr(39)|| 'S' ||chr(39)|| ' AND CCP.FAT_CCP_FL_FATURADA = ' ||chr(39)|| 'N' ||chr(39)|| '
          AND (CCP.FAT_CCP_FL_STATUS_AUDIT = ' ||chr(39)|| 'A' ||chr(39)|| ' OR CCP.FAT_CCP_DT_ENVIO_AUDIT IS NULL))
      OR  (' ||chr(39)|| pDIGITADO ||chr(39)|| ' IS NOT NULL AND CCI.FAT_CCP_ID IS NULL))
    GROUP BY
            DECODE(ATE.ATD_ATE_TP_PACIENTE,' ||chr(39)|| 'A' ||chr(39)|| ',' ||chr(39)|| 'AMBULATORIO' ||chr(39)|| ',' || chr(39) || 'U' || chr(39) || ',' || chr(39) || 'URGENCIA' || chr(39) || ',' || chr(39) || 'I' || chr(39) || ',' || chr(39) || 'INTERNADO' || chr(39) || ',' || chr(39) || 'E' || chr(39) || ',' || chr(39) || 'EXTERNO' || chr(39) || ') ,
            CCI.ATD_ATE_TP_PACIENTE,
            CNV.CAD_CNV_CD_HAC_PRESTADOR,
            CNV.CAD_CNV_NM_FANTASIA,
            PLA.CAD_PLA_CD_PLANO_HAC,
            PLA.CAD_PLA_NM_NOME_PLANO,
            UNI.CAD_UNI_DS_UNIDADE,
            UNI.CAD_UNI_CD_UNID_HOSPITALAR,
            LAT.CAD_LAT_DS_LOCAL_ATENDIMENTO,
            PAC.CAD_PAC_NR_PRONTUARIO,
            CCI.ATD_ATE_ID,
            PES.CAD_PES_NM_PESSOA,
            PES.CAD_PES_DT_NASCIMENTO ,
            PES.CAD_PES_TP_SEXO,
            ATE.ATD_ATE_DT_ATENDIMENTO ,
            CASE WHEN CCI.ATD_ATE_TP_PACIENTE != ' ||chr(39)|| 'I' ||chr(39)|| ' THEN  ATE.ATD_ATE_DT_ATENDIMENTO
                 ELSE NVL(CCP.FAT_CCP_DT_PARCELA,INA.ATD_INA_DT_ALTA_ADM)
            END ,
            CCP.FAT_CCP_ID,
            CCP.FAT_CCP_VL_TOT_CONTA,
            nvl(CCP.FAT_CCP_MES_FAT,cci.fat_cci_mes_fechamento) ,
            nvl(CCP.FAT_CCP_ANO_FAT,cci.fat_cci_ANO_fechamento)
            --TCO.FAT_TCO_DS_COMANDA,
            --setor.cad_set_ds_setor,
            --PRD.CAD_PRD_DS_DESCRICAO,
    ORDER   BY  ATE.ATD_ATE_DT_ATENDIMENTO DESC';
  -- TESTE :=  V_SELECT ;
--  dbms_output.put_line(v_select);
  OPEN v_cursor FOR
   V_SELECT ;
  
--SELECT 1 FROM DUAL;
    io_cursor := v_cursor;
END PRC_FAT_REL_ATD_SEM_FATURA;
