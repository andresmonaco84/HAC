CREATE OR REPLACE PROCEDURE "PRC_CAD_PRO_PROFISSIONAL_I"
(pNewIdt                        OUT integer,
 pCAD_PRO_ID_PROFISSIONAL       IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_ID_PROFISSIONAL%type default NULL,
 pCAD_PRO_CD_CODCOOMED          IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_CD_CODCOOMED%type default NULL,
 pCAD_PRO_CD_COD_PRO            IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_CD_COD_PRO%type,
 pCAD_PRO_NR_CONSELHO           IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_NR_CONSELHO%type,
 pCAD_PRO_SG_UF_CONSELHO        IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_SG_UF_CONSELHO%type,
 pCAD_PRO_FL_ATIVO_OK           IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_FL_ATIVO_OK%type,
 pCAD_PRO_NM_APELIDO            IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_NM_APELIDO%type default NULL,
 pCAD_PRO_DS_BIP_PAGER          IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_DS_BIP_PAGER%type default NULL,
 pCAD_PRO_FL_IMPR_RECIBO_OK     IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_FL_IMPR_RECIBO_OK%type,
 pCAD_PRO_FL_STAFF_OK           IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_FL_STAFF_OK%type default NULL,
 pCAD_PRO_CD_BANCO              IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_CD_BANCO%type default NULL,
 pCAD_PRO_CD_AGENCIA            IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_CD_AGENCIA%type default NULL,
 pCAD_PRO_CD_CONTA              IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_CD_CONTA%type default NULL,
 pCAD_PRO_FL_PERM_INTERN_OK     IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_FL_PERM_INTERN_OK%type,
 pCAD_PRO_FL_PERM_ASS_LAUDO_OK  IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_FL_PERM_ASS_LAUDO_OK%type,
 pCAD_PRO_CD_MATRICULA          IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_CD_MATRICULA%type default NULL,
 pSEG_USU_ID_USUARIO            IN TB_CAD_PRO_PROFISSIONAL.SEG_USU_ID_USUARIO%type,
 pCAD_PES_ID_PESSOA             IN TB_CAD_PRO_PROFISSIONAL.CAD_PES_ID_PESSOA%type,
 pTIS_CPR_CD_CONSELHOPROF       IN TB_CAD_PRO_PROFISSIONAL.TIS_CPR_CD_CONSELHOPROF%type,
 pCAD_PRO_FL_RESIDENTE_OK       IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_FL_RESIDENTE_OK%type default NULL,
 pCAD_PRO_NR_ANO_INI_RESIDENCIA IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_NR_ANO_INI_RESIDENCIA%TYPE default NULL,
 pCAD_PRO_DT_INI_RESIDENCIA     IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_DT_INI_RESIDENCIA%type default NULL,
 pCAD_PRO_DT_FIM_RESIDENCIA     IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_DT_FIM_RESIDENCIA%type default NULL,
 pCAD_PRO_FL_PERM_EXAME_OK      IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_FL_PERM_EXAME_OK%TYPE DEFAULT NULL,
 pCAD_PRO_NM_NOME               IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_NM_NOME%TYPE DEFAULT NULL,
 pCAD_PRO_NM_SOCIEDADE_MEDICA   IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_NM_SOCIEDADE_MEDICA%type default NULL,
 pCAD_PRO_NM_HOSP_INTERNATO     IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_NM_HOSP_INTERNATO%type default NULL,
 pCAD_PRO_NR_ANO_INTERNATO      IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_NR_ANO_INTERNATO%type default NULL,
 pCAD_PRO_NM_HOSP_RESIDENCIA    IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_NM_HOSP_RESIDENCIA%type default NULL,
 pCAD_PRO_NR_ANO_RESIDENCIA     IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_NR_ANO_RESIDENCIA%type default NULL,
 pCAD_PRO_FL_RECONHECIDA_MEC    IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_FL_RECONHECIDA_MEC%type default NULL,
 pCAD_PRO_NM_ENTIDADE_CRED      IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_NM_ENTIDADE_CRED%type default NULL,
 pCAD_PRO_NM_CARGO_ENSINO       IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_NM_CARGO_ENSINO%type default NULL,
 pCAD_PRO_DS_TRAB_PUBLICADO     IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_DS_TRAB_PUBLICADO%type default NULL,
 pCAD_PRO_NM_MED_REFERENCIA     IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_NM_MED_REFERENCIA%type default NULL,
 pCAD_PRO_DT_SOLICITACAO        IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_DT_SOLICITACAO%type default NULL,
 pCAD_PRO_DT_CADASTRO           IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_DT_CADASTRO%type default NULL,
 pCAD_PRO_DT_APROVACAO          IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_DT_APROVACAO%type default NULL,
 pCAD_PRO_NM_RESPONS_APROV      IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_NM_RESPONS_APROV%type default NULL,
 pCAD_PRO_DT_INGR_CORPO_CLIN    IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_DT_INGR_CORPO_CLIN%type default NULL,
 pCAD_PRO_FL_CRED_DIRETO_CONV   IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_FL_CRED_DIRETO_CONV%type default NULL,
 pCAD_PRO_FL_TIPO_VINCULO       IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_FL_TIPO_VINCULO%type default NULL,
 pCAD_PRO_FL_STATUS_SOLIC       IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_FL_STATUS_SOLIC%type default NULL,
 pCAD_PRO_DS_OBSERVACAO         IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_DS_OBSERVACAO%type default NULL,
 pCAD_PRO_DT_INATIVACAO         IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_DT_INATIVACAO%type default NULL) is
  /********************************************************************
  *    Procedure: PRC_CAD_PRO_PROFISSIONAL_I
  *
  *    Data Criacao:    20/06/2007            Por: Carlos Araujo
  *    Data Alteracao:  20/04/2010            Por: Cristiane Gomes
  *    Data Alteracao:  19/07/2010            Por: André Souza Monaco
  *    Data Alteracao:  11/04/2012            Por: André Souza Monaco
  *         Alteracao:  Inclusão do campo CAD_PRO_DT_INATIVACAO
  *    Data Alteracao:  10/06/2014            Por: Andréa Cazuca
  *         Alteracao:  Retirada da inclusão nas tabelas TB_MEDICO_CFM e TB_CREMESP 
  *                     e inclusão do profissional da tabela TB_CAD_PSO_PROF_SOLICITANTE
  *
  *    Funcao: Inclui Profissional
  *
  *    Alteração: 1) Inclusão de upper em parametros
  *               2) Inclusão de pCAD_PRO_FL_PERM_EXAME_OK
  *               3) Incluir profissional na tabela TB_MEDICO_CFM (LEGADO)
  *               4) Somente incluir na tabela TB_MEDICO_CFM se for
  *               profissional CRM
  *               5) Incluir nas tabelas TB_CREMESP e MEDICO (legado)
  *               6) Inclusão do campo CAD_PRO_NM_NOME
  *               7) Adição de diversos campos na TB_CAD_PRO_PROFISSIONAL
  *
  *******************************************************************/
  lIdtRetorno           integer;
  vCAD_PES_NM_PESSOA    VARCHAR2(100);
  vCODSITMED            CHAR(1);
  vCAD_PES_TP_SEXO      CHAR(1);
  vCAD_PRO_CD_CODCOOMED number;
begin
  SELECT SEQ_CAD_PRO_01.NextVal INTO lIdtRetorno FROM DUAL;
  INSERT INTO TB_CAD_PRO_PROFISSIONAL
    (CAD_PRO_ID_PROFISSIONAL,
     CAD_PRO_CD_CODCOOMED,
     CAD_PRO_CD_COD_PRO,
     CAD_PRO_NR_CONSELHO,
     CAD_PRO_SG_UF_CONSELHO,
     CAD_PRO_FL_ATIVO_OK,
     CAD_PRO_NM_APELIDO,
     CAD_PRO_DS_BIP_PAGER,
     CAD_PRO_FL_IMPR_RECIBO_OK,
     CAD_PRO_FL_STAFF_OK,
     CAD_PRO_CD_BANCO,
     CAD_PRO_CD_AGENCIA,
     CAD_PRO_CD_CONTA,
     CAD_PRO_FL_PERM_INTERN_OK,
     CAD_PRO_FL_PERM_ASS_LAUDO_OK,
     CAD_PRO_CD_MATRICULA,
     CAD_PRO_DT_ULTIMA_ATUALIZACAO,
     SEG_USU_ID_USUARIO,
     CAD_PES_ID_PESSOA,
     TIS_CPR_CD_CONSELHOPROF,
     CAD_PRO_FL_RESIDENTE_OK,
     CAD_PRO_NR_ANO_INI_RESIDENCIA,
     CAD_PRO_DT_INI_RESIDENCIA,
     CAD_PRO_DT_FIM_RESIDENCIA,
     CAD_PRO_FL_PERM_EXAME_OK,
     CAD_PRO_NM_NOME,
     CAD_PRO_NM_SOCIEDADE_MEDICA,
     CAD_PRO_NM_HOSP_INTERNATO,
     CAD_PRO_NR_ANO_INTERNATO,
     CAD_PRO_NM_HOSP_RESIDENCIA,
     CAD_PRO_NR_ANO_RESIDENCIA,
     CAD_PRO_FL_RECONHECIDA_MEC,
     CAD_PRO_NM_ENTIDADE_CRED,
     CAD_PRO_NM_CARGO_ENSINO,
     CAD_PRO_DS_TRAB_PUBLICADO,
     CAD_PRO_NM_MED_REFERENCIA,
     CAD_PRO_DT_SOLICITACAO,
     CAD_PRO_DT_CADASTRO,
     CAD_PRO_DT_APROVACAO,
     CAD_PRO_NM_RESPONS_APROV,
     CAD_PRO_DT_INGR_CORPO_CLIN,
     CAD_PRO_FL_CRED_DIRETO_CONV,
     CAD_PRO_FL_TIPO_VINCULO,
     CAD_PRO_FL_STATUS_SOLIC,
     CAD_PRO_DS_OBSERVACAO,
     CAD_PRO_DT_INATIVACAO)
  VALUES
    (lIdtRetorno,
     pCAD_PRO_CD_CODCOOMED,
     pCAD_PRO_NR_CONSELHO,
     pCAD_PRO_NR_CONSELHO,
     upper(pCAD_PRO_SG_UF_CONSELHO),
     pCAD_PRO_FL_ATIVO_OK,
     pCAD_PRO_NM_APELIDO,
     pCAD_PRO_DS_BIP_PAGER,
     pCAD_PRO_FL_IMPR_RECIBO_OK,
     pCAD_PRO_FL_STAFF_OK,
     pCAD_PRO_CD_BANCO,
     pCAD_PRO_CD_AGENCIA,
     pCAD_PRO_CD_CONTA,
     pCAD_PRO_FL_PERM_INTERN_OK,
     pCAD_PRO_FL_PERM_ASS_LAUDO_OK,
     pCAD_PRO_CD_MATRICULA,
     sysdate(),
     pSEG_USU_ID_USUARIO,
     pCAD_PES_ID_PESSOA,
     pTIS_CPR_CD_CONSELHOPROF,
     pCAD_PRO_FL_RESIDENTE_OK,
     pCAD_PRO_NR_ANO_INI_RESIDENCIA,
     pCAD_PRO_DT_INI_RESIDENCIA,
     pCAD_PRO_DT_FIM_RESIDENCIA,
     pCAD_PRO_FL_PERM_EXAME_OK,
     pCAD_PRO_NM_NOME,
      pCAD_PRO_NM_SOCIEDADE_MEDICA,
      pCAD_PRO_NM_HOSP_INTERNATO,
      pCAD_PRO_NR_ANO_INTERNATO,
      pCAD_PRO_NM_HOSP_RESIDENCIA,
      pCAD_PRO_NR_ANO_RESIDENCIA,
      pCAD_PRO_FL_RECONHECIDA_MEC,
      pCAD_PRO_NM_ENTIDADE_CRED,
      pCAD_PRO_NM_CARGO_ENSINO,
      pCAD_PRO_DS_TRAB_PUBLICADO,
      pCAD_PRO_NM_MED_REFERENCIA,
      pCAD_PRO_DT_SOLICITACAO,
      pCAD_PRO_DT_CADASTRO,
      pCAD_PRO_DT_APROVACAO,
      pCAD_PRO_NM_RESPONS_APROV,
      pCAD_PRO_DT_INGR_CORPO_CLIN,
      pCAD_PRO_FL_CRED_DIRETO_CONV,
      pCAD_PRO_FL_TIPO_VINCULO,
      pCAD_PRO_FL_STATUS_SOLIC,
      pCAD_PRO_DS_OBSERVACAO,
      pCAD_PRO_DT_INATIVACAO);
  pNewIdt := lIdtRetorno;
  IF pTIS_CPR_CD_CONSELHOPROF = 'CRM' THEN
    SELECT PES.CAD_PES_NM_PESSOA, PES.CAD_PES_TP_SEXO
      INTO vCAD_PES_NM_PESSOA, vCAD_PES_TP_SEXO
      FROM TB_CAD_PES_PESSOA PES
     WHERE PES.CAD_PES_ID_PESSOA = pCAD_PES_ID_PESSOA;
    IF pCAD_PRO_FL_ATIVO_OK = 'S' THEN
      vCODSITMED := 'A';
    ELSE
      vCODSITMED := 'N';
    END IF;
    /*BEGIN
      INSERT INTO TB_MEDICO_CFM
        (CODMED, UF, NOMMED, CODSITMED)
      VALUES
        (pCAD_PRO_NR_CONSELHO,
         upper(pCAD_PRO_SG_UF_CONSELHO),
         SUBSTR(vCAD_PES_NM_PESSOA, 1, 50),
         vCODSITMED);
    EXCEPTION
      WHEN DUP_VAL_ON_INDEX THEN
        NULL;
    END;
    IF pCAD_PRO_SG_UF_CONSELHO = 'SP' THEN
      BEGIN
        INSERT INTO HOSPITAL.TB_CREMESP C
          (codigo, nome, status, UF)
        VALUES
          (pCAD_PRO_NR_CONSELHO,
           SUBSTR(vCAD_PES_NM_PESSOA, 1, 50),
           vCODSITMED,
           upper(pCAD_PRO_SG_UF_CONSELHO));
      EXCEPTION
        WHEN DUP_VAL_ON_INDEX THEN
          NULL;
      END;
    END IF;*/
    IF pCAD_PRO_CD_CODCOOMED NOT IN (1, 2, 3, 4, 5, 6, 7, 8, 9) or
       pCAD_PRO_CD_CODCOOMED is null THEN
      vCAD_PRO_CD_CODCOOMED := 1;
    ELSE
      vCAD_PRO_CD_CODCOOMED := pCAD_PRO_CD_CODCOOMED;
    END IF;
    BEGIN
      INSERT INTO HOSPITAL.MEDICO
        (codmed, codcoomed, nommed, sexmed, codsitmed)
      VALUES
        (pCAD_PRO_NR_CONSELHO,
         vCAD_PRO_CD_CODCOOMED,
         SUBSTR(vCAD_PES_NM_PESSOA, 1, 30),
         vCAD_PES_TP_SEXO,
         vCODSITMED);
    EXCEPTION
      WHEN DUP_VAL_ON_INDEX THEN
        NULL;
    END;
  END IF;
  BEGIN
      INSERT INTO TB_CAD_PSO_PROF_SOLICITANTE
         (TIS_CPR_CD_CONSELHOPROF, CAD_PSO_CD_CONSELHO, CAD_PSO_SG_UF_CONSELHO, 
          CAD_PSO_FL_ATIVO_OK, CAD_PSO_NM_PROFISSIONAL, CAD_PSO_DT_ULTIMA_ATUALIZACAO, SEG_USU_ID_USUARIO)
      VALUES
          (pTIS_CPR_CD_CONSELHOPROF, pTIS_CPR_CD_CONSELHOPROF, pCAD_PRO_SG_UF_CONSELHO,
           pCAD_PRO_FL_ATIVO_OK, pCAD_PRO_NM_NOME, SYSDATE, pSEG_USU_ID_USUARIO );
    EXCEPTION
      WHEN DUP_VAL_ON_INDEX THEN
        NULL;
  END;
end PRC_CAD_PRO_PROFISSIONAL_I;