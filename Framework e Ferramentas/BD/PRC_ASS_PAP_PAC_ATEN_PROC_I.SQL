CREATE OR REPLACE PROCEDURE PRC_ASS_PAP_PAC_ATEN_PROC_I(pNewIdt                        OUT integer,
                                                        pAte                           OUT integer,
                                                        pATD_ATE_ID                    IN TB_ASS_PAP_PAC_ATEN_PROC.ATD_ATE_ID%type default NULL,
                                                        pCAD_PRD_ID                    IN TB_ASS_PAP_PAC_ATEN_PROC.CAD_PRD_ID%type default NULL,
                                                        pCAD_PAC_ID_PACIENTE           IN TB_ASS_PAP_PAC_ATEN_PROC.CAD_PAC_ID_PACIENTE%type,
                                                        pASS_PAP_QT_SOLIC              IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_QT_SOLIC%type default NULL,
                                                        pASS_PAP_DT_SOLIC              IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_DT_SOLIC%type,
                                                        pASS_PAP_FL_STATUS_SOLIC       IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_FL_STATUS_SOLIC%type default NULL,
                                                        pASS_PAP_HR_SOLIC              IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_HR_SOLIC%type,
                                                        pASS_PAP_QT_AUTOR              IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_QT_AUTOR%type default NULL,
                                                        pASS_PAP_DT_AUTOR              IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_DT_AUTOR%type default NULL,
                                                        pASS_PAP_HR_AUTOR              IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_HR_AUTOR%type default NULL,
                                                        pASS_PAP_FL_STATUS_AUTOR       IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_FL_STATUS_AUTOR%type default NULL,
                                                        pASS_PAP_QT_REALIZ             IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_QT_REALIZ%type default NULL,
                                                        pASS_PAP_DT_REALIZ             IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_DT_REALIZ%type default NULL,
                                                        pASS_PAP_HR_INI_REALIZ         IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_HR_INI_REALIZ%type default NULL,
                                                        pASS_PAP_HR_FIM_REALIZ         IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_HR_FIM_REALIZ%type default NULL,
                                                        pASS_PAP_FL_STATUS_REALIZ      IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_FL_STATUS_REALIZ%type default NULL,
                                                        pSEG_USU_ID_USUARIO            IN TB_ASS_PAP_PAC_ATEN_PROC.SEG_USU_ID_USUARIO%type,
                                                        pASS_PAP_NR_CONTA              IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_NR_CONTA%type default NULL,
                                                        pASS_PAP_FL_ORIGEM             IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_FL_ORIGEM%type,
                                                        pCAD_UNI_ID_UNIDADE            IN TB_ASS_PAP_PAC_ATEN_PROC.CAD_UNI_ID_UNIDADE%type default NULL,
                                                        pCODPAD                        IN TB_ASS_PAP_PAC_ATEN_PROC.CODPAD%type default NULL,
                                                        pATD_ATE_NR_CONSELHO_SOLIC     IN TB_ASS_PAP_PAC_ATEN_PROC.ATD_ATE_NR_CONSELHO_SOLIC%type default NULL,
                                                        pATD_ATE_CD_UFCONSELHO_SOLIC   IN TB_ASS_PAP_PAC_ATEN_PROC.ATD_ATE_CD_UFCONSELHO_SOLIC%type default NULL,
                                                        pTIS_CPR_CD_CONSELHOPROF_SOLIC IN TB_ASS_PAP_PAC_ATEN_PROC.TIS_CPR_CD_CONSELHOPROF_SOLIC%type default NULL,
                                                        pCAD_LAT_ID_LOCAL_ATENDIMENTO  IN TB_ASS_PAP_PAC_ATEN_PROC.CAD_LAT_ID_LOCAL_ATENDIMENTO%type default NULL,
                                                        pASS_PAP_NM_ATENDENTE_PLANO    IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_NM_ATENDENTE_PLANO%type default NULL,
                                                        pCAD_CLC_ID                    IN TB_ASS_PAP_PAC_ATEN_PROC.CAD_CLC_ID%type default NULL,
                                                        pASS_PAP_DS_OBSERVACAO         IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_DS_OBSERVACAO%type default NULL,
                                                        pCAD_SET_ID_SETOR_LIBERACAO    IN TB_ASS_PAP_PAC_ATEN_PROC.CAD_SET_ID_SETOR_LIBERACAO%type default NULL,
                                                        pASS_PAP_DS_RET_AUTORIZADOR    IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_DS_RET_AUTORIZADOR%TYPE DEFAULT NULL,
                                                        pASS_PAP_FL_CARATER_SOLIC      IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_FL_CARATER_SOLIC%TYPE,
                                                        pASS_PAP_FL_AUTORIZ_MANUAL_OK  IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_FL_AUTORIZ_MANUAL_OK%TYPE DEFAULT NULL,
                                                        pASS_PAP_FL_ACIDENTE_TRAB_OK   IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_FL_ACIDENTE_TRAB_OK%TYPE,
                                                        pASS_PAP_FL_SEM_GUIA_OK        IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_FL_SEM_GUIA_OK%TYPE,
                                                        pTIS_CBO_CD_CBOS_SOLIC         IN TB_ASS_PAP_PAC_ATEN_PROC.TIS_CBO_CD_CBOS_SOLIC%TYPE DEFAULT NULL,
                                                        pCAD_CID_CD_CID10               IN TB_ASS_PAP_PAC_ATEN_PROC.CAD_CID_CD_CID10%TYPE DEFAULT NULL,
                                                        pASS_PAP_DS_INDCLINICA          IN TB_ASS_PAP_PAC_ATEN_PROC.ASS_PAP_DS_INDCLINICA%TYPE DEFAULT NULL,
                                                        pTIS_MGL_ID                     IN TB_ASS_PAP_PAC_ATEN_PROC.TIS_MGL_ID%TYPE DEFAULT NULL,
                                                        pTIS_STS_CD_CODIGO              IN TB_ASS_PAP_PAC_ATEN_PROC.TIS_STS_CD_CODIGO%TYPE DEFAULT NULL) is
  /********************************************************************
  *    Procedure: PRC_ASS_PAP_PAC_ATEN_PROC_I
  *
  *    Data Criacao:   22/02/2008   Por: Andréa Cazuca
  *    Funcao: Insere dados de Procedimento do Paciente
  *
  *    Data Ultima Alteracao:  11/03/2015  Por: Cristiane Gomes
  *    Alteracao: Atualizacao dos dados do solicitante no atendimento
  *
  *
  *******************************************************************/
  lIdtRetorno    integer;
  nAte           integer;
  V_EXISTE_ATEND NUMBER;
  V_ATD_ATE_ID   NUMBER;
begin
  SELECT SEQ_ASS_PAP_01.NextVal INTO lIdtRetorno FROM DUAL;
  IF pASS_PAP_FL_ORIGEM = 'L' and pATD_ATE_ID is null THEN
    SELECT SEQATEND.Nextval INTO nATE FROM DUAL;
    INSERT INTO TB_ASS_PAP_PAC_ATEN_PROC
      (ATD_ATE_ID,
       CAD_PRD_ID,
       CAD_PAC_ID_PACIENTE,
       ASS_PAP_QT_SOLIC,
       ASS_PAP_DT_SOLIC,
       ASS_PAP_FL_STATUS_SOLIC,
       ASS_PAP_HR_SOLIC,
       ASS_PAP_QT_AUTOR,
       ASS_PAP_DT_AUTOR,
       ASS_PAP_HR_AUTOR,
       ASS_PAP_FL_STATUS_AUTOR,
       ASS_PAP_QT_REALIZ,
       ASS_PAP_DT_REALIZ,
       ASS_PAP_HR_INI_REALIZ,
       ASS_PAP_HR_FIM_REALIZ,
       ASS_PAP_FL_STATUS_REALIZ,
       SEG_USU_ID_USUARIO,
       ASS_PAP_NR_CONTA,
       ASS_PAP_DT_ULTIMA_ATUALIZACAO,
       ASS_PAP_ID,
       ASS_PAP_FL_ORIGEM,
       CAD_UNI_ID_UNIDADE,
       CODPAD,
       ATD_ATE_NR_CONSELHO_SOLIC,
       ATD_ATE_CD_UFCONSELHO_SOLIC,
       TIS_CPR_CD_CONSELHOPROF_SOLIC,
       CAD_LAT_ID_LOCAL_ATENDIMENTO,
       ASS_PAP_NM_ATENDENTE_PLANO,
       CAD_CLC_ID,
       ASS_PAP_DS_OBSERVACAO,
       CAD_SET_ID_SETOR_LIBERACAO,
       ASS_PAP_DS_RET_AUTORIZADOR,
       ASS_PAP_FL_CARATER_SOLIC,
       ASS_PAP_FL_AUTORIZ_MANUAL_OK,
       ASS_PAP_FL_ACIDENTE_TRAB_OK,
       ASS_PAP_FL_SEM_GUIA_OK,
       TIS_CBO_CD_CBOS_SOLIC,
       CAD_CID_CD_CID10,
       ASS_PAP_DS_INDCLINICA,
       TIS_MGL_ID,
       TIS_STS_CD_CODIGO)
    VALUES
      (nAte,
       pCAD_PRD_ID,
       pCAD_PAC_ID_PACIENTE,
       pASS_PAP_QT_SOLIC,
       pASS_PAP_DT_SOLIC,
       pASS_PAP_FL_STATUS_SOLIC,
       pASS_PAP_HR_SOLIC,
       pASS_PAP_QT_AUTOR,
       pASS_PAP_DT_AUTOR,
       pASS_PAP_HR_AUTOR,
       pASS_PAP_FL_STATUS_AUTOR,
       pASS_PAP_QT_REALIZ,
       pASS_PAP_DT_REALIZ,
       pASS_PAP_HR_INI_REALIZ,
       pASS_PAP_HR_FIM_REALIZ,
       pASS_PAP_FL_STATUS_REALIZ,
       pSEG_USU_ID_USUARIO,
       pASS_PAP_NR_CONTA,
       sysdate,
       lIdtRetorno,
       pASS_PAP_FL_ORIGEM,
       pCAD_UNI_ID_UNIDADE,
       pCODPAD,
       pATD_ATE_NR_CONSELHO_SOLIC,
       pATD_ATE_CD_UFCONSELHO_SOLIC,
       pTIS_CPR_CD_CONSELHOPROF_SOLIC,
       pCAD_LAT_ID_LOCAL_ATENDIMENTO,
       pASS_PAP_NM_ATENDENTE_PLANO,
       pCAD_CLC_ID,
       pASS_PAP_DS_OBSERVACAO,
       pCAD_SET_ID_SETOR_LIBERACAO,
       pASS_PAP_DS_RET_AUTORIZADOR,
       pASS_PAP_FL_CARATER_SOLIC,
       pASS_PAP_FL_AUTORIZ_MANUAL_OK,
       pASS_PAP_FL_ACIDENTE_TRAB_OK,
       pASS_PAP_FL_SEM_GUIA_OK,
       pTIS_CBO_CD_CBOS_SOLIC,
       pCAD_CID_CD_CID10,
       pASS_PAP_DS_INDCLINICA,
       pTIS_MGL_ID,
       pTIS_STS_CD_CODIGO);
    V_ATD_ATE_ID := nAte;
  ELSE
    INSERT INTO TB_ASS_PAP_PAC_ATEN_PROC
      (ATD_ATE_ID,
       CAD_PRD_ID,
       CAD_PAC_ID_PACIENTE,
       ASS_PAP_QT_SOLIC,
       ASS_PAP_DT_SOLIC,
       ASS_PAP_FL_STATUS_SOLIC,
       ASS_PAP_HR_SOLIC,
       ASS_PAP_QT_AUTOR,
       ASS_PAP_DT_AUTOR,
       ASS_PAP_HR_AUTOR,
       ASS_PAP_FL_STATUS_AUTOR,
       ASS_PAP_QT_REALIZ,
       ASS_PAP_DT_REALIZ,
       ASS_PAP_HR_INI_REALIZ,
       ASS_PAP_HR_FIM_REALIZ,
       ASS_PAP_FL_STATUS_REALIZ,
       SEG_USU_ID_USUARIO,
       ASS_PAP_NR_CONTA,
       ASS_PAP_DT_ULTIMA_ATUALIZACAO,
       ASS_PAP_ID,
       ASS_PAP_FL_ORIGEM,
       CAD_UNI_ID_UNIDADE,
       CODPAD,
       ATD_ATE_NR_CONSELHO_SOLIC,
       ATD_ATE_CD_UFCONSELHO_SOLIC,
       TIS_CPR_CD_CONSELHOPROF_SOLIC,
       CAD_LAT_ID_LOCAL_ATENDIMENTO,
       ASS_PAP_NM_ATENDENTE_PLANO,
       CAD_CLC_ID,
       ASS_PAP_DS_OBSERVACAO,
       CAD_SET_ID_SETOR_LIBERACAO,
       ASS_PAP_FL_CARATER_SOLIC,
       ASS_PAP_FL_AUTORIZ_MANUAL_OK,
       ASS_PAP_FL_ACIDENTE_TRAB_OK,
       ASS_PAP_FL_SEM_GUIA_OK,
       TIS_CBO_CD_CBOS_SOLIC,
       CAD_CID_CD_CID10,
       ASS_PAP_DS_INDCLINICA,
       TIS_MGL_ID,
       TIS_STS_CD_CODIGO)
    VALUES
      (pATD_ATE_ID,
       pCAD_PRD_ID,
       pCAD_PAC_ID_PACIENTE,
       pASS_PAP_QT_SOLIC,
       pASS_PAP_DT_SOLIC,
       pASS_PAP_FL_STATUS_SOLIC,
       pASS_PAP_HR_SOLIC,
       pASS_PAP_QT_AUTOR,
       pASS_PAP_DT_AUTOR,
       pASS_PAP_HR_AUTOR,
       pASS_PAP_FL_STATUS_AUTOR,
       pASS_PAP_QT_REALIZ,
       pASS_PAP_DT_REALIZ,
       pASS_PAP_HR_INI_REALIZ,
       pASS_PAP_HR_FIM_REALIZ,
       pASS_PAP_FL_STATUS_REALIZ,
       pSEG_USU_ID_USUARIO,
       pASS_PAP_NR_CONTA,
       sysdate,
       lIdtRetorno,
       pASS_PAP_FL_ORIGEM,
       pCAD_UNI_ID_UNIDADE,
       pCODPAD,
       pATD_ATE_NR_CONSELHO_SOLIC,
       pATD_ATE_CD_UFCONSELHO_SOLIC,
       pTIS_CPR_CD_CONSELHOPROF_SOLIC,
       pCAD_LAT_ID_LOCAL_ATENDIMENTO,
       pASS_PAP_NM_ATENDENTE_PLANO,
       pCAD_CLC_ID,
       pASS_PAP_DS_OBSERVACAO,
       pCAD_SET_ID_SETOR_LIBERACAO,
       pASS_PAP_FL_CARATER_SOLIC,
       pASS_PAP_FL_AUTORIZ_MANUAL_OK,
       pASS_PAP_FL_ACIDENTE_TRAB_OK,
       pASS_PAP_FL_SEM_GUIA_OK,
       pTIS_CBO_CD_CBOS_SOLIC,
       pCAD_CID_CD_CID10,
       pASS_PAP_DS_INDCLINICA,
       pTIS_MGL_ID,
       pTIS_STS_CD_CODIGO);
    V_ATD_ATE_ID := pATD_ATE_ID;
  END IF;
  SELECT NVL(count(*), 0)
    INTO V_EXISTE_ATEND
    FROM TB_ATD_ATE_ATENDIMENTO ATE
   WHERE ATE.ATD_ATE_ID = V_ATD_ATE_ID;
  IF V_EXISTE_ATEND > 0 THEN
    UPDATE TB_ATD_ATE_ATENDIMENTO ATE
       SET ATE.ATD_ATE_NR_CONSELHO_SOLIC     = pATD_ATE_NR_CONSELHO_SOLIC,
           ATE.ATD_ATE_CD_UFCONSELHO_SOLIC   = pATD_ATE_CD_UFCONSELHO_SOLIC,
           ATE.TIS_CPR_CD_CONSELHOPROF_SOLIC = pTIS_CPR_CD_CONSELHOPROF_SOLIC,
           ATE.TIS_CBO_CD_CBOS_SOLIC         = pTIS_CBO_CD_CBOS_SOLIC
     WHERE ATE.ATD_ATE_ID = V_ATD_ATE_ID;
  END IF;
  pNewIdt := lIdtRetorno;
  pAte    := nAte;
end PRC_ASS_PAP_PAC_ATEN_PROC_I;