CREATE OR REPLACE PROCEDURE "PRC_FAT_REL_SPSADT_SGS_SOL_V3" (
    pATD_ATE_ID IN TSS_SPSADT_SGS_V3.NR_ATENDIMENTO%TYPE DEFAULT NULL,
    pCAD_PAC_ID_PACIENTE IN TSS_SPSADT_SGS_V3.IDT_PACIENTE%TYPE DEFAULT NULL,
    pFAT_COC_ID IN TSS_SPSADT_SGS_V3.NR_CONTA%TYPE DEFAULT NULL,
    pDT_SOLIC_MEDICAMENTO IN TSS_SPSADT_SGS_V3.Dt_Sol%TYPE DEFAULT NULL,
     IO_CURSOR OUT PKG_CURSOR.T_CURSOR
   --   ,TESTE OUT LONG
  )
  IS
  /********************************************************************
  *    PROCEDURE: PRC_FAT_REL_SPSADT_SGS_SOL_V3
  *
  *    DATA CRIACAO: 14/09/2015  POR: PEDRO
  *    ALTERAC?O:
  *
  *
  *******************************************************************/
  v_cursor PKG_CURSOR.t_cursor;
begin   
OPEN v_cursor FOR

 
SELECT 
         AAA.FAT_FCL_NR_SEQ_LOTE,      AAA.FAT_FCL_NR_SEQ_IMPRIME,
      AAA.AA_RECEITA,
      AAA.CD_CONVENIO,
      AAA.DS_CONVENIO,
      NVL(AAA.NR_ATENDIMENTO,pATD_ATE_ID) NR_ATENDIMENTO,
      AAA.DATA_VALIDADE,
      NULL CD_PARCELA,
      NVL(AAA.IDT_PACIENTE,pCAD_PAC_ID_PACIENTE) IDT_PACIENTE,
      NVL(AAA.NR_CONTA,pFAT_COC_ID)  NR_CONTA,
      AAA.CD_REGISTRO_ANS ,
      AAA.NR_GUIA_PRINCIPAL,
      AAA.DT_AUTORIZACAO,
      AAA.CD_SENHA,
      AAA.DT_VAL_SENHA,
      AAA.NR_GUIA_OPERADORA,
--DADOS DO BENEFICIARIO      
      AAA.CAD_PLA_CD_PLANO_HAC,
      AAA.NR_CARTEIRA_BENEF,
      AAA.DT_VAL_CARTEIRA_BENEF,
      AAA.NM_BENEF,
      AAA.NR_CNS_BENEF,
      AAA.ID_ATENDIMENTO_RN, 
--DADOS DO SOLICITANTE
      AAA.CD_OPER_CNPJ_CPF_SOL,
      AAA.NM_CONT_SOL,      
      AAA.NM_PROF_SOL,      
      AAA.CONS_PROF_SOL,
      AAA.NR_CONS_PROF_SOL,
      AAA.SG_UF_PROF_SOL ,
      AAA.CD_ESPEC_SOL,
      AAA.ASSINATURA_SOL,
--DADOS DA SOLICITAC?O / PROCEDIMENTOS OU ITENS ASSISTENCIAIS SOLICITADOS      
      AAA.CD_TP_CARAT_ATEND,
      AAA.DT_SOL,
      AAA.DS_IND_CLINICA,
      AAA.DT_ATENDIMENTO,
      AAA.NR_SEQ,
      AAA.TABELA_ITEM,
      AAA.COD_PROCEDIMENTO_ASSISTENCIAL,
      AAA.DESCRICAO_ITEM,
      AAA.QTD_SOLIC_ITEM,
      AAA.QTD_AUT_ITEM,
--DADOS DO CONTRATADO EXECUTANTE      
      AAA.CD_OPER_CNPJ_CPF_EXEC,
      AAA.NM_CONT_EXEC,      
      AAA.CD_CNES_EXEC,
--DADOS DO ATENDIMENTO      
      AAA.CD_TP_ATENDIMENTO,
      AAA.CD_ID_ACIDENTE,
      AAA.CD_TIPO_CONSULTA,--S.CD_TP_SAIDA ,
      AAA.MOTIVO_ENCERRAMENTO,
--DADOS DA EXECUC?O / PROCEDIMENTOS E EXAMES REALIZADOS
      NULL NR_SEQ_PROC,
      AAA.DT_PROC_REAL,
      AAA.HR_INI_PROC,
      AAA.HR_FIM_PROC,
      AAA.CD_TABELAS,
      AAA.CD_PROC_REAL,
      AAA.DS_PROC_REAL,
      AAA.QT_PROC_REAL,
      AAA.CD_VIA_ACESSO ,
      AAA.CD_TECNICA_UTILIZADA,
      AAA.NR_RED_ACR ,
      AAA.VL_UNIT_PROC,
      AAA.VL_TOTAL_PROC_PROC ,
--IDENTIFICAC?O DOS PROFISSIONAIS EXECUTANTES      
      --E.AA_RECEITA,
      NULL NR_SEQ_PROF,
      AAA.CD_POS_PROF_EQUIPE,
      AAA.CD_OPER_CNPJ_CPF_EXEC_E,
      AAA.NM_PROF_EXEC,
      AAA.SG_CONS_PROF_EXEC,
      AAA.NR_CONS_PROF_EXEC,
      AAA.SG_UF_PROF_EXEC,      
      AAA.CD_ESPEC_EXEC,      
--OBS E TOTAIS      
      AAA.DS_OBSERVACAO,
      AAA.VL_TOTAL_PROC ,
      AAA.VL_TOTAL_TX_ALUGUEIS ,
      AAA.VL_TOTAL_MAT,
      AAA.VL_TOTAL_OPM,
      AAA.VL_TOTAL_MED,
      AAA.VL_TOTAL_GASES,
      AAA.VL_TOTAL_GERAL
      --,'||CHR(39)|| pTISS_SIMPLIFICADA ||CHR(39)||' A
       --     ,DECODE('||CHR(39)|| pTISS_SIMPLIFICADA ||CHR(39)||' ,''S'',1,0)  B
FROM 
(
SELECT DISTINCT NULL FAT_FCL_NR_SEQ_LOTE,      NULL FAT_FCL_NR_SEQ_IMPRIME,
      NULL AA_RECEITA,
      S.CD_CONVENIO,
      S.DS_CONVENIO,
      S.NR_ATENDIMENTO,
      S.DATA_VALIDADE,
      NULL CD_PARCELA,
      S.IDT_PACIENTE,
      S.NR_CONTA,
      S.CD_REGISTRO_ANS ,
      S.NR_GUIA_PRINCIPAL,
      S.DT_AUTORIZACAO,
      S.CD_SENHA,
      S.DT_VAL_SENHA,
      S.NR_GUIA_OPERADORA,
--DADOS DO BENEFICIARIO
      S.CAD_PLA_CD_PLANO_HAC,
      S.NR_CARTEIRA_BENEF,
      S.DT_VAL_CARTEIRA_BENEF,
      S.NM_BENEF,
      S.NR_CNS_BENEF,
      S.ID_ATENDIMENTO_RN, 
--DADOS DO SOLICITANTE
      S.CD_OPER_CNPJ_CPF_SOL,
      S.NM_CONT_SOL,      
      S.NM_PROF_SOL,      
      S.CONS_PROF_SOL,
      S.NR_CONS_PROF_SOL,
      S.SG_UF_PROF_SOL ,
      S.CD_ESPEC_SOL,
      NULL ASSINATURA_SOL,
--DADOS DA SOLICITAC?O / PROCEDIMENTOS OU ITENS ASSISTENCIAIS SOLICITADOS      
      S.CD_TP_CARAT_ATEND,
      S.DT_SOL,
      S.DS_IND_CLINICA,
      S.DT_ATENDIMENTO,
      P.NR_SEQ,
      P.CD_TABELAS TABELA_ITEM,
      P.CD_PROC_SOL COD_PROCEDIMENTO_ASSISTENCIAL,
      P.DS_PROC_SOL DESCRICAO_ITEM,
      P.QT_PROC_SOL QTD_SOLIC_ITEM,
      P.QT_PROC_SOL QTD_AUT_ITEM,
--DADOS DO CONTRATADO EXECUTANTE      
      NULL CD_OPER_CNPJ_CPF_EXEC,
      NULL NM_CONT_EXEC,      
      NULL CD_CNES_EXEC,
--DADOS DO ATENDIMENTO      
      NULL CD_TP_ATENDIMENTO,
      NULL CD_ID_ACIDENTE,
      NULL CD_TIPO_CONSULTA,--S.CD_TP_SAIDA ,
      NULL MOTIVO_ENCERRAMENTO,
--DADOS DA EXECUC?O / PROCEDIMENTOS E EXAMES REALIZADOS
      NULL NR_SEQ_PROC,
      NULL DT_PROC_REAL,
      NULL HR_INI_PROC,
      NULL HR_FIM_PROC,
      NULL CD_TABELAS,
      NULL CD_PROC_REAL,
      NULL DS_PROC_REAL,
      NULL QT_PROC_REAL,
      NULL CD_VIA_ACESSO,
      NULL CD_TECNICA_UTILIZADA,
      NULL NR_RED_ACR,
      NULL VL_UNIT_PROC,
      NULL VL_TOTAL_PROC_PROC   ,
--IDENTIFICAC?O DOS PROFISSIONAIS EXECUTANTES      
      --E.AA_RECEITA,
      NULL  NR_SEQ_PROF,
      NULL CD_POS_PROF_EQUIPE,
      NULL  CD_OPER_CNPJ_CPF_EXEC_E,
      NULL  NM_PROF_EXEC,
      NULL  SG_CONS_PROF_EXEC,
      NULL  NR_CONS_PROF_EXEC,
      NULL  SG_UF_PROF_EXEC ,      
      NULL  CD_ESPEC_EXEC,   
--OBS E TOTAIS      
      NULL DS_OBSERVACAO,
      NULL VL_TOTAL_PROC ,
      NULL VL_TOTAL_TX_ALUGUEIS ,
      NULL VL_TOTAL_MAT,
      NULL VL_TOTAL_OPM,
      NULL VL_TOTAL_MED,
      NULL VL_TOTAL_GASES,
      NULL VL_TOTAL_GERAL  
     
FROM  TSS_SPSADT_SGS_SOL_V3         S
LEFT JOIN TSS_SPSADT_PROC_SOL_SGS_V3     P    ON P.NR_CONTA           = S.NR_CONTA
                                           --  AND P.CD_PARCELA         = S.FAT_CCP_ID
                                             AND P.NR_ATENDIMENTO     = S.NR_ATENDIMENTO
                                             AND P.IDT_PACIENTE       = S.IDT_PACIENTE

 WHERE S.NR_ATENDIMENTO = pATD_ATE_ID       
   ) AAA
   
FULL JOIN (SELECT 1 NR_SEQ FROM DUAL UNION
                    SELECT 2 NR_SEQ FROM DUAL UNION
                    SELECT 3 NR_SEQ FROM DUAL UNION
                    SELECT 4 NR_SEQ FROM DUAL UNION
                    SELECT 5 NR_SEQ FROM DUAL
          ) GAMBI ON GAMBI.NR_SEQ        = NVL(AAA.NR_SEQ,1)             

ORDER BY   NVL(AAA.NR_SEQ,GAMBI.NR_SEQ) ;  
  
IO_CURSOR := V_CURSOR;

END PRC_FAT_REL_SPSADT_SGS_SOL_V3;
