CREATE OR REPLACE PROCEDURE "PRC_CTS_15_PASS_FAT_SGS_CUSTOS"
(
  IO_CURSOR         OUT PKG_CURSOR.T_CURSOR
) IS
  V_CURSOR PKG_CURSOR.T_CURSOR;
BEGIN
  OPEN V_CURSOR FOR

SELECT PLC.CAD_CTS_PLC_ID IDT_PLANO_CONTAS,
       PLC.CAD_CTS_CD_CONTA COD_PLANO,
       PLC.CAD_CTS_CD_NIVEL NIVEL,
       PLC.CAD_CTS_DS_DESCRICAO DESCRICAO_CUSTOS,
       CASE
         WHEN PLC.CAD_CTS_CD_CONTA LIKE '190%' THEN
          'OBTIDO DO RM SALDUS'
         ELSE
          PARA1.PARAMETRO
       END PARAMETRO,
       PARA1.CODIGO,
       PARA1.DESCRICAO,
       ---PARA1.CAD_TAP_TP_ATRIBUTO ,
       TAP.CAD_TAP_DS_ATRIBUTO ATRIBUTO
  FROM TB_CAD_CTS_PLC_PLANO_CONTAS PLC,
       TB_CAD_TAP_TP_ATRIB_PRODUTO TAP,
       (SELECT SGS.CAD_TAP_TP_ATRIBUTO,
               SGS.CAD_CTS_PLC_ID,
               'CLASSIFICACAO CONTABIL' PARAMETRO,
               TO_CHAR(SGS.CAD_CAC_ID_CLASS_CONTABIL, '00') CODIGO,
               CAC.CAD_CAC_DS_CLASSCONTABIL DESCRICAO
          FROM TB_ASS_CTS_PLC_SGS_CONTAS SGS,
               TB_CAD_CAC_CLASSIF_CONTAB CAC
         WHERE SGS.CAD_CAC_ID_CLASS_CONTABIL = CAC.CAD_CAC_ID_CLASSCONTABIL
           AND SGS.ASS_CTS_FL_STATUS = 'A'
        UNION ALL
        SELECT SGS.CAD_TAP_TP_ATRIBUTO,
               SGS.CAD_CTS_PLC_ID,
               'CENTRO CUSTO' PARAMETRO,
               TO_CHAR(SGS.CAD_CEC_ID_CCUSTO) CCUSTO,
               CC.CAD_CEC_DS_CCUSTO
          FROM TB_ASS_CTS_PLC_SGS_CONTAS SGS,
               TB_CAD_CEC_CENTRO_CUSTO   CC
         WHERE SGS.CAD_CEC_ID_CCUSTO = CC.CAD_CEC_ID_CCUSTO
           AND SGS.ASS_CTS_FL_STATUS = 'A'
        UNION ALL
        SELECT SGS.CAD_TAP_TP_ATRIBUTO,
               SGS.CAD_CTS_PLC_ID,
               'GRUPO DO MATMED' PARAMETRO,
               TO_CHAR(SGS.CAD_MTMD_GRUPO_ID, '00') GRUPO,
               MM.CAD_MTMD_GRUPO_DESCRICAO
          FROM TB_ASS_CTS_PLC_SGS_CONTAS SGS, TB_CAD_MTMD_GRUPO MM
         WHERE SGS.CAD_MTMD_GRUPO_ID = MM.CAD_MTMD_GRUPO_ID
           AND SGS.CAD_MTMD_SUBGRUPO_ID IS NULL
           AND SGS.ASS_CTS_FL_STATUS = 'A'
        UNION ALL
        SELECT SGS.CAD_TAP_TP_ATRIBUTO,
               SGS.CAD_CTS_PLC_ID,
               'GRUPO DO MATMED + SUBGRUPO' PARAMETRO,
               TO_CHAR(SGS.CAD_MTMD_GRUPO_ID, '00') || '-' ||
               TO_CHAR(SGS.CAD_MTMD_SUBGRUPO_ID) GRUPO_SUBGRUPO,
               ----MM.CAD_MTMD_GRUPO_DESCRICAO
               MMS.CAD_MTMD_SUBGRUPO_DESCRICAO
          FROM TB_ASS_CTS_PLC_SGS_CONTAS SGS,
               TB_CAD_MTMD_GRUPO             MM,
               TB_CAD_MTMD_SUBGRUPO          MMS
         WHERE SGS.CAD_MTMD_GRUPO_ID = MM.CAD_MTMD_GRUPO_ID
           AND SGS.CAD_MTMD_SUBGRUPO_ID = MMS.CAD_MTMD_SUBGRUPO_ID
           AND MM.CAD_MTMD_GRUPO_ID = MMS.CAD_MTMD_GRUPO_ID
           AND SGS.CAD_MTMD_SUBGRUPO_ID IS NOT NULL
           AND SGS.ASS_CTS_FL_STATUS = 'A'
        UNION ALL
        SELECT SGS.CAD_TAP_TP_ATRIBUTO,
               SGS.CAD_CTS_PLC_ID,
               'GRUPO PROCEDIMENTO + TABELA ' PARAMETRO,
               SGS.AUX_EPP_CD_ESPECPROC || '-' ||
               SGS.TIS_MED_CD_TABELAMEDICA GRUPO_TB,
               EPP.AUX_EPP_DS_DESCRICAO
          FROM TB_ASS_CTS_PLC_SGS_CONTAS SGS,
               TB_AUX_EPP_ESPECPROC      EPP
         WHERE SGS.AUX_EPP_CD_ESPECPROC = EPP.AUX_EPP_CD_ESPECPROC
           AND SGS.TIS_MED_CD_TABELAMEDICA = EPP.TIS_MED_CD_TABELAMEDICA
           AND SGS.ASS_CTS_FL_STATUS = 'A'
        UNION ALL
        SELECT SGS.CAD_TAP_TP_ATRIBUTO,
               SGS.CAD_CTS_PLC_ID,
               'TIPO DE CLINICA' PARAMETRO,
               SGS.CAD_CLC_CT_EMPRESA,
               DECODE(SGS.CAD_CLC_CT_EMPRESA,
                      'SC',
                      'SANTOS CLINICA',
                      'ES',
                      'ESSENCIAL',
                      'CI',
                      'CLINICA INTERNA',
                      'CE',
                      'CLINICA EXTERNA',
                      'SI',
                      'HM SEM CLINICA ') CLI_DESCRI
          FROM TB_ASS_CTS_PLC_SGS_CONTAS SGS
         WHERE SGS.CAD_CLC_CT_EMPRESA IS NOT NULL
           AND SGS.ASS_CTS_FL_STATUS = 'A') PARA1
 WHERE PLC.CAD_CTS_PLC_ID = PARA1.CAD_CTS_PLC_ID(+)
   AND PLC.CAD_CTS_CD_NATUREZA = 1 -- RECEITA
   -- AND PLC.CAD_CTS_PLC_ID NOT IN ( 66, 67, 68, 69, 70 ) -- RECEITA INDIRETA VEM DO RM SALDUS
   AND PARA1.CAD_TAP_TP_ATRIBUTO = TAP.CAD_TAP_TP_ATRIBUTO(+)
 ORDER BY 2, 3, 6;
  IO_CURSOR := V_CURSOR;
END PRC_CTS_15_PASS_FAT_SGS_CUSTOS;
/
