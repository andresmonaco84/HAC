CREATE OR REPLACE FUNCTION "FNC_REP_REL_SUB_VLHR_SANTEC"
  (
     pREP_PGM_MES_PAGTO_INI IN TB_REP_PGM_PAGTO_MEDICO.REP_PGM_MES_PAGTO%TYPE,
     pREP_PGM_ANO_PAGTO_INI IN TB_REP_PGM_PAGTO_MEDICO.REP_PGM_ANO_PAGTO%TYPE,
     pCAD_CLC_ID IN TB_CAD_CLC_CLINICA_CREDENCIADA.CAD_CLC_ID%TYPE,
     pREP_PGM_TP_CREDENCIA_PROF IN TB_REP_PGM_PAGTO_MEDICO.REP_PGM_TP_CREDENCIA_PROF%TYPE DEFAULT NULL,
     pREP_PGM_MES_PAGTO_FIM     IN TB_REP_PGM_PAGTO_MEDICO.REP_PGM_MES_PAGTO%TYPE,
     pREP_PGM_ANO_PAGTO_FIM     IN TB_REP_PGM_PAGTO_MEDICO.REP_PGM_ANO_PAGTO%TYPE
  )
RETURN NUMBER IS
  VALORHORA_SEMANTECIPACAO number(12, 2);
/********************************************************************
*    Procedure: FNC_REP_REL_SUB_VLHR_SANTEC
*
*    Data Criacao:    06/08/2012           Por: Davi S. M. dos Reis
*    Data Alteracao:  data da alterac?o  Por: Nome do Analista
*
*    Funcao: Descric?o da funcionalidade da Function
*
*
*******************************************************************/
BEGIN
  BEGIN
    SELECT NVL(DECODE(pREP_PGM_TP_CREDENCIA_PROF,
                      'MF', SUM(PPC.REP_PPC_VL_PAGO_HAC),
                      'MC', SUM(PPC.REP_PPC_VL_PAGO_ACS),
                      SUM(PPC.REP_PPC_VL_PAGO_HAC + PPC.REP_PPC_VL_PAGO_ACS)), 0)
      INTO VALORHORA_SEMANTECIPACAO
      FROM TB_REP_PPC_PAG_PROF_CLI PPC
     INNER JOIN TB_CAD_REP_BCP_BASE_CALCULO BCP
        ON BCP.CAD_REP_TP_BASE_CALCULO = PPC.CAD_REP_TP_BASE_CALCULO
     WHERE BCP.REP_BCP_DS_CAMPO = 'TIPO PAGAMENTO'
       AND PPC.REP_PPC_FL_PAGTO IN ('P', 'F')
       AND TO_DATE('01'||'/'||PPC.REP_PPC_MES_PAGTO||'/'||PPC.REP_PPC_ANO_PAGTO,'DD/MM/YYYY') >= TO_DATE('01'||'/'||LPAD(pREP_PGM_MES_PAGTO_INI,2,'0')||'/'||pREP_PGM_ANO_PAGTO_INI, 'DD/MM/YYYY')
       AND TO_DATE('01'||'/'||PPC.REP_PPC_MES_PAGTO||'/'||PPC.REP_PPC_ANO_PAGTO,'DD/MM/YYYY') <= TO_DATE(LPAD(LAST_DAY(TO_DATE('01'||LPAD(pREP_PGM_MES_PAGTO_FIM,2,'0')||pREP_PGM_ANO_PAGTO_FIM, 'DDMMYYYY')),2,0)||'/'||LPAD(pREP_PGM_MES_PAGTO_FIM,2,'0')||'/'||pREP_PGM_ANO_PAGTO_FIM, 'DD/MM/YYYY')
       AND PPC.CAD_CLC_ID = pCAD_CLC_ID
       AND PPC.REP_PPC_FL_ANTECIPACAO = 'N'
     GROUP BY PPC.CAD_CLC_ID;
     EXCEPTION
       WHEN NO_DATA_FOUND THEN
         VALORHORA_SEMANTECIPACAO := 0;
     END;
   RETURN (VALORHORA_SEMANTECIPACAO);
END FNC_REP_REL_SUB_VLHR_SANTEC;