PROCEDURE PRC_SEG_FUNCIONALIDADE_S
  (
     pSEG_FUN_ID_FUNCIONALIDADE     IN TB_SEG_FUN_FUNCIONALIDADE.SEG_FUN_ID_FUNCIONALIDADE%type DEFAULT NULL,
     pSEG_FUN_DS_DESCRICAO          IN TB_SEG_FUN_FUNCIONALIDADE.SEG_FUN_DS_DESCRICAO%type DEFAULT NULL,
     pSEG_FUN_FL_ITEM_MENU_OK       IN TB_SEG_FUN_FUNCIONALIDADE.SEG_FUN_FL_ITEM_MENU_OK%type DEFAULT NULL,
     pSEG_FUN_ID_FUNCIONALIDADE_PAI IN TB_SEG_FUN_FUNCIONALIDADE.SEG_FUN_ID_FUNCIONALIDADE_PAI%type DEFAULT NULL,
     pSEG_FUN_DS_NOME_PAGINA        IN TB_SEG_FUN_FUNCIONALIDADE.SEG_FUN_DS_NOME_PAGINA%type DEFAULT NULL,
     pSEG_FUN_NM_NOME               IN TB_SEG_FUN_FUNCIONALIDADE.SEG_FUN_NM_NOME%type DEFAULT NULL,
     pSEG_MOD_ID_MODULO             IN TB_SEG_FUN_FUNCIONALIDADE.SEG_MOD_ID_MODULO%type DEFAULT NULL,
     -- pSEG_ID_SISTEMA                IN TB_SEG_FUN_FUNCIONALIDADE.SEG_ID_SISTEMA%TYPE DEFAULT NULL,
     pSEG_PER_ID_PERFIL             IN TB_SEG_PER_PERFIL.seg_per_id_perfil%TYPE DEFAULT NULL,
     pFL_ASSOCIADOS                 IN NUMBER,
     io_cursor OUT PKG_CURSOR.t_cursor
  )
  is
  /********************************************************************
  *    Procedure: PRC_SEG_FUN_FUNCIONALIDADE_S
  *
  *    Data Criacao: 	   Por: Ricardo Costa
  *    Alteracao:	
   05/01/2010  Por: Ricardo costa
   removido parametro de Id do sistema ( n√£o existe mais )
                
  *
  *    Funcao: Retorna funcionalidades conforme parametro de filtro ( associada ao modulo, todas, ou nao associadas )
  *
  *******************************************************************/
  v_cursor PKG_CURSOR.t_cursor;
  begin
  IF pFL_ASSOCIADOS = 2 THEN -- TODAS AS FUNCIONALIDADES
    OPEN v_cursor FOR
    SELECT
       SEG_FUN_ID_FUNCIONALIDADE,
       SEG_FUN_DS_DESCRICAO,
       SEG_FUN_FL_ITEM_MENU_OK,
       SEG_FUN_ID_FUNCIONALIDADE_PAI,
       SEG_FUN_DS_NOME_PAGINA,
       SEG_FUN_NM_NOME,
       SEG_MOD_ID_MODULO,
       SEG_ID_SISTEMA
    FROM TB_SEG_FUN_FUNCIONALIDADE
    WHERE
        (pSEG_FUN_ID_FUNCIONALIDADE is null OR SEG_FUN_ID_FUNCIONALIDADE = pSEG_FUN_ID_FUNCIONALIDADE) AND
        (pSEG_FUN_DS_DESCRICAO is null OR SEG_FUN_DS_DESCRICAO = pSEG_FUN_DS_DESCRICAO) AND
        (pSEG_FUN_FL_ITEM_MENU_OK is null OR SEG_FUN_FL_ITEM_MENU_OK = pSEG_FUN_FL_ITEM_MENU_OK) AND
        (pSEG_FUN_ID_FUNCIONALIDADE_PAI is null OR SEG_FUN_ID_FUNCIONALIDADE_PAI = pSEG_FUN_ID_FUNCIONALIDADE_PAI) AND
        (pSEG_FUN_DS_NOME_PAGINA is null OR SEG_FUN_DS_NOME_PAGINA = pSEG_FUN_DS_NOME_PAGINA) AND
        (pSEG_FUN_NM_NOME is null OR SEG_FUN_NM_NOME = pSEG_FUN_NM_NOME) AND
        (pSEG_MOD_ID_MODULO is null OR SEG_MOD_ID_MODULO = pSEG_MOD_ID_MODULO)
    -- AND (pSEG_ID_SISTEMA IS NULL OR SEG_ID_SISTEMA = pSEG_ID_SISTEMA)
    ORDER BY SEG_FUN_DS_DESCRICAO, SEG_FUN_NM_NOME;
  ELSIF pFL_ASSOCIADOS = 0 THEN -- FUNCIONALIDADES NAO ASSOCIADAS
    OPEN v_cursor FOR
    SELECT
       FUN.SEG_FUN_ID_FUNCIONALIDADE,
       FUN.SEG_FUN_DS_DESCRICAO,
       FUN.SEG_FUN_FL_ITEM_MENU_OK,
       FUN.SEG_FUN_ID_FUNCIONALIDADE_PAI,
       FUN.SEG_FUN_DS_NOME_PAGINA,
       FUN.SEG_FUN_NM_NOME,
       FUN.SEG_MOD_ID_MODULO,
       FUN.SEG_ID_SISTEMA
    FROM TB_SEG_FUN_FUNCIONALIDADE FUN
    WHERE
        (pSEG_FUN_ID_FUNCIONALIDADE is null OR FUN.SEG_FUN_ID_FUNCIONALIDADE = pSEG_FUN_ID_FUNCIONALIDADE) AND
        (pSEG_FUN_DS_DESCRICAO is null OR FUN.SEG_FUN_DS_DESCRICAO = pSEG_FUN_DS_DESCRICAO) AND
        (pSEG_FUN_FL_ITEM_MENU_OK is null OR FUN.SEG_FUN_FL_ITEM_MENU_OK = pSEG_FUN_FL_ITEM_MENU_OK) AND
        (pSEG_FUN_ID_FUNCIONALIDADE_PAI is null OR FUN.SEG_FUN_ID_FUNCIONALIDADE_PAI = pSEG_FUN_ID_FUNCIONALIDADE_PAI) AND
        (pSEG_FUN_DS_NOME_PAGINA is null OR FUN.SEG_FUN_DS_NOME_PAGINA = pSEG_FUN_DS_NOME_PAGINA) AND
        (pSEG_FUN_NM_NOME is null OR FUN.SEG_FUN_NM_NOME = pSEG_FUN_NM_NOME) AND
        (pSEG_MOD_ID_MODULO is null OR FUN.SEG_MOD_ID_MODULO = pSEG_MOD_ID_MODULO)
    -- AND (pSEG_ID_SISTEMA IS NULL OR FUN.SEG_ID_SISTEMA = pSEG_ID_SISTEMA)
    MINUS
    SELECT
       FUN.SEG_FUN_ID_FUNCIONALIDADE,
       FUN.SEG_FUN_DS_DESCRICAO,
       FUN.SEG_FUN_FL_ITEM_MENU_OK,
       FUN.SEG_FUN_ID_FUNCIONALIDADE_PAI,
       FUN.SEG_FUN_DS_NOME_PAGINA,
       FUN.SEG_FUN_NM_NOME,
       FUN.SEG_MOD_ID_MODULO,
       FUN.SEG_ID_SISTEMA
    FROM TB_SEG_FUN_FUNCIONALIDADE FUN,
         TB_SEG_PFU_PERFIL_FUNCIONALID PERFUN
    WHERE
        (pSEG_FUN_ID_FUNCIONALIDADE is null OR FUN.SEG_FUN_ID_FUNCIONALIDADE = pSEG_FUN_ID_FUNCIONALIDADE) AND
        (pSEG_FUN_DS_DESCRICAO is null OR FUN.SEG_FUN_DS_DESCRICAO = pSEG_FUN_DS_DESCRICAO) AND
        (pSEG_FUN_FL_ITEM_MENU_OK is null OR FUN.SEG_FUN_FL_ITEM_MENU_OK = pSEG_FUN_FL_ITEM_MENU_OK) AND
        (pSEG_FUN_ID_FUNCIONALIDADE_PAI is null OR FUN.SEG_FUN_ID_FUNCIONALIDADE_PAI = pSEG_FUN_ID_FUNCIONALIDADE_PAI) AND
        (pSEG_FUN_DS_NOME_PAGINA is null OR FUN.SEG_FUN_DS_NOME_PAGINA = pSEG_FUN_DS_NOME_PAGINA) AND
        (pSEG_FUN_NM_NOME is null OR FUN.SEG_FUN_NM_NOME = pSEG_FUN_NM_NOME) AND
        (pSEG_MOD_ID_MODULO is null OR FUN.SEG_MOD_ID_MODULO = pSEG_MOD_ID_MODULO)
    -- AND (pSEG_ID_SISTEMA IS NULL OR FUN.SEG_ID_SISTEMA = pSEG_ID_SISTEMA)
    AND PERFUN.SEG_MOD_ID_MODULO = FUN.SEG_MOD_ID_MODULO
    AND PERFUN.SEG_FUN_ID_FUNCIONALIDADE = FUN.SEG_FUN_ID_FUNCIONALIDADE
    AND PERFUN.seg_per_id_perfil = pSEG_PER_ID_PERFIL
    ORDER BY SEG_FUN_DS_DESCRICAO, SEG_FUN_NM_NOME;
  ELSIF pFL_ASSOCIADOS = 1 THEN -- FUNCIOBALIDADES JA ASSOCIADAS
      OPEN v_cursor FOR
    SELECT
       FUN.SEG_FUN_ID_FUNCIONALIDADE,
       FUN.SEG_FUN_DS_DESCRICAO,
       FUN.SEG_FUN_FL_ITEM_MENU_OK,
       FUN.SEG_FUN_ID_FUNCIONALIDADE_PAI,
       FUN.SEG_FUN_DS_NOME_PAGINA,
       FUN.SEG_FUN_NM_NOME,
       FUN.SEG_MOD_ID_MODULO,
       FUN.SEG_ID_SISTEMA
    FROM TB_SEG_FUN_FUNCIONALIDADE FUN,
         TB_SEG_PFU_PERFIL_FUNCIONALID PERFUN
    WHERE
        (pSEG_FUN_ID_FUNCIONALIDADE is null OR FUN.SEG_FUN_ID_FUNCIONALIDADE = pSEG_FUN_ID_FUNCIONALIDADE) AND
        (pSEG_FUN_DS_DESCRICAO is null OR FUN.SEG_FUN_DS_DESCRICAO = pSEG_FUN_DS_DESCRICAO) AND
        (pSEG_FUN_FL_ITEM_MENU_OK is null OR FUN.SEG_FUN_FL_ITEM_MENU_OK = pSEG_FUN_FL_ITEM_MENU_OK) AND
        (pSEG_FUN_ID_FUNCIONALIDADE_PAI is null OR FUN.SEG_FUN_ID_FUNCIONALIDADE_PAI = pSEG_FUN_ID_FUNCIONALIDADE_PAI) AND
        (pSEG_FUN_DS_NOME_PAGINA is null OR FUN.SEG_FUN_DS_NOME_PAGINA = pSEG_FUN_DS_NOME_PAGINA) AND
        (pSEG_FUN_NM_NOME is null OR FUN.SEG_FUN_NM_NOME = pSEG_FUN_NM_NOME) AND
        (pSEG_MOD_ID_MODULO IS NULL OR FUN.SEG_MOD_ID_MODULO = pSEG_MOD_ID_MODULO)
    -- AND (pSEG_ID_SISTEMA IS NULL OR FUN.SEG_ID_SISTEMA = pSEG_ID_SISTEMA)
    AND PERFUN.SEG_MOD_ID_MODULO = FUN.SEG_MOD_ID_MODULO
    AND PERFUN.SEG_FUN_ID_FUNCIONALIDADE = FUN.SEG_FUN_ID_FUNCIONALIDADE
    AND PERFUN.seg_per_id_perfil = pSEG_PER_ID_PERFIL
    ORDER BY SEG_FUN_DS_DESCRICAO, SEG_FUN_NM_NOME;
  END IF;
    io_cursor := v_cursor;
  end PRC_SEG_FUNCIONALIDADE_S;