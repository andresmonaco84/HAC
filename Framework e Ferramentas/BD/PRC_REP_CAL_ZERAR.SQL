CREATE OR REPLACE PROCEDURE PRC_REP_CAL_ZERAR
(
  PREP_MES                              IN INT,
  PREP_ANO                              IN INT,
  PSEG_USU_ID_USUARIO                   IN INT,
  PCAD_CLC_ID                           IN STRING,
  PCAD_UNI_ID_UNIDADE                   IN STRING,
  PCAD_LAT_ID_LOCAL_ATENDIMENTO         IN STRING,
  PCAD_PRO_ID_PROFISSIONAL              IN STRING,
  PCAL_TIPO_TABELA                      IN STRING
)
IS
BEGIN
  IF PCAL_TIPO_TABELA = 'PGM' THEN
    BEGIN
      UPDATE  TB_REP_PGM_PAGTO_MEDICO PGM
         SET  PGM.REP_PGM_VL_PAGO = NULL,
              PGM.SEG_USU_ID_USUARIO_ATUALIZ = PSEG_USU_ID_USUARIO
       WHERE  PGM.REP_PGM_MES_PAGTO = PREP_MES
         AND  PGM.REP_PGM_ANO_PAGTO = PREP_ANO
         AND  PGM.CAD_CLC_ID IN (SELECT * FROM TABLE(FNC_SPLIT(pCAD_CLC_ID)))
         AND (pCAD_UNI_ID_UNIDADE IS NULL OR PGM.CAD_UNI_ID_UNIDADE IN (SELECT * FROM TABLE(FNC_SPLIT(pCAD_UNI_ID_UNIDADE))))
         AND (pCAD_LAT_ID_LOCAL_ATENDIMENTO IS NULL OR PGM.CAD_LAT_ID_LOCAL_ATENDIMENTO IN (SELECT * FROM TABLE(FNC_SPLIT(pCAD_LAT_ID_LOCAL_ATENDIMENTO))))
         AND (pCAD_PRO_ID_PROFISSIONAL IS NULL OR PGM.CAD_PRO_ID_PROFISSIONAL IN (SELECT * FROM TABLE(FNC_SPLIT(pCAD_PRO_ID_PROFISSIONAL))))
         AND  PGM.REP_PGM_FL_STATUS = 'A'
         AND  PGM.REP_PGM_FL_PAGO = 'P'; --VERIFICAR
     END;
     COMMIT;
    END IF;

  IF PCAL_TIPO_TABELA = 'PPC' THEN
    BEGIN
      DELETE FROM TB_REP_PPC_PAG_PROF_CLI PPC
      WHERE  PPC.REP_PPC_MES_PAGTO = PREP_MES
        AND  PPC.REP_PPC_ANO_PAGTO = PREP_ANO
        AND  PPC.CAD_CLC_ID IN (SELECT * FROM TABLE(FNC_SPLIT( PCAD_CLC_ID )))
        AND (PCAD_UNI_ID_UNIDADE IS NULL OR PPC.CAD_UNI_ID_UNIDADE IN (SELECT * FROM TABLE(FNC_SPLIT( PCAD_UNI_ID_UNIDADE ))))
        AND (PCAD_LAT_ID_LOCAL_ATENDIMENTO IS NULL OR PPC.CAD_LAT_ID_LOCAL IN (SELECT * FROM TABLE(FNC_SPLIT( PCAD_LAT_ID_LOCAL_ATENDIMENTO ))))
        AND (PCAD_PRO_ID_PROFISSIONAL IS NULL OR PPC.CAD_PRO_ID_PROFISSIONAL IN (SELECT * FROM TABLE(FNC_SPLIT( PCAD_PRO_ID_PROFISSIONAL ))))
        AND  PPC.REP_PPC_FL_PAGTO = 'P'; --VERIFICAR
    END;
    COMMIT;
  END IF;

END PRC_REP_CAL_ZERAR;
/
