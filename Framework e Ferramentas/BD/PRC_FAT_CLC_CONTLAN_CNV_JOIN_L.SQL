create or replace procedure PRC_FAT_CLC_CONTLAN_CNV_JOIN_L
(
     pFAT_CLC_ID IN TB_FAT_CLC_CONTR_LANCA_CNV.FAT_CLC_ID%type DEFAULT NULL,
     pCAD_CNV_ID_CONVENIO IN TB_FAT_CLC_CONTR_LANCA_CNV.CAD_CNV_ID_CONVENIO%type DEFAULT NULL,
     pCAD_PLA_ID_PLANO IN TB_FAT_CLC_CONTR_LANCA_CNV.CAD_PLA_ID_PLANO%type DEFAULT NULL,
     pCAD_UNI_ID_UNIDADE IN TB_FAT_CLC_CONTR_LANCA_CNV.CAD_UNI_ID_UNIDADE%type DEFAULT NULL,
     pCAD_LAT_ID_LOCAL_ATENDIMENTO IN TB_FAT_CLC_CONTR_LANCA_CNV.CAD_LAT_ID_LOCAL_ATENDIMENTO%type DEFAULT NULL,
     pCAD_SET_ID IN TB_FAT_CLC_CONTR_LANCA_CNV.CAD_SET_ID%type DEFAULT NULL,
     pTIS_CBO_CD_CBOS IN TB_FAT_CLC_CONTR_LANCA_CNV.TIS_CBO_CD_CBOS%type DEFAULT NULL,
     pCAD_PRD_ID IN TB_FAT_CLC_CONTR_LANCA_CNV.CAD_PRD_ID%type DEFAULT NULL,
     pFAT_CLC_FL_LIGADO IN TB_FAT_CLC_CONTR_LANCA_CNV.FAT_CLC_FL_LIGADO%type DEFAULT NULL,
     pFAT_CLC_FL_ABERTURA_ATEND IN TB_FAT_CLC_CONTR_LANCA_CNV.FAT_CLC_FL_ABERTURA_ATEND%type DEFAULT NULL,
     pFAT_CLC_FL_LANCAMENTO_PROD IN TB_FAT_CLC_CONTR_LANCA_CNV.FAT_CLC_FL_LANCAMENTO_PROD%type DEFAULT NULL,
     pFAT_CLC_FL_STATUS IN TB_FAT_CLC_CONTR_LANCA_CNV.FAT_CLC_FL_STATUS%type DEFAULT NULL,
     pFAT_CLC_DT_ULTIMA_ATUALIZACAO IN TB_FAT_CLC_CONTR_LANCA_CNV.FAT_CLC_DT_ULTIMA_ATUALIZACAO%type DEFAULT NULL,
     pSEG_USU_ID_USUARIO IN TB_FAT_CLC_CONTR_LANCA_CNV.SEG_USU_ID_USUARIO%type DEFAULT NULL,
     pFAT_CLC_QT_PRODUTO IN TB_FAT_CLC_CONTR_LANCA_CNV.FAT_CLC_QT_PRODUTO%type DEFAULT NULL,
     pTIS_TAT_CD_TPATENDIMENTO IN TB_FAT_CLC_CONTR_LANCA_CNV.TIS_TAT_CD_TPATENDIMENTO%type DEFAULT NULL,
     io_cursor OUT PKG_CURSOR.t_cursor
)
is
/********************************************************************
*    Procedure: PRC_FAT_CLC_CONTLAN_CNV_JOIN_L
*
*    Data Criacao:   2010        Por: ?
*    Data Alteracao: 27/08/2010  Por: André Souza Monaco
*         Alteracao: Adição do parâmetro pTIS_TAT_CD_TPATENDIMENTO e
*                    recuperação do campo CAD_CNV_NM_FANTASIA
*
*    Funcao: Listar lançamentos por convênio (com join)
*
*******************************************************************/
v_cursor PKG_CURSOR.t_cursor;
begin
OPEN v_cursor FOR
SELECT
       CLC.FAT_CLC_ID,
       CLC.CAD_CNV_ID_CONVENIO,
       CLC.CAD_PLA_ID_PLANO,
       CLC.CAD_UNI_ID_UNIDADE,
       CLC.CAD_LAT_ID_LOCAL_ATENDIMENTO,
       CLC.CAD_SET_ID,
       CLC.TIS_CBO_CD_CBOS,
       CLC.CAD_PRD_ID,
       CLC.FAT_CLC_FL_LIGADO,
       CLC.FAT_CLC_FL_ABERTURA_ATEND,
       CLC.FAT_CLC_FL_LANCAMENTO_PROD,
       CLC.FAT_CLC_FL_STATUS,
       CLC.FAT_CLC_DT_ULTIMA_ATUALIZACAO,
       CLC.SEG_USU_ID_USUARIO,
       CLC.FAT_CLC_QT_PRODUTO,
       CLC.TIS_TAT_CD_TPATENDIMENTO,

       PRD.CAD_PRD_DS_DESCRICAO,
       PRD.CAD_PRD_CD_CODIGO,

       MED.TIS_MED_DS_TABELAMEDICA,

       ESP.AUX_EPP_DS_DESCRICAO,
       
       CNV.CAD_CNV_CD_HAC_PRESTADOR || ' - ' || CNV.CAD_CNV_NM_FANTASIA CAD_CNV_NM_FANTASIA

FROM TB_FAT_CLC_CONTR_LANCA_CNV CLC,
     TB_CAD_PRD_PRODUTO PRD,
     TB_TIS_MED_TABELAMEDICA MED,
     --TB_TIS_CBO_CBOS CBO
     TB_AUX_EPP_ESPECPROC ESP,
     TB_CAD_CNV_CONVENIO CNV
WHERE
        (pFAT_CLC_ID is null OR CLC.FAT_CLC_ID = pFAT_CLC_ID) AND
        (pCAD_CNV_ID_CONVENIO is null OR CLC.CAD_CNV_ID_CONVENIO = pCAD_CNV_ID_CONVENIO) AND
        (pCAD_PLA_ID_PLANO is null OR CLC.CAD_PLA_ID_PLANO = pCAD_PLA_ID_PLANO) AND
        (pCAD_UNI_ID_UNIDADE is null OR CLC.CAD_UNI_ID_UNIDADE = pCAD_UNI_ID_UNIDADE) AND
        (pCAD_LAT_ID_LOCAL_ATENDIMENTO is null OR CLC.CAD_LAT_ID_LOCAL_ATENDIMENTO = pCAD_LAT_ID_LOCAL_ATENDIMENTO) AND
        (pCAD_SET_ID is null OR CLC.CAD_SET_ID = pCAD_SET_ID) AND
        (pTIS_CBO_CD_CBOS is null OR CLC.TIS_CBO_CD_CBOS = pTIS_CBO_CD_CBOS) AND
        (pCAD_PRD_ID is null OR CLC.CAD_PRD_ID = pCAD_PRD_ID) AND
        (pFAT_CLC_FL_LIGADO is null OR CLC.FAT_CLC_FL_LIGADO = pFAT_CLC_FL_LIGADO) AND
        (pFAT_CLC_FL_ABERTURA_ATEND is null OR CLC.FAT_CLC_FL_ABERTURA_ATEND = pFAT_CLC_FL_ABERTURA_ATEND) AND
        (pFAT_CLC_FL_LANCAMENTO_PROD is null OR CLC.FAT_CLC_FL_LANCAMENTO_PROD = pFAT_CLC_FL_LANCAMENTO_PROD) AND
        (pFAT_CLC_FL_STATUS is null OR CLC.FAT_CLC_FL_STATUS = pFAT_CLC_FL_STATUS) AND
        (pFAT_CLC_DT_ULTIMA_ATUALIZACAO is null OR CLC.FAT_CLC_DT_ULTIMA_ATUALIZACAO = pFAT_CLC_DT_ULTIMA_ATUALIZACAO) AND
        (pSEG_USU_ID_USUARIO is null OR CLC.SEG_USU_ID_USUARIO = pSEG_USU_ID_USUARIO) AND
        (pFAT_CLC_QT_PRODUTO is null OR CLC.FAT_CLC_QT_PRODUTO = pFAT_CLC_QT_PRODUTO) AND
        (pTIS_TAT_CD_TPATENDIMENTO is null OR CLC.TIS_TAT_CD_TPATENDIMENTO = pTIS_TAT_CD_TPATENDIMENTO) AND
        (CLC.CAD_PRD_ID = PRD.CAD_PRD_ID) AND
        (PRD.TIS_MED_CD_TABELAMEDICA = MED.TIS_MED_CD_TABELAMEDICA) AND        
        (ESP.AUX_EPP_CD_ESPECPROC = PRD.AUX_EPP_CD_ESPECPROC) AND 
        (ESP.TIS_MED_CD_TABELAMEDICA = MED.TIS_MED_CD_TABELAMEDICA) AND       
        (CNV.CAD_CNV_ID_CONVENIO = CLC.CAD_CNV_ID_CONVENIO);
io_cursor := v_cursor;
end PRC_FAT_CLC_CONTLAN_CNV_JOIN_L;

