CREATE OR REPLACE PROCEDURE "PRC_ATS_REL_RANDOM"(pCAD_PRD_ID                   IN TB_ATS_ATE_ATENDIMENTO_SADT.CAD_PRD_ID%type DEFAULT NULL,
                                                               pCAD_UNI_ID_UNIDADE           in TB_ATD_ATE_ATENDIMENTO.CAD_UNI_ID_UNIDADE%type DEFAULT NULL,
                                                               pCAD_LAT_ID_LOCAL_ATENDIMENTO in TB_ATD_ATE_ATENDIMENTO.CAD_LAT_ID_LOCAL_ATENDIMENTO%type default null,
                                                               pCAD_SET_ID                   IN TB_ATS_ATE_ATENDIMENTO_SADT.CAD_SET_ID_ATEN%type DEFAULT NULL,
                                                               pAUX_EPP_CD_ESPECPROC         IN TB_ATS_ATE_ATENDIMENTO_SADT.AUX_EPP_CD_ESPECPROC%type DEFAULT NULL,
                                                               pCAD_PRO_ID_PROF_EXECUTANTE   IN TB_ATS_ATE_ATENDIMENTO_SADT.CAD_PRO_ID_PROF_EXECUTANTE%type DEFAULT NULL,
                                                               pDT_INI_CONSULTA              IN TB_ATS_ATE_ATENDIMENTO_SADT.ATS_ATE_DT_REALIZ_PROCED%type DEFAULT NULL,
                                                               pDT_FIM_CONSULTA              IN TB_ATS_ATE_ATENDIMENTO_SADT.ATS_ATE_DT_REALIZ_PROCED%type DEFAULT NULL,

                                                               io_cursor                     OUT PKG_CURSOR.t_cursor

                                                               ) is
  /********************************************************************
   *    Procedure: PRC_ATS_REL_RANDOM
   *
  *
   *******************************************************************/
  v_cursor  PKG_CURSOR.t_cursor;
  TOTAL_LAUDOS   DECIMAL;
  PERCENTUAL DECIMAL:=7;

--21 20 22 23 29 33 32 34 36 39 40 45 56



  QTD_20 DECIMAL;
  QTD_21 DECIMAL;
    QTD_22 DECIMAL;
  QTD_23 DECIMAL;
  QTD_29 DECIMAL;
  QTD_32 DECIMAL;
  QTD_33 DECIMAL;
  QTD_34 DECIMAL;
  QTD_36 DECIMAL;
   QTD_39 DECIMAL;  
  QTD_40 DECIMAL;
   QTD_45 DECIMAL;  
   QTD_56 DECIMAL;     
begin

  SELECT SGS.FNC_ATS_TOT_ESPEC(NULL, pDT_INI_CONSULTA, pDT_FIM_CONSULTA, pCAD_UNI_ID_UNIDADE, pCAD_LAT_ID_LOCAL_ATENDIMENTO, pCAD_SET_ID, 100) INTO TOTAL_LAUDOS  FROM DUAL;  

  SELECT SGS.FNC_ATS_TOT_ESPEC('20',pDT_INI_CONSULTA,pDT_FIM_CONSULTA, pCAD_UNI_ID_UNIDADE, pCAD_LAT_ID_LOCAL_ATENDIMENTO, pCAD_SET_ID, PERCENTUAL) INTO QTD_20  FROM DUAL;
  SELECT SGS.FNC_ATS_TOT_ESPEC('21',pDT_INI_CONSULTA,pDT_FIM_CONSULTA, pCAD_UNI_ID_UNIDADE, pCAD_LAT_ID_LOCAL_ATENDIMENTO, pCAD_SET_ID, PERCENTUAL) INTO QTD_21  FROM DUAL;
  SELECT SGS.FNC_ATS_TOT_ESPEC('22',pDT_INI_CONSULTA,pDT_FIM_CONSULTA, pCAD_UNI_ID_UNIDADE, pCAD_LAT_ID_LOCAL_ATENDIMENTO, pCAD_SET_ID, PERCENTUAL) INTO QTD_22  FROM DUAL;
  SELECT SGS.FNC_ATS_TOT_ESPEC('23',pDT_INI_CONSULTA,pDT_FIM_CONSULTA, pCAD_UNI_ID_UNIDADE, pCAD_LAT_ID_LOCAL_ATENDIMENTO, pCAD_SET_ID, PERCENTUAL) INTO QTD_23  FROM DUAL;
  SELECT SGS.FNC_ATS_TOT_ESPEC('29',pDT_INI_CONSULTA,pDT_FIM_CONSULTA, pCAD_UNI_ID_UNIDADE, pCAD_LAT_ID_LOCAL_ATENDIMENTO, pCAD_SET_ID, PERCENTUAL) INTO QTD_29  FROM DUAL;
  SELECT SGS.FNC_ATS_TOT_ESPEC('32',pDT_INI_CONSULTA,pDT_FIM_CONSULTA, pCAD_UNI_ID_UNIDADE, pCAD_LAT_ID_LOCAL_ATENDIMENTO, pCAD_SET_ID, PERCENTUAL) INTO QTD_32  FROM DUAL;
  SELECT SGS.FNC_ATS_TOT_ESPEC('33',pDT_INI_CONSULTA,pDT_FIM_CONSULTA, pCAD_UNI_ID_UNIDADE, pCAD_LAT_ID_LOCAL_ATENDIMENTO, pCAD_SET_ID, PERCENTUAL) INTO QTD_33  FROM DUAL;
  SELECT SGS.FNC_ATS_TOT_ESPEC('34',pDT_INI_CONSULTA,pDT_FIM_CONSULTA, pCAD_UNI_ID_UNIDADE, pCAD_LAT_ID_LOCAL_ATENDIMENTO, pCAD_SET_ID, PERCENTUAL) INTO QTD_34  FROM DUAL;
  SELECT SGS.FNC_ATS_TOT_ESPEC('36',pDT_INI_CONSULTA,pDT_FIM_CONSULTA, pCAD_UNI_ID_UNIDADE, pCAD_LAT_ID_LOCAL_ATENDIMENTO, pCAD_SET_ID, PERCENTUAL) INTO QTD_36  FROM DUAL;
  SELECT SGS.FNC_ATS_TOT_ESPEC('39',pDT_INI_CONSULTA,pDT_FIM_CONSULTA, pCAD_UNI_ID_UNIDADE, pCAD_LAT_ID_LOCAL_ATENDIMENTO, pCAD_SET_ID, PERCENTUAL) INTO QTD_39  FROM DUAL;
  SELECT SGS.FNC_ATS_TOT_ESPEC('40',pDT_INI_CONSULTA,pDT_FIM_CONSULTA, pCAD_UNI_ID_UNIDADE, pCAD_LAT_ID_LOCAL_ATENDIMENTO, pCAD_SET_ID, PERCENTUAL) INTO QTD_40  FROM DUAL;
  SELECT SGS.FNC_ATS_TOT_ESPEC('45',pDT_INI_CONSULTA,pDT_FIM_CONSULTA, pCAD_UNI_ID_UNIDADE, pCAD_LAT_ID_LOCAL_ATENDIMENTO, pCAD_SET_ID, PERCENTUAL) INTO QTD_45  FROM DUAL;  
  SELECT SGS.FNC_ATS_TOT_ESPEC('56',pDT_INI_CONSULTA,pDT_FIM_CONSULTA, pCAD_UNI_ID_UNIDADE, pCAD_LAT_ID_LOCAL_ATENDIMENTO, pCAD_SET_ID, PERCENTUAL) INTO QTD_56  FROM DUAL;
  
  
  QTD_33:= QTD_33+1;
/*IF QTD_20 IS NOT NULL AND QTD_20 > 0 THEN QTD_20:= ROUND((PERCENTUAL*QTD_20)/100);     ELSE QTD_20:=0; END IF;
IF QTD_21 IS NOT NULL AND QTD_21 > 0 THEN QTD_21:= ROUND((PERCENTUAL*QTD_21)/100);     ELSE QTD_21:=0; END IF;
IF QTD_22 IS NOT NULL AND QTD_22 > 0 THEN QTD_22:= ROUND((PERCENTUAL*QTD_22)/100);     ELSE QTD_22:=0; END IF;
IF QTD_23 IS NOT NULL AND QTD_23 > 0 THEN QTD_23:= ROUND((PERCENTUAL*QTD_23)/100);     ELSE QTD_23:=0; END IF;
IF QTD_29 IS NOT NULL AND QTD_29 > 0 THEN QTD_29:= ROUND((PERCENTUAL*QTD_29)/100);     ELSE QTD_29:=0; END IF;
IF QTD_32 IS NOT NULL AND QTD_32 > 0 THEN QTD_32:= ROUND((PERCENTUAL*QTD_32)/100);     ELSE QTD_32:=0; END IF;
IF QTD_33 IS NOT NULL AND QTD_33 > 0 THEN QTD_33:= ROUND((PERCENTUAL*QTD_33)/100);     ELSE QTD_33:=0; END IF;
IF QTD_34 IS NOT NULL AND QTD_34 > 0 THEN QTD_34:= ROUND((PERCENTUAL*QTD_34)/100);     ELSE QTD_34:=0; END IF;
IF QTD_36 IS NOT NULL AND QTD_36 > 0 THEN QTD_36:= ROUND((PERCENTUAL*QTD_36)/100);     ELSE QTD_36:=0; END IF;
IF QTD_39 IS NOT NULL AND QTD_39 > 0 THEN QTD_39:= ROUND((PERCENTUAL*QTD_39)/100);     ELSE QTD_39:=0; END IF;
IF QTD_40 IS NOT NULL AND QTD_40 > 0 THEN QTD_40:= ROUND((PERCENTUAL*QTD_40)/100);     ELSE QTD_40:=0; END IF;
IF QTD_45 IS NOT NULL AND QTD_45 > 0 THEN QTD_45:= ROUND((PERCENTUAL*QTD_45)/100);     ELSE QTD_45:=0; END IF;
IF QTD_56 IS NOT NULL AND QTD_56 > 0 THEN QTD_56:= ROUND((PERCENTUAL*QTD_56)/100);     ELSE QTD_56:=0; END IF;*/

    

  OPEN v_cursor FOR

    SELECT 
    A.CAD_UNI_DS_UNIDADE UNIDADE,
        A.CAD_LAT_DS_LOCAL_ATENDIMENTO LOCAL,
        A.CAD_SET_DS_SETOR SETOR_EXEC,
        A.AUX_EPP_DS_DESCRICAO ESPECIALIDADE,
        A.CAD_PRD_DS_DESCRICAO PROCEDIMENTO, 
        A.ATS_ATE_CD_INTLIB ATENDIMENTO,
        A.ATS_ATE_IN_INTLIB TIPO_ATENDIMENTO,
        A.ATS_ATE_ID NUMERO_EXAME,                       
        A.ATS_ATE_DT_REALIZ_PROCED DT_REALIZ,
        A.ATS_ATE_HR_REALIZ_PROCED HR_REALIZ,
        A.CAD_PES_NM_PESSOA NM_PACIENTE,
        A.CAD_PES_DT_NASCIMENTO DT_NASCIMENTO,
        A.CAD_PRO_NM_NOME NM_PROFISSIONAL,    
        A.CAD_PAC_NR_PRONTUARIO PRONTUARIO,
        A.ATS_ATE_FL_REPETICAO REPETICAO,        
        TOTAL_LAUDOS TOTAL_LAUDOS,
        CASE WHEN TOTAL_LAUDOS  > 0 THEN ROUND((7*TOTAL_LAUDOS )/100) ELSE 0 END QTD_POR_PCT_TOTAL_LAUDOS,
        QTD_20 QTD_POR_ESPEC
        
        FROM (
  SELECT
        ATS.ATS_ATE_DT_REALIZ_PROCED,
        ATS.ATS_ATE_HR_REALIZ_PROCED,
        ATS.ATS_ATE_CD_INTLIB,
        ATS.ATS_ATE_IN_INTLIB,
        ATS.ATS_ATE_ID,
        PRD.CAD_PRD_DS_DESCRICAO,
        EPP.AUX_EPP_DS_DESCRICAO,      
        ATS.ATS_ATE_FL_STATUS,
        PES_PAC.CAD_PES_NM_PESSOA ,
        PES_PAC.CAD_PES_DT_NASCIMENTO,
        PRO.CAD_PRO_NM_NOME ,    
        PAC.CAD_PAC_NR_PRONTUARIO,
        ATS.ATS_ATE_FL_REPETICAO,
        UNI.CAD_UNI_DS_UNIDADE,
        LAT.CAD_LAT_DS_LOCAL_ATENDIMENTO,
        SETOR_EXEC.CAD_SET_DS_SETOR         
        
   FROM TB_ATS_ATE_ATENDIMENTO_SADT ATS
   JOIN TB_ATS_APL_ATEN_PROCED_LAUDO APL   ON APL.ATS_ATE_CD_INTLIB = ATS.ATS_ATE_CD_INTLIB
        AND APL.ATS_ATE_ID = ATS.ATS_ATE_ID
        AND APL.CAD_PRD_ID = ATS.CAD_PRD_ID
        AND APL.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
        AND APL.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC
        AND APL.ATS_ATE_IN_INTLIB = ATS.ATS_ATE_IN_INTLIB
  
   JOIN TB_CAD_PRD_PRODUTO PRD                  ON PRD.CAD_PRD_ID = ATS.CAD_PRD_ID
   JOIN TB_AUX_EPP_ESPECPROC EPP                ON EPP.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC AND EPP.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
   JOIN TB_CAD_PAC_PACIENTE PAC                 ON PAC.CAD_PAC_ID_PACIENTE = ATS.CAD_PAC_ID_PACIENTE_INT
   JOIN TB_CAD_PES_PESSOA PES_PAC               ON PES_PAC.CAD_PES_ID_PESSOA = PAC.CAD_PES_ID_PESSOA
    JOIN TB_CAD_PRO_PROFISSIONAL PRO        ON PRO.CAD_PRO_ID_PROFISSIONAL = APL.CAD_PRO_ID_PROF
   JOIN TB_CAD_SET_SETOR SETOR_EXEC        ON SETOR_EXEC.CAD_SET_ID = ATS.CAD_SET_ID_ATEN
   JOIN TB_CAD_UNI_UNIDADE UNI             ON UNI.CAD_UNI_ID_UNIDADE = SETOR_EXEC.CAD_UNI_ID_UNIDADE
   JOIN TB_CAD_LAT_LOCAL_ATENDIMENTO LAT   ON LAT.CAD_LAT_ID_LOCAL_ATENDIMENTO = SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO
      
    WHERE (ATS.ATS_ATE_FL_STATUS <> 'C')
    AND ATS.ATS_ATE_DT_REALIZ_PROCED BETWEEN pDT_INI_CONSULTA AND pDT_FIM_CONSULTA

    AND ((pAUX_EPP_CD_ESPECPROC IS NOT NULL AND PAUX_EPP_CD_ESPECPROC = '20' AND ATS.AUX_EPP_CD_ESPECPROC = '20')  OR pAUX_EPP_CD_ESPECPROC IS NULL AND ATS.AUX_EPP_CD_ESPECPROC='20')
    AND (pCAD_UNI_ID_UNIDADE IS NULL OR SETOR_EXEC.CAD_UNI_ID_UNIDADE = pCAD_UNI_ID_UNIDADE)
     AND (pCAD_LAT_ID_LOCAL_ATENDIMENTO IS NULL OR  SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO = pCAD_LAT_ID_LOCAL_ATENDIMENTO)
     AND (pCAD_SET_ID IS NULL OR SETOR_EXEC.CAD_SET_ID = pCAD_SET_ID)
    ORDER BY DBMS_RANDOM.VALUE FETCH NEXT QTD_20 ROWS ONLY
    ) A
    
UNION ALL

    SELECT 
        A.CAD_UNI_DS_UNIDADE UNIDADE,
        A.CAD_LAT_DS_LOCAL_ATENDIMENTO LOCAL,
        A.CAD_SET_DS_SETOR SETOR_EXEC,
        A.AUX_EPP_DS_DESCRICAO ESPECIALIDADE,
        A.CAD_PRD_DS_DESCRICAO PROCEDIMENTO, 
        A.ATS_ATE_CD_INTLIB ATENDIMENTO,
        A.ATS_ATE_IN_INTLIB TIPO_ATENDIMENTO,
        A.ATS_ATE_ID NUMERO_EXAME,                       
        A.ATS_ATE_DT_REALIZ_PROCED DT_REALIZ,
        A.ATS_ATE_HR_REALIZ_PROCED HR_REALIZ,
        A.CAD_PES_NM_PESSOA NM_PACIENTE,
        A.CAD_PES_DT_NASCIMENTO DT_NASCIMENTO,
        A.CAD_PRO_NM_NOME NM_PROFISSIONAL,    
        A.CAD_PAC_NR_PRONTUARIO PRONTUARIO,
        A.ATS_ATE_FL_REPETICAO REPETICAO,        
        TOTAL_LAUDOS,
        CASE WHEN TOTAL_LAUDOS  > 0 THEN ROUND((7*TOTAL_LAUDOS )/100) ELSE 0 END QTD_POR_PCT_TOTAL_LAUDOS,
        QTD_21
        
        FROM (
    SELECT
        ATS.ATS_ATE_DT_REALIZ_PROCED,
        ATS.ATS_ATE_HR_REALIZ_PROCED,
        ATS.ATS_ATE_CD_INTLIB,
        ATS.ATS_ATE_IN_INTLIB,
        ATS.ATS_ATE_ID,
        PRD.CAD_PRD_DS_DESCRICAO,
        EPP.AUX_EPP_DS_DESCRICAO,      
        ATS.ATS_ATE_FL_STATUS,
        PES_PAC.CAD_PES_NM_PESSOA ,
        PES_PAC.CAD_PES_DT_NASCIMENTO,
        PRO.CAD_PRO_NM_NOME ,    
        PAC.CAD_PAC_NR_PRONTUARIO,
        ATS.ATS_ATE_FL_REPETICAO,
        UNI.CAD_UNI_DS_UNIDADE,
        LAT.CAD_LAT_DS_LOCAL_ATENDIMENTO,
        SETOR_EXEC.CAD_SET_DS_SETOR 
                
   FROM TB_ATS_ATE_ATENDIMENTO_SADT ATS
   JOIN TB_ATS_APL_ATEN_PROCED_LAUDO APL   ON APL.ATS_ATE_CD_INTLIB = ATS.ATS_ATE_CD_INTLIB
        AND APL.ATS_ATE_ID = ATS.ATS_ATE_ID
        AND APL.CAD_PRD_ID = ATS.CAD_PRD_ID
        AND APL.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
        AND APL.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC
        AND APL.ATS_ATE_IN_INTLIB = ATS.ATS_ATE_IN_INTLIB
  
   JOIN TB_CAD_PRD_PRODUTO PRD                  ON PRD.CAD_PRD_ID = ATS.CAD_PRD_ID
   JOIN TB_AUX_EPP_ESPECPROC EPP                ON EPP.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC AND EPP.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
   JOIN TB_CAD_PAC_PACIENTE PAC                 ON PAC.CAD_PAC_ID_PACIENTE = ATS.CAD_PAC_ID_PACIENTE_INT
   JOIN TB_CAD_PES_PESSOA PES_PAC               ON PES_PAC.CAD_PES_ID_PESSOA = PAC.CAD_PES_ID_PESSOA
    JOIN TB_CAD_PRO_PROFISSIONAL PRO        ON PRO.CAD_PRO_ID_PROFISSIONAL = APL.CAD_PRO_ID_PROF
      JOIN TB_CAD_SET_SETOR SETOR_EXEC        ON SETOR_EXEC.CAD_SET_ID = ATS.CAD_SET_ID_ATEN
   JOIN TB_CAD_UNI_UNIDADE UNI             ON UNI.CAD_UNI_ID_UNIDADE = SETOR_EXEC.CAD_UNI_ID_UNIDADE
   JOIN TB_CAD_LAT_LOCAL_ATENDIMENTO LAT   ON LAT.CAD_LAT_ID_LOCAL_ATENDIMENTO = SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO
   
    WHERE (ATS.ATS_ATE_FL_STATUS <> 'C')
    AND ATS.ATS_ATE_DT_REALIZ_PROCED BETWEEN pDT_INI_CONSULTA AND pDT_FIM_CONSULTA

    AND ((pAUX_EPP_CD_ESPECPROC IS NOT NULL AND PAUX_EPP_CD_ESPECPROC = '21' AND ATS.AUX_EPP_CD_ESPECPROC = '21')  OR pAUX_EPP_CD_ESPECPROC IS NULL AND ATS.AUX_EPP_CD_ESPECPROC='21')
    AND (pCAD_UNI_ID_UNIDADE IS NULL OR SETOR_EXEC.CAD_UNI_ID_UNIDADE = pCAD_UNI_ID_UNIDADE)
     AND (pCAD_LAT_ID_LOCAL_ATENDIMENTO IS NULL OR  SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO = pCAD_LAT_ID_LOCAL_ATENDIMENTO)
     AND (pCAD_SET_ID IS NULL OR SETOR_EXEC.CAD_SET_ID = pCAD_SET_ID)
    ORDER BY DBMS_RANDOM.VALUE FETCH NEXT QTD_21 ROWS ONLY
    ) A

UNION ALL

    SELECT 
    A.CAD_UNI_DS_UNIDADE UNIDADE,
        A.CAD_LAT_DS_LOCAL_ATENDIMENTO LOCAL,
        A.CAD_SET_DS_SETOR SETOR_EXEC,
        A.AUX_EPP_DS_DESCRICAO ESPECIALIDADE,
        A.CAD_PRD_DS_DESCRICAO PROCEDIMENTO, 
        A.ATS_ATE_CD_INTLIB ATENDIMENTO,
        A.ATS_ATE_IN_INTLIB TIPO_ATENDIMENTO,
        A.ATS_ATE_ID NUMERO_EXAME,                       
        A.ATS_ATE_DT_REALIZ_PROCED DT_REALIZ,
        A.ATS_ATE_HR_REALIZ_PROCED HR_REALIZ,
        A.CAD_PES_NM_PESSOA NM_PACIENTE,
        A.CAD_PES_DT_NASCIMENTO DT_NASCIMENTO,
        A.CAD_PRO_NM_NOME NM_PROFISSIONAL,    
        A.CAD_PAC_NR_PRONTUARIO PRONTUARIO,
        A.ATS_ATE_FL_REPETICAO REPETICAO,        
        TOTAL_LAUDOS,
        CASE WHEN TOTAL_LAUDOS  > 0 THEN ROUND((7*TOTAL_LAUDOS )/100) ELSE 0 END QTD_POR_PCT_TOTAL_LAUDOS,
        QTD_22
        
        FROM (
  SELECT
        ATS.ATS_ATE_DT_REALIZ_PROCED,
        ATS.ATS_ATE_HR_REALIZ_PROCED,
        ATS.ATS_ATE_CD_INTLIB,
        ATS.ATS_ATE_IN_INTLIB,
        ATS.ATS_ATE_ID,
        PRD.CAD_PRD_DS_DESCRICAO,
        EPP.AUX_EPP_DS_DESCRICAO,      
        ATS.ATS_ATE_FL_STATUS,
        PES_PAC.CAD_PES_NM_PESSOA ,
        PES_PAC.CAD_PES_DT_NASCIMENTO,
        PRO.CAD_PRO_NM_NOME ,    
        PAC.CAD_PAC_NR_PRONTUARIO,
        ATS.ATS_ATE_FL_REPETICAO,
        UNI.CAD_UNI_DS_UNIDADE,
        LAT.CAD_LAT_DS_LOCAL_ATENDIMENTO,
        SETOR_EXEC.CAD_SET_DS_SETOR 
                
   FROM TB_ATS_ATE_ATENDIMENTO_SADT ATS
   JOIN TB_ATS_APL_ATEN_PROCED_LAUDO APL   ON APL.ATS_ATE_CD_INTLIB = ATS.ATS_ATE_CD_INTLIB
        AND APL.ATS_ATE_ID = ATS.ATS_ATE_ID
        AND APL.CAD_PRD_ID = ATS.CAD_PRD_ID
        AND APL.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
        AND APL.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC
        AND APL.ATS_ATE_IN_INTLIB = ATS.ATS_ATE_IN_INTLIB
  
   JOIN TB_CAD_PRD_PRODUTO PRD                  ON PRD.CAD_PRD_ID = ATS.CAD_PRD_ID
   JOIN TB_AUX_EPP_ESPECPROC EPP                ON EPP.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC AND EPP.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
   JOIN TB_CAD_PAC_PACIENTE PAC                 ON PAC.CAD_PAC_ID_PACIENTE = ATS.CAD_PAC_ID_PACIENTE_INT
   JOIN TB_CAD_PES_PESSOA PES_PAC               ON PES_PAC.CAD_PES_ID_PESSOA = PAC.CAD_PES_ID_PESSOA
    JOIN TB_CAD_PRO_PROFISSIONAL PRO        ON PRO.CAD_PRO_ID_PROFISSIONAL = APL.CAD_PRO_ID_PROF
      JOIN TB_CAD_SET_SETOR SETOR_EXEC        ON SETOR_EXEC.CAD_SET_ID = ATS.CAD_SET_ID_ATEN
   JOIN TB_CAD_UNI_UNIDADE UNI             ON UNI.CAD_UNI_ID_UNIDADE = SETOR_EXEC.CAD_UNI_ID_UNIDADE
   JOIN TB_CAD_LAT_LOCAL_ATENDIMENTO LAT   ON LAT.CAD_LAT_ID_LOCAL_ATENDIMENTO = SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO
   
    WHERE (ATS.ATS_ATE_FL_STATUS <> 'C')
    AND ATS.ATS_ATE_DT_REALIZ_PROCED BETWEEN pDT_INI_CONSULTA AND pDT_FIM_CONSULTA

    AND ((pAUX_EPP_CD_ESPECPROC IS NOT NULL AND PAUX_EPP_CD_ESPECPROC = '22' AND ATS.AUX_EPP_CD_ESPECPROC = '22')  OR pAUX_EPP_CD_ESPECPROC IS NULL AND ATS.AUX_EPP_CD_ESPECPROC='22')
    AND (pCAD_UNI_ID_UNIDADE IS NULL OR SETOR_EXEC.CAD_UNI_ID_UNIDADE = pCAD_UNI_ID_UNIDADE)
     AND (pCAD_LAT_ID_LOCAL_ATENDIMENTO IS NULL OR  SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO = pCAD_LAT_ID_LOCAL_ATENDIMENTO)
     AND (pCAD_SET_ID IS NULL OR SETOR_EXEC.CAD_SET_ID = pCAD_SET_ID)
    ORDER BY DBMS_RANDOM.VALUE FETCH NEXT QTD_22 ROWS ONLY
    ) A
        
UNION ALL

    SELECT 
    A.CAD_UNI_DS_UNIDADE UNIDADE,
        A.CAD_LAT_DS_LOCAL_ATENDIMENTO LOCAL,
        A.CAD_SET_DS_SETOR SETOR_EXEC,
        A.AUX_EPP_DS_DESCRICAO ESPECIALIDADE,
        A.CAD_PRD_DS_DESCRICAO PROCEDIMENTO, 
        A.ATS_ATE_CD_INTLIB ATENDIMENTO,
        A.ATS_ATE_IN_INTLIB TIPO_ATENDIMENTO,
        A.ATS_ATE_ID NUMERO_EXAME,                       
        A.ATS_ATE_DT_REALIZ_PROCED DT_REALIZ,
        A.ATS_ATE_HR_REALIZ_PROCED HR_REALIZ,
        A.CAD_PES_NM_PESSOA NM_PACIENTE,
        A.CAD_PES_DT_NASCIMENTO DT_NASCIMENTO,
        A.CAD_PRO_NM_NOME NM_PROFISSIONAL,    
        A.CAD_PAC_NR_PRONTUARIO PRONTUARIO,
        A.ATS_ATE_FL_REPETICAO REPETICAO,        
        TOTAL_LAUDOS,
        CASE WHEN TOTAL_LAUDOS  > 0 THEN ROUND((7*TOTAL_LAUDOS )/100) ELSE 0 END QTD_POR_PCT_TOTAL_LAUDOS,
        QTD_23
        
        FROM (
  SELECT
        ATS.ATS_ATE_DT_REALIZ_PROCED,
        ATS.ATS_ATE_HR_REALIZ_PROCED,
        ATS.ATS_ATE_CD_INTLIB,
        ATS.ATS_ATE_IN_INTLIB,
        ATS.ATS_ATE_ID,
        PRD.CAD_PRD_DS_DESCRICAO,
        EPP.AUX_EPP_DS_DESCRICAO,      
        ATS.ATS_ATE_FL_STATUS,
        PES_PAC.CAD_PES_NM_PESSOA ,
        PES_PAC.CAD_PES_DT_NASCIMENTO,
        PRO.CAD_PRO_NM_NOME ,    
        PAC.CAD_PAC_NR_PRONTUARIO,
        ATS.ATS_ATE_FL_REPETICAO,
        UNI.CAD_UNI_DS_UNIDADE,
        LAT.CAD_LAT_DS_LOCAL_ATENDIMENTO,
        SETOR_EXEC.CAD_SET_DS_SETOR 
                
   FROM TB_ATS_ATE_ATENDIMENTO_SADT ATS
   JOIN TB_ATS_APL_ATEN_PROCED_LAUDO APL   ON APL.ATS_ATE_CD_INTLIB = ATS.ATS_ATE_CD_INTLIB
        AND APL.ATS_ATE_ID = ATS.ATS_ATE_ID
        AND APL.CAD_PRD_ID = ATS.CAD_PRD_ID
        AND APL.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
        AND APL.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC
        AND APL.ATS_ATE_IN_INTLIB = ATS.ATS_ATE_IN_INTLIB
  
   JOIN TB_CAD_PRD_PRODUTO PRD                  ON PRD.CAD_PRD_ID = ATS.CAD_PRD_ID
   JOIN TB_AUX_EPP_ESPECPROC EPP                ON EPP.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC AND EPP.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
   JOIN TB_CAD_PAC_PACIENTE PAC                 ON PAC.CAD_PAC_ID_PACIENTE = ATS.CAD_PAC_ID_PACIENTE_INT
   JOIN TB_CAD_PES_PESSOA PES_PAC               ON PES_PAC.CAD_PES_ID_PESSOA = PAC.CAD_PES_ID_PESSOA
    JOIN TB_CAD_PRO_PROFISSIONAL PRO        ON PRO.CAD_PRO_ID_PROFISSIONAL = APL.CAD_PRO_ID_PROF
      JOIN TB_CAD_SET_SETOR SETOR_EXEC        ON SETOR_EXEC.CAD_SET_ID = ATS.CAD_SET_ID_ATEN
   JOIN TB_CAD_UNI_UNIDADE UNI             ON UNI.CAD_UNI_ID_UNIDADE = SETOR_EXEC.CAD_UNI_ID_UNIDADE
   JOIN TB_CAD_LAT_LOCAL_ATENDIMENTO LAT   ON LAT.CAD_LAT_ID_LOCAL_ATENDIMENTO = SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO
   
    WHERE (ATS.ATS_ATE_FL_STATUS <> 'C')
    AND ATS.ATS_ATE_DT_REALIZ_PROCED BETWEEN pDT_INI_CONSULTA AND pDT_FIM_CONSULTA

    AND ((pAUX_EPP_CD_ESPECPROC IS NOT NULL AND PAUX_EPP_CD_ESPECPROC = '23' AND ATS.AUX_EPP_CD_ESPECPROC = '23')  OR pAUX_EPP_CD_ESPECPROC IS NULL AND ATS.AUX_EPP_CD_ESPECPROC='23')
    AND (pCAD_UNI_ID_UNIDADE IS NULL OR SETOR_EXEC.CAD_UNI_ID_UNIDADE = pCAD_UNI_ID_UNIDADE)
     AND (pCAD_LAT_ID_LOCAL_ATENDIMENTO IS NULL OR  SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO = pCAD_LAT_ID_LOCAL_ATENDIMENTO)
     AND (pCAD_SET_ID IS NULL OR SETOR_EXEC.CAD_SET_ID = pCAD_SET_ID)
    ORDER BY DBMS_RANDOM.VALUE FETCH NEXT QTD_23 ROWS ONLY
    ) A
    
UNION ALL

    SELECT 
    A.CAD_UNI_DS_UNIDADE UNIDADE,
        A.CAD_LAT_DS_LOCAL_ATENDIMENTO LOCAL,
        A.CAD_SET_DS_SETOR SETOR_EXEC,
        A.AUX_EPP_DS_DESCRICAO ESPECIALIDADE,
        A.CAD_PRD_DS_DESCRICAO PROCEDIMENTO, 
        A.ATS_ATE_CD_INTLIB ATENDIMENTO,
        A.ATS_ATE_IN_INTLIB TIPO_ATENDIMENTO,
        A.ATS_ATE_ID NUMERO_EXAME,                       
        A.ATS_ATE_DT_REALIZ_PROCED DT_REALIZ,
        A.ATS_ATE_HR_REALIZ_PROCED HR_REALIZ,
        A.CAD_PES_NM_PESSOA NM_PACIENTE,
        A.CAD_PES_DT_NASCIMENTO DT_NASCIMENTO,
        A.CAD_PRO_NM_NOME NM_PROFISSIONAL,    
        A.CAD_PAC_NR_PRONTUARIO PRONTUARIO,
        A.ATS_ATE_FL_REPETICAO REPETICAO,        
        TOTAL_LAUDOS,
        CASE WHEN TOTAL_LAUDOS  > 0 THEN ROUND((7*TOTAL_LAUDOS )/100) ELSE 0 END QTD_POR_PCT_TOTAL_LAUDOS,
        QTD_29
        
        FROM (
  SELECT
        ATS.ATS_ATE_DT_REALIZ_PROCED,
        ATS.ATS_ATE_HR_REALIZ_PROCED,
        ATS.ATS_ATE_CD_INTLIB,
        ATS.ATS_ATE_IN_INTLIB,
        ATS.ATS_ATE_ID,
        PRD.CAD_PRD_DS_DESCRICAO,
        EPP.AUX_EPP_DS_DESCRICAO,      
        ATS.ATS_ATE_FL_STATUS,
        PES_PAC.CAD_PES_NM_PESSOA ,
        PES_PAC.CAD_PES_DT_NASCIMENTO,
        PRO.CAD_PRO_NM_NOME ,    
        PAC.CAD_PAC_NR_PRONTUARIO,
        ATS.ATS_ATE_FL_REPETICAO,
        UNI.CAD_UNI_DS_UNIDADE,
        LAT.CAD_LAT_DS_LOCAL_ATENDIMENTO,
        SETOR_EXEC.CAD_SET_DS_SETOR         
        
   FROM TB_ATS_ATE_ATENDIMENTO_SADT ATS
   JOIN TB_ATS_APL_ATEN_PROCED_LAUDO APL   ON APL.ATS_ATE_CD_INTLIB = ATS.ATS_ATE_CD_INTLIB
        AND APL.ATS_ATE_ID = ATS.ATS_ATE_ID
        AND APL.CAD_PRD_ID = ATS.CAD_PRD_ID
        AND APL.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
        AND APL.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC
        AND APL.ATS_ATE_IN_INTLIB = ATS.ATS_ATE_IN_INTLIB
  
   JOIN TB_CAD_PRD_PRODUTO PRD                  ON PRD.CAD_PRD_ID = ATS.CAD_PRD_ID
   JOIN TB_AUX_EPP_ESPECPROC EPP                ON EPP.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC AND EPP.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
   JOIN TB_CAD_PAC_PACIENTE PAC                 ON PAC.CAD_PAC_ID_PACIENTE = ATS.CAD_PAC_ID_PACIENTE_INT
   JOIN TB_CAD_PES_PESSOA PES_PAC               ON PES_PAC.CAD_PES_ID_PESSOA = PAC.CAD_PES_ID_PESSOA
    JOIN TB_CAD_PRO_PROFISSIONAL PRO        ON PRO.CAD_PRO_ID_PROFISSIONAL = APL.CAD_PRO_ID_PROF
      JOIN TB_CAD_SET_SETOR SETOR_EXEC        ON SETOR_EXEC.CAD_SET_ID = ATS.CAD_SET_ID_ATEN
   JOIN TB_CAD_UNI_UNIDADE UNI             ON UNI.CAD_UNI_ID_UNIDADE = SETOR_EXEC.CAD_UNI_ID_UNIDADE
   JOIN TB_CAD_LAT_LOCAL_ATENDIMENTO LAT   ON LAT.CAD_LAT_ID_LOCAL_ATENDIMENTO = SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO
   
    WHERE (ATS.ATS_ATE_FL_STATUS <> 'C')
    AND ATS.ATS_ATE_DT_REALIZ_PROCED BETWEEN pDT_INI_CONSULTA AND pDT_FIM_CONSULTA

    AND ((pAUX_EPP_CD_ESPECPROC IS NOT NULL AND PAUX_EPP_CD_ESPECPROC = '29' AND ATS.AUX_EPP_CD_ESPECPROC = '29')  OR pAUX_EPP_CD_ESPECPROC IS NULL AND ATS.AUX_EPP_CD_ESPECPROC='29')
    AND (pCAD_UNI_ID_UNIDADE IS NULL OR SETOR_EXEC.CAD_UNI_ID_UNIDADE = pCAD_UNI_ID_UNIDADE)
     AND (pCAD_LAT_ID_LOCAL_ATENDIMENTO IS NULL OR  SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO = pCAD_LAT_ID_LOCAL_ATENDIMENTO)
     AND (pCAD_SET_ID IS NULL OR SETOR_EXEC.CAD_SET_ID = pCAD_SET_ID)
    ORDER BY DBMS_RANDOM.VALUE FETCH NEXT QTD_29 ROWS ONLY
    ) A
    
UNION ALL
        
    SELECT 
        A.CAD_UNI_DS_UNIDADE UNIDADE,
        A.CAD_LAT_DS_LOCAL_ATENDIMENTO LOCAL,
        A.CAD_SET_DS_SETOR SETOR_EXEC,
        A.AUX_EPP_DS_DESCRICAO ESPECIALIDADE,
        A.CAD_PRD_DS_DESCRICAO PROCEDIMENTO, 
        A.ATS_ATE_CD_INTLIB ATENDIMENTO,
        A.ATS_ATE_IN_INTLIB TIPO_ATENDIMENTO,
        A.ATS_ATE_ID NUMERO_EXAME,                       
        A.ATS_ATE_DT_REALIZ_PROCED DT_REALIZ,
        A.ATS_ATE_HR_REALIZ_PROCED HR_REALIZ,
        A.CAD_PES_NM_PESSOA NM_PACIENTE,
        A.CAD_PES_DT_NASCIMENTO DT_NASCIMENTO,
        A.CAD_PRO_NM_NOME NM_PROFISSIONAL,    
        A.CAD_PAC_NR_PRONTUARIO PRONTUARIO,
        A.ATS_ATE_FL_REPETICAO REPETICAO,        
        TOTAL_LAUDOS,
        CASE WHEN TOTAL_LAUDOS  > 0 THEN ROUND((7*TOTAL_LAUDOS )/100) ELSE 0 END QTD_POR_PCT_TOTAL_LAUDOS,
        QTD_32
        
        FROM (
  SELECT
        ATS.ATS_ATE_DT_REALIZ_PROCED,
        ATS.ATS_ATE_HR_REALIZ_PROCED,
        ATS.ATS_ATE_CD_INTLIB,
        ATS.ATS_ATE_IN_INTLIB,
        ATS.ATS_ATE_ID,
        PRD.CAD_PRD_DS_DESCRICAO,
        EPP.AUX_EPP_DS_DESCRICAO,      
        ATS.ATS_ATE_FL_STATUS,
        PES_PAC.CAD_PES_NM_PESSOA ,
        PES_PAC.CAD_PES_DT_NASCIMENTO,
        PRO.CAD_PRO_NM_NOME ,    
        PAC.CAD_PAC_NR_PRONTUARIO,
        ATS.ATS_ATE_FL_REPETICAO,
        UNI.CAD_UNI_DS_UNIDADE,
        LAT.CAD_LAT_DS_LOCAL_ATENDIMENTO,
        SETOR_EXEC.CAD_SET_DS_SETOR         
        
   FROM TB_ATS_ATE_ATENDIMENTO_SADT ATS
   JOIN TB_ATS_APL_ATEN_PROCED_LAUDO APL   ON APL.ATS_ATE_CD_INTLIB = ATS.ATS_ATE_CD_INTLIB
        AND APL.ATS_ATE_ID = ATS.ATS_ATE_ID
        AND APL.CAD_PRD_ID = ATS.CAD_PRD_ID
        AND APL.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
        AND APL.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC
        AND APL.ATS_ATE_IN_INTLIB = ATS.ATS_ATE_IN_INTLIB
  
   JOIN TB_CAD_PRD_PRODUTO PRD                  ON PRD.CAD_PRD_ID = ATS.CAD_PRD_ID
   JOIN TB_AUX_EPP_ESPECPROC EPP                ON EPP.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC AND EPP.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
   JOIN TB_CAD_PAC_PACIENTE PAC                 ON PAC.CAD_PAC_ID_PACIENTE = ATS.CAD_PAC_ID_PACIENTE_INT
   JOIN TB_CAD_PES_PESSOA PES_PAC               ON PES_PAC.CAD_PES_ID_PESSOA = PAC.CAD_PES_ID_PESSOA
    JOIN TB_CAD_PRO_PROFISSIONAL PRO        ON PRO.CAD_PRO_ID_PROFISSIONAL = APL.CAD_PRO_ID_PROF
      JOIN TB_CAD_SET_SETOR SETOR_EXEC        ON SETOR_EXEC.CAD_SET_ID = ATS.CAD_SET_ID_ATEN
   JOIN TB_CAD_UNI_UNIDADE UNI             ON UNI.CAD_UNI_ID_UNIDADE = SETOR_EXEC.CAD_UNI_ID_UNIDADE
   JOIN TB_CAD_LAT_LOCAL_ATENDIMENTO LAT   ON LAT.CAD_LAT_ID_LOCAL_ATENDIMENTO = SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO
   
    WHERE (ATS.ATS_ATE_FL_STATUS <> 'C')
    AND ATS.ATS_ATE_DT_REALIZ_PROCED BETWEEN pDT_INI_CONSULTA AND pDT_FIM_CONSULTA

    AND ((pAUX_EPP_CD_ESPECPROC IS NOT NULL AND PAUX_EPP_CD_ESPECPROC = '32' AND ATS.AUX_EPP_CD_ESPECPROC = '32')  OR pAUX_EPP_CD_ESPECPROC IS NULL AND ATS.AUX_EPP_CD_ESPECPROC='32')
    AND (pCAD_UNI_ID_UNIDADE IS NULL OR SETOR_EXEC.CAD_UNI_ID_UNIDADE = pCAD_UNI_ID_UNIDADE)
     AND (pCAD_LAT_ID_LOCAL_ATENDIMENTO IS NULL OR  SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO = pCAD_LAT_ID_LOCAL_ATENDIMENTO)
     AND (pCAD_SET_ID IS NULL OR SETOR_EXEC.CAD_SET_ID = pCAD_SET_ID)
    ORDER BY DBMS_RANDOM.VALUE FETCH NEXT QTD_32 ROWS ONLY
    ) A
    
UNION ALL

    SELECT 
        A.CAD_UNI_DS_UNIDADE UNIDADE,
        A.CAD_LAT_DS_LOCAL_ATENDIMENTO LOCAL,
        A.CAD_SET_DS_SETOR SETOR_EXEC,
        A.AUX_EPP_DS_DESCRICAO ESPECIALIDADE,
        A.CAD_PRD_DS_DESCRICAO PROCEDIMENTO, 
        A.ATS_ATE_CD_INTLIB ATENDIMENTO,
        A.ATS_ATE_IN_INTLIB TIPO_ATENDIMENTO,
        A.ATS_ATE_ID NUMERO_EXAME,                       
        A.ATS_ATE_DT_REALIZ_PROCED DT_REALIZ,
        A.ATS_ATE_HR_REALIZ_PROCED HR_REALIZ,
        A.CAD_PES_NM_PESSOA NM_PACIENTE,
        A.CAD_PES_DT_NASCIMENTO DT_NASCIMENTO,
        A.CAD_PRO_NM_NOME NM_PROFISSIONAL,    
        A.CAD_PAC_NR_PRONTUARIO PRONTUARIO,
        A.ATS_ATE_FL_REPETICAO REPETICAO,        
        TOTAL_LAUDOS,
        CASE WHEN TOTAL_LAUDOS  > 0 THEN ROUND((7*TOTAL_LAUDOS )/100) ELSE 0 END QTD_POR_PCT_TOTAL_LAUDOS,
        QTD_33
        
        FROM (
  SELECT
        ATS.ATS_ATE_DT_REALIZ_PROCED,
        ATS.ATS_ATE_HR_REALIZ_PROCED,
        ATS.ATS_ATE_CD_INTLIB,
        ATS.ATS_ATE_IN_INTLIB,
        ATS.ATS_ATE_ID,
        PRD.CAD_PRD_DS_DESCRICAO,
        EPP.AUX_EPP_DS_DESCRICAO,      
        ATS.ATS_ATE_FL_STATUS,
        PES_PAC.CAD_PES_NM_PESSOA ,
        PES_PAC.CAD_PES_DT_NASCIMENTO,
        PRO.CAD_PRO_NM_NOME ,    
        PAC.CAD_PAC_NR_PRONTUARIO,
        ATS.ATS_ATE_FL_REPETICAO,
        UNI.CAD_UNI_DS_UNIDADE,
        LAT.CAD_LAT_DS_LOCAL_ATENDIMENTO,
        SETOR_EXEC.CAD_SET_DS_SETOR 
                
   FROM TB_ATS_ATE_ATENDIMENTO_SADT ATS
   JOIN TB_ATS_APL_ATEN_PROCED_LAUDO APL   ON APL.ATS_ATE_CD_INTLIB = ATS.ATS_ATE_CD_INTLIB
        AND APL.ATS_ATE_ID = ATS.ATS_ATE_ID
        AND APL.CAD_PRD_ID = ATS.CAD_PRD_ID
        AND APL.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
        AND APL.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC
        AND APL.ATS_ATE_IN_INTLIB = ATS.ATS_ATE_IN_INTLIB
  
   JOIN TB_CAD_PRD_PRODUTO PRD                  ON PRD.CAD_PRD_ID = ATS.CAD_PRD_ID
   JOIN TB_AUX_EPP_ESPECPROC EPP                ON EPP.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC AND EPP.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
   JOIN TB_CAD_PAC_PACIENTE PAC                 ON PAC.CAD_PAC_ID_PACIENTE = ATS.CAD_PAC_ID_PACIENTE_INT
   JOIN TB_CAD_PES_PESSOA PES_PAC               ON PES_PAC.CAD_PES_ID_PESSOA = PAC.CAD_PES_ID_PESSOA
    JOIN TB_CAD_PRO_PROFISSIONAL PRO        ON PRO.CAD_PRO_ID_PROFISSIONAL = APL.CAD_PRO_ID_PROF
      JOIN TB_CAD_SET_SETOR SETOR_EXEC        ON SETOR_EXEC.CAD_SET_ID = ATS.CAD_SET_ID_ATEN
   JOIN TB_CAD_UNI_UNIDADE UNI             ON UNI.CAD_UNI_ID_UNIDADE = SETOR_EXEC.CAD_UNI_ID_UNIDADE
   JOIN TB_CAD_LAT_LOCAL_ATENDIMENTO LAT   ON LAT.CAD_LAT_ID_LOCAL_ATENDIMENTO = SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO
   
    WHERE (ATS.ATS_ATE_FL_STATUS <> 'C')
    AND ATS.ATS_ATE_DT_REALIZ_PROCED BETWEEN pDT_INI_CONSULTA AND pDT_FIM_CONSULTA

    AND ((pAUX_EPP_CD_ESPECPROC IS NOT NULL AND PAUX_EPP_CD_ESPECPROC = '33' AND ATS.AUX_EPP_CD_ESPECPROC = '33')  OR pAUX_EPP_CD_ESPECPROC IS NULL AND ATS.AUX_EPP_CD_ESPECPROC='33')
    AND (pCAD_UNI_ID_UNIDADE IS NULL OR SETOR_EXEC.CAD_UNI_ID_UNIDADE = pCAD_UNI_ID_UNIDADE)
     AND (pCAD_LAT_ID_LOCAL_ATENDIMENTO IS NULL OR  SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO = pCAD_LAT_ID_LOCAL_ATENDIMENTO)
     AND (pCAD_SET_ID IS NULL OR SETOR_EXEC.CAD_SET_ID = pCAD_SET_ID)
    ORDER BY DBMS_RANDOM.VALUE FETCH NEXT QTD_33 ROWS ONLY
    ) A
    
UNION ALL

    SELECT
        A.CAD_UNI_DS_UNIDADE UNIDADE,
        A.CAD_LAT_DS_LOCAL_ATENDIMENTO LOCAL,
        A.CAD_SET_DS_SETOR SETOR_EXEC ,
        A.AUX_EPP_DS_DESCRICAO ESPECIALIDADE,
        A.CAD_PRD_DS_DESCRICAO PROCEDIMENTO, 
        A.ATS_ATE_CD_INTLIB ATENDIMENTO,
        A.ATS_ATE_IN_INTLIB TIPO_ATENDIMENTO,
        A.ATS_ATE_ID NUMERO_EXAME,                       
        A.ATS_ATE_DT_REALIZ_PROCED DT_REALIZ,
        A.ATS_ATE_HR_REALIZ_PROCED HR_REALIZ,
        A.CAD_PES_NM_PESSOA NM_PACIENTE,
        A.CAD_PES_DT_NASCIMENTO DT_NASCIMENTO,
        A.CAD_PRO_NM_NOME NM_PROFISSIONAL,    
        A.CAD_PAC_NR_PRONTUARIO PRONTUARIO,
        A.ATS_ATE_FL_REPETICAO REPETICAO,        
        TOTAL_LAUDOS,
        CASE WHEN TOTAL_LAUDOS  > 0 THEN ROUND((7*TOTAL_LAUDOS )/100) ELSE 0 END QTD_POR_PCT_TOTAL_LAUDOS,
        QTD_34
        
        FROM (
  SELECT
        ATS.ATS_ATE_DT_REALIZ_PROCED,
        ATS.ATS_ATE_HR_REALIZ_PROCED,
        ATS.ATS_ATE_CD_INTLIB,
        ATS.ATS_ATE_IN_INTLIB,
        ATS.ATS_ATE_ID,
        PRD.CAD_PRD_DS_DESCRICAO,
        EPP.AUX_EPP_DS_DESCRICAO,      
        ATS.ATS_ATE_FL_STATUS,
        PES_PAC.CAD_PES_NM_PESSOA ,
        PES_PAC.CAD_PES_DT_NASCIMENTO,
        PRO.CAD_PRO_NM_NOME ,    
        PAC.CAD_PAC_NR_PRONTUARIO,
        ATS.ATS_ATE_FL_REPETICAO,
        UNI.CAD_UNI_DS_UNIDADE,
        LAT.CAD_LAT_DS_LOCAL_ATENDIMENTO,
        SETOR_EXEC.CAD_SET_DS_SETOR 
                
   FROM TB_ATS_ATE_ATENDIMENTO_SADT ATS
   JOIN TB_ATS_APL_ATEN_PROCED_LAUDO APL   ON APL.ATS_ATE_CD_INTLIB = ATS.ATS_ATE_CD_INTLIB
        AND APL.ATS_ATE_ID = ATS.ATS_ATE_ID
        AND APL.CAD_PRD_ID = ATS.CAD_PRD_ID
        AND APL.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
        AND APL.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC
        AND APL.ATS_ATE_IN_INTLIB = ATS.ATS_ATE_IN_INTLIB
  
   JOIN TB_CAD_PRD_PRODUTO PRD                  ON PRD.CAD_PRD_ID = ATS.CAD_PRD_ID
   JOIN TB_AUX_EPP_ESPECPROC EPP                ON EPP.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC AND EPP.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
   JOIN TB_CAD_PAC_PACIENTE PAC                 ON PAC.CAD_PAC_ID_PACIENTE = ATS.CAD_PAC_ID_PACIENTE_INT
   JOIN TB_CAD_PES_PESSOA PES_PAC               ON PES_PAC.CAD_PES_ID_PESSOA = PAC.CAD_PES_ID_PESSOA
    JOIN TB_CAD_PRO_PROFISSIONAL PRO        ON PRO.CAD_PRO_ID_PROFISSIONAL = APL.CAD_PRO_ID_PROF
      JOIN TB_CAD_SET_SETOR SETOR_EXEC        ON SETOR_EXEC.CAD_SET_ID = ATS.CAD_SET_ID_ATEN
   JOIN TB_CAD_UNI_UNIDADE UNI             ON UNI.CAD_UNI_ID_UNIDADE = SETOR_EXEC.CAD_UNI_ID_UNIDADE
   JOIN TB_CAD_LAT_LOCAL_ATENDIMENTO LAT   ON LAT.CAD_LAT_ID_LOCAL_ATENDIMENTO = SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO
   
    WHERE (ATS.ATS_ATE_FL_STATUS <> 'C')
    AND ATS.ATS_ATE_DT_REALIZ_PROCED BETWEEN pDT_INI_CONSULTA AND pDT_FIM_CONSULTA

    AND ((pAUX_EPP_CD_ESPECPROC IS NOT NULL AND PAUX_EPP_CD_ESPECPROC = '34' AND ATS.AUX_EPP_CD_ESPECPROC = '34')  OR pAUX_EPP_CD_ESPECPROC IS NULL AND ATS.AUX_EPP_CD_ESPECPROC='34')
    AND (pCAD_UNI_ID_UNIDADE IS NULL OR SETOR_EXEC.CAD_UNI_ID_UNIDADE = pCAD_UNI_ID_UNIDADE)
     AND (pCAD_LAT_ID_LOCAL_ATENDIMENTO IS NULL OR  SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO = pCAD_LAT_ID_LOCAL_ATENDIMENTO)
     AND (pCAD_SET_ID IS NULL OR SETOR_EXEC.CAD_SET_ID = pCAD_SET_ID)
    ORDER BY DBMS_RANDOM.VALUE FETCH NEXT QTD_34 ROWS ONLY
    ) A
    
UNION ALL

    SELECT 
        A.CAD_UNI_DS_UNIDADE UNIDADE,
        A.CAD_LAT_DS_LOCAL_ATENDIMENTO LOCAL,
        A.CAD_SET_DS_SETOR SETOR_EXEC,
        A.AUX_EPP_DS_DESCRICAO ESPECIALIDADE,
        A.CAD_PRD_DS_DESCRICAO PROCEDIMENTO, 
        A.ATS_ATE_CD_INTLIB ATENDIMENTO,
        A.ATS_ATE_IN_INTLIB TIPO_ATENDIMENTO,
        A.ATS_ATE_ID NUMERO_EXAME,                       
        A.ATS_ATE_DT_REALIZ_PROCED DT_REALIZ,
        A.ATS_ATE_HR_REALIZ_PROCED HR_REALIZ,
        A.CAD_PES_NM_PESSOA NM_PACIENTE,
        A.CAD_PES_DT_NASCIMENTO DT_NASCIMENTO,
        A.CAD_PRO_NM_NOME NM_PROFISSIONAL,    
        A.CAD_PAC_NR_PRONTUARIO PRONTUARIO,
        A.ATS_ATE_FL_REPETICAO REPETICAO,        
        TOTAL_LAUDOS,
        CASE WHEN TOTAL_LAUDOS  > 0 THEN ROUND((7*TOTAL_LAUDOS )/100) ELSE 0 END QTD_POR_PCT_TOTAL_LAUDOS,
        QTD_36
        
        FROM (
  SELECT
        ATS.ATS_ATE_DT_REALIZ_PROCED,
        ATS.ATS_ATE_HR_REALIZ_PROCED,
        ATS.ATS_ATE_CD_INTLIB,
        ATS.ATS_ATE_IN_INTLIB,
        ATS.ATS_ATE_ID,
        PRD.CAD_PRD_DS_DESCRICAO,
        EPP.AUX_EPP_DS_DESCRICAO,      
        ATS.ATS_ATE_FL_STATUS,
        PES_PAC.CAD_PES_NM_PESSOA ,
        PES_PAC.CAD_PES_DT_NASCIMENTO,
        PRO.CAD_PRO_NM_NOME ,    
        PAC.CAD_PAC_NR_PRONTUARIO,
        ATS.ATS_ATE_FL_REPETICAO,
        UNI.CAD_UNI_DS_UNIDADE,
        LAT.CAD_LAT_DS_LOCAL_ATENDIMENTO,
        SETOR_EXEC.CAD_SET_DS_SETOR 
                
   FROM TB_ATS_ATE_ATENDIMENTO_SADT ATS
   JOIN TB_ATS_APL_ATEN_PROCED_LAUDO APL   ON APL.ATS_ATE_CD_INTLIB = ATS.ATS_ATE_CD_INTLIB
        AND APL.ATS_ATE_ID = ATS.ATS_ATE_ID
        AND APL.CAD_PRD_ID = ATS.CAD_PRD_ID
        AND APL.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
        AND APL.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC
        AND APL.ATS_ATE_IN_INTLIB = ATS.ATS_ATE_IN_INTLIB
  
   JOIN TB_CAD_PRD_PRODUTO PRD                  ON PRD.CAD_PRD_ID = ATS.CAD_PRD_ID
   JOIN TB_AUX_EPP_ESPECPROC EPP                ON EPP.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC AND EPP.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
   JOIN TB_CAD_PAC_PACIENTE PAC                 ON PAC.CAD_PAC_ID_PACIENTE = ATS.CAD_PAC_ID_PACIENTE_INT
   JOIN TB_CAD_PES_PESSOA PES_PAC               ON PES_PAC.CAD_PES_ID_PESSOA = PAC.CAD_PES_ID_PESSOA
    JOIN TB_CAD_PRO_PROFISSIONAL PRO        ON PRO.CAD_PRO_ID_PROFISSIONAL = APL.CAD_PRO_ID_PROF
      JOIN TB_CAD_SET_SETOR SETOR_EXEC        ON SETOR_EXEC.CAD_SET_ID = ATS.CAD_SET_ID_ATEN
   JOIN TB_CAD_UNI_UNIDADE UNI             ON UNI.CAD_UNI_ID_UNIDADE = SETOR_EXEC.CAD_UNI_ID_UNIDADE
   JOIN TB_CAD_LAT_LOCAL_ATENDIMENTO LAT   ON LAT.CAD_LAT_ID_LOCAL_ATENDIMENTO = SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO
   
    WHERE (ATS.ATS_ATE_FL_STATUS <> 'C')
    AND ATS.ATS_ATE_DT_REALIZ_PROCED BETWEEN pDT_INI_CONSULTA AND pDT_FIM_CONSULTA

    AND ((pAUX_EPP_CD_ESPECPROC IS NOT NULL AND PAUX_EPP_CD_ESPECPROC = '36' AND ATS.AUX_EPP_CD_ESPECPROC = '36')  OR pAUX_EPP_CD_ESPECPROC IS NULL AND ATS.AUX_EPP_CD_ESPECPROC='36')
    AND (pCAD_UNI_ID_UNIDADE IS NULL OR SETOR_EXEC.CAD_UNI_ID_UNIDADE = pCAD_UNI_ID_UNIDADE)
     AND (pCAD_LAT_ID_LOCAL_ATENDIMENTO IS NULL OR  SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO = pCAD_LAT_ID_LOCAL_ATENDIMENTO)
     AND (pCAD_SET_ID IS NULL OR SETOR_EXEC.CAD_SET_ID = pCAD_SET_ID)
    ORDER BY DBMS_RANDOM.VALUE FETCH NEXT QTD_36 ROWS ONLY
    ) A

UNION ALL
        
    SELECT 
        A.CAD_UNI_DS_UNIDADE UNIDADE,
        A.CAD_LAT_DS_LOCAL_ATENDIMENTO LOCAL,
        A.CAD_SET_DS_SETOR SETOR_EXEC,
        A.AUX_EPP_DS_DESCRICAO ESPECIALIDADE,
        A.CAD_PRD_DS_DESCRICAO PROCEDIMENTO, 
        A.ATS_ATE_CD_INTLIB ATENDIMENTO,
        A.ATS_ATE_IN_INTLIB TIPO_ATENDIMENTO,
        A.ATS_ATE_ID NUMERO_EXAME,                       
        A.ATS_ATE_DT_REALIZ_PROCED DT_REALIZ,
        A.ATS_ATE_HR_REALIZ_PROCED HR_REALIZ,
        A.CAD_PES_NM_PESSOA NM_PACIENTE,
        A.CAD_PES_DT_NASCIMENTO DT_NASCIMENTO,
        A.CAD_PRO_NM_NOME NM_PROFISSIONAL,    
        A.CAD_PAC_NR_PRONTUARIO PRONTUARIO,
        A.ATS_ATE_FL_REPETICAO REPETICAO,        
        TOTAL_LAUDOS,
        CASE WHEN TOTAL_LAUDOS  > 0 THEN ROUND((7*TOTAL_LAUDOS )/100) ELSE 0 END QTD_POR_PCT_TOTAL_LAUDOS,
        QTD_39
        
        FROM (
  SELECT
        ATS.ATS_ATE_DT_REALIZ_PROCED,
        ATS.ATS_ATE_HR_REALIZ_PROCED,
        ATS.ATS_ATE_CD_INTLIB,
        ATS.ATS_ATE_IN_INTLIB,
        ATS.ATS_ATE_ID,
        PRD.CAD_PRD_DS_DESCRICAO,
        EPP.AUX_EPP_DS_DESCRICAO,      
        ATS.ATS_ATE_FL_STATUS,
        PES_PAC.CAD_PES_NM_PESSOA ,
        PES_PAC.CAD_PES_DT_NASCIMENTO,
        PRO.CAD_PRO_NM_NOME ,    
        PAC.CAD_PAC_NR_PRONTUARIO,
        ATS.ATS_ATE_FL_REPETICAO,
        UNI.CAD_UNI_DS_UNIDADE,
        LAT.CAD_LAT_DS_LOCAL_ATENDIMENTO,
        SETOR_EXEC.CAD_SET_DS_SETOR         
        
   FROM TB_ATS_ATE_ATENDIMENTO_SADT ATS
   JOIN TB_ATS_APL_ATEN_PROCED_LAUDO APL   ON APL.ATS_ATE_CD_INTLIB = ATS.ATS_ATE_CD_INTLIB
        AND APL.ATS_ATE_ID = ATS.ATS_ATE_ID
        AND APL.CAD_PRD_ID = ATS.CAD_PRD_ID
        AND APL.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
        AND APL.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC
        AND APL.ATS_ATE_IN_INTLIB = ATS.ATS_ATE_IN_INTLIB
  
   JOIN TB_CAD_PRD_PRODUTO PRD                  ON PRD.CAD_PRD_ID = ATS.CAD_PRD_ID
   JOIN TB_AUX_EPP_ESPECPROC EPP                ON EPP.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC AND EPP.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
   JOIN TB_CAD_PAC_PACIENTE PAC                 ON PAC.CAD_PAC_ID_PACIENTE = ATS.CAD_PAC_ID_PACIENTE_INT
   JOIN TB_CAD_PES_PESSOA PES_PAC               ON PES_PAC.CAD_PES_ID_PESSOA = PAC.CAD_PES_ID_PESSOA
    JOIN TB_CAD_PRO_PROFISSIONAL PRO        ON PRO.CAD_PRO_ID_PROFISSIONAL = APL.CAD_PRO_ID_PROF
      JOIN TB_CAD_SET_SETOR SETOR_EXEC        ON SETOR_EXEC.CAD_SET_ID = ATS.CAD_SET_ID_ATEN
   JOIN TB_CAD_UNI_UNIDADE UNI             ON UNI.CAD_UNI_ID_UNIDADE = SETOR_EXEC.CAD_UNI_ID_UNIDADE
   JOIN TB_CAD_LAT_LOCAL_ATENDIMENTO LAT   ON LAT.CAD_LAT_ID_LOCAL_ATENDIMENTO = SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO
   
    WHERE (ATS.ATS_ATE_FL_STATUS <> 'C')
    AND ATS.ATS_ATE_DT_REALIZ_PROCED BETWEEN pDT_INI_CONSULTA AND pDT_FIM_CONSULTA

    AND ((pAUX_EPP_CD_ESPECPROC IS NOT NULL AND PAUX_EPP_CD_ESPECPROC = '39' AND ATS.AUX_EPP_CD_ESPECPROC = '39')  OR pAUX_EPP_CD_ESPECPROC IS NULL AND ATS.AUX_EPP_CD_ESPECPROC='39')        
    AND (pCAD_UNI_ID_UNIDADE IS NULL OR SETOR_EXEC.CAD_UNI_ID_UNIDADE = pCAD_UNI_ID_UNIDADE)
     AND (pCAD_LAT_ID_LOCAL_ATENDIMENTO IS NULL OR  SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO = pCAD_LAT_ID_LOCAL_ATENDIMENTO)
     AND (pCAD_SET_ID IS NULL OR SETOR_EXEC.CAD_SET_ID = pCAD_SET_ID)
    ORDER BY DBMS_RANDOM.VALUE FETCH NEXT QTD_39 ROWS ONLY
    ) A
        
UNION ALL

    SELECT 
        A.CAD_UNI_DS_UNIDADE UNIDADE,
        A.CAD_LAT_DS_LOCAL_ATENDIMENTO LOCAL,
        A.CAD_SET_DS_SETOR SETOR_EXEC,
        A.AUX_EPP_DS_DESCRICAO ESPECIALIDADE,
        A.CAD_PRD_DS_DESCRICAO PROCEDIMENTO, 
        A.ATS_ATE_CD_INTLIB ATENDIMENTO,
        A.ATS_ATE_IN_INTLIB TIPO_ATENDIMENTO,
        A.ATS_ATE_ID NUMERO_EXAME,                       
        A.ATS_ATE_DT_REALIZ_PROCED DT_REALIZ,
        A.ATS_ATE_HR_REALIZ_PROCED HR_REALIZ,
        A.CAD_PES_NM_PESSOA NM_PACIENTE,
        A.CAD_PES_DT_NASCIMENTO DT_NASCIMENTO,
        A.CAD_PRO_NM_NOME NM_PROFISSIONAL,    
        A.CAD_PAC_NR_PRONTUARIO PRONTUARIO,
        A.ATS_ATE_FL_REPETICAO REPETICAO,        
        TOTAL_LAUDOS,
        CASE WHEN TOTAL_LAUDOS  > 0 THEN ROUND((7*TOTAL_LAUDOS )/100) ELSE 0 END QTD_POR_PCT_TOTAL_LAUDOS,
        QTD_40
        
        FROM (
  SELECT
        ATS.ATS_ATE_DT_REALIZ_PROCED,
        ATS.ATS_ATE_HR_REALIZ_PROCED,
        ATS.ATS_ATE_CD_INTLIB,
        ATS.ATS_ATE_IN_INTLIB,
        ATS.ATS_ATE_ID,
        PRD.CAD_PRD_DS_DESCRICAO,
        EPP.AUX_EPP_DS_DESCRICAO,      
        ATS.ATS_ATE_FL_STATUS,
        PES_PAC.CAD_PES_NM_PESSOA ,
        PES_PAC.CAD_PES_DT_NASCIMENTO,
        PRO.CAD_PRO_NM_NOME ,    
        PAC.CAD_PAC_NR_PRONTUARIO,
        ATS.ATS_ATE_FL_REPETICAO,
        UNI.CAD_UNI_DS_UNIDADE,
        LAT.CAD_LAT_DS_LOCAL_ATENDIMENTO,
        SETOR_EXEC.CAD_SET_DS_SETOR 
        
   FROM TB_ATS_ATE_ATENDIMENTO_SADT ATS
   JOIN TB_ATS_APL_ATEN_PROCED_LAUDO APL   ON APL.ATS_ATE_CD_INTLIB = ATS.ATS_ATE_CD_INTLIB
        AND APL.ATS_ATE_ID = ATS.ATS_ATE_ID
        AND APL.CAD_PRD_ID = ATS.CAD_PRD_ID
        AND APL.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
        AND APL.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC
        AND APL.ATS_ATE_IN_INTLIB = ATS.ATS_ATE_IN_INTLIB
  
   JOIN TB_CAD_PRD_PRODUTO PRD                  ON PRD.CAD_PRD_ID = ATS.CAD_PRD_ID
   JOIN TB_AUX_EPP_ESPECPROC EPP                ON EPP.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC AND EPP.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
   JOIN TB_CAD_PAC_PACIENTE PAC                 ON PAC.CAD_PAC_ID_PACIENTE = ATS.CAD_PAC_ID_PACIENTE_INT
   JOIN TB_CAD_PES_PESSOA PES_PAC               ON PES_PAC.CAD_PES_ID_PESSOA = PAC.CAD_PES_ID_PESSOA
    JOIN TB_CAD_PRO_PROFISSIONAL PRO        ON PRO.CAD_PRO_ID_PROFISSIONAL = APL.CAD_PRO_ID_PROF
      JOIN TB_CAD_SET_SETOR SETOR_EXEC        ON SETOR_EXEC.CAD_SET_ID = ATS.CAD_SET_ID_ATEN
   JOIN TB_CAD_UNI_UNIDADE UNI             ON UNI.CAD_UNI_ID_UNIDADE = SETOR_EXEC.CAD_UNI_ID_UNIDADE
   JOIN TB_CAD_LAT_LOCAL_ATENDIMENTO LAT   ON LAT.CAD_LAT_ID_LOCAL_ATENDIMENTO = SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO
   
    WHERE (ATS.ATS_ATE_FL_STATUS <> 'C')
    AND ATS.ATS_ATE_DT_REALIZ_PROCED BETWEEN pDT_INI_CONSULTA AND pDT_FIM_CONSULTA

    AND ((pAUX_EPP_CD_ESPECPROC IS NOT NULL AND PAUX_EPP_CD_ESPECPROC = '40' AND ATS.AUX_EPP_CD_ESPECPROC = '40')  OR pAUX_EPP_CD_ESPECPROC IS NULL AND ATS.AUX_EPP_CD_ESPECPROC='40')       
    AND (pCAD_UNI_ID_UNIDADE IS NULL OR SETOR_EXEC.CAD_UNI_ID_UNIDADE = pCAD_UNI_ID_UNIDADE)
     AND (pCAD_LAT_ID_LOCAL_ATENDIMENTO IS NULL OR  SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO = pCAD_LAT_ID_LOCAL_ATENDIMENTO)
     AND (pCAD_SET_ID IS NULL OR SETOR_EXEC.CAD_SET_ID = pCAD_SET_ID)
    ORDER BY DBMS_RANDOM.VALUE FETCH NEXT QTD_40 ROWS ONLY
    ) A

UNION ALL

SELECT 
        A.CAD_UNI_DS_UNIDADE UNIDADE,
        A.CAD_LAT_DS_LOCAL_ATENDIMENTO LOCAL,
        A.CAD_SET_DS_SETOR SETOR_EXEC,
        A.AUX_EPP_DS_DESCRICAO ESPECIALIDADE,
        A.CAD_PRD_DS_DESCRICAO PROCEDIMENTO, 
        A.ATS_ATE_CD_INTLIB ATENDIMENTO,
        A.ATS_ATE_IN_INTLIB TIPO_ATENDIMENTO,
        A.ATS_ATE_ID NUMERO_EXAME,                       
        A.ATS_ATE_DT_REALIZ_PROCED DT_REALIZ,
        A.ATS_ATE_HR_REALIZ_PROCED HR_REALIZ,
        A.CAD_PES_NM_PESSOA NM_PACIENTE,
        A.CAD_PES_DT_NASCIMENTO DT_NASCIMENTO,
        A.CAD_PRO_NM_NOME NM_PROFISSIONAL,    
        A.CAD_PAC_NR_PRONTUARIO PRONTUARIO,
        A.ATS_ATE_FL_REPETICAO REPETICAO,        
        TOTAL_LAUDOS,
        CASE WHEN TOTAL_LAUDOS  > 0 THEN ROUND((7*TOTAL_LAUDOS )/100) ELSE 0 END QTD_POR_PCT_TOTAL_LAUDOS,
        QTD_45
        
        FROM (
  SELECT
        ATS.ATS_ATE_DT_REALIZ_PROCED,
        ATS.ATS_ATE_HR_REALIZ_PROCED,
        ATS.ATS_ATE_CD_INTLIB,
        ATS.ATS_ATE_IN_INTLIB,
        ATS.ATS_ATE_ID,
        PRD.CAD_PRD_DS_DESCRICAO,
        EPP.AUX_EPP_DS_DESCRICAO,      
        ATS.ATS_ATE_FL_STATUS,
        PES_PAC.CAD_PES_NM_PESSOA ,
        PES_PAC.CAD_PES_DT_NASCIMENTO,
        PRO.CAD_PRO_NM_NOME ,    
        PAC.CAD_PAC_NR_PRONTUARIO,
        ATS.ATS_ATE_FL_REPETICAO,
        UNI.CAD_UNI_DS_UNIDADE,
        LAT.CAD_LAT_DS_LOCAL_ATENDIMENTO,
        SETOR_EXEC.CAD_SET_DS_SETOR 
        
   FROM TB_ATS_ATE_ATENDIMENTO_SADT ATS
   JOIN TB_ATS_APL_ATEN_PROCED_LAUDO APL   ON APL.ATS_ATE_CD_INTLIB = ATS.ATS_ATE_CD_INTLIB
        AND APL.ATS_ATE_ID = ATS.ATS_ATE_ID
        AND APL.CAD_PRD_ID = ATS.CAD_PRD_ID
        AND APL.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
        AND APL.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC
        AND APL.ATS_ATE_IN_INTLIB = ATS.ATS_ATE_IN_INTLIB
  
   JOIN TB_CAD_PRD_PRODUTO PRD                  ON PRD.CAD_PRD_ID = ATS.CAD_PRD_ID
   JOIN TB_AUX_EPP_ESPECPROC EPP                ON EPP.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC AND EPP.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
   JOIN TB_CAD_PAC_PACIENTE PAC                 ON PAC.CAD_PAC_ID_PACIENTE = ATS.CAD_PAC_ID_PACIENTE_INT
   JOIN TB_CAD_PES_PESSOA PES_PAC               ON PES_PAC.CAD_PES_ID_PESSOA = PAC.CAD_PES_ID_PESSOA
    JOIN TB_CAD_PRO_PROFISSIONAL PRO        ON PRO.CAD_PRO_ID_PROFISSIONAL = APL.CAD_PRO_ID_PROF
      JOIN TB_CAD_SET_SETOR SETOR_EXEC        ON SETOR_EXEC.CAD_SET_ID = ATS.CAD_SET_ID_ATEN
   JOIN TB_CAD_UNI_UNIDADE UNI             ON UNI.CAD_UNI_ID_UNIDADE = SETOR_EXEC.CAD_UNI_ID_UNIDADE
   JOIN TB_CAD_LAT_LOCAL_ATENDIMENTO LAT   ON LAT.CAD_LAT_ID_LOCAL_ATENDIMENTO = SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO
   
    WHERE (ATS.ATS_ATE_FL_STATUS <> 'C')
    AND ATS.ATS_ATE_DT_REALIZ_PROCED BETWEEN pDT_INI_CONSULTA AND pDT_FIM_CONSULTA

    AND ((pAUX_EPP_CD_ESPECPROC IS NOT NULL AND PAUX_EPP_CD_ESPECPROC = '45' AND ATS.AUX_EPP_CD_ESPECPROC = '45') OR pAUX_EPP_CD_ESPECPROC IS NULL AND ATS.AUX_EPP_CD_ESPECPROC='45')    
    AND (pCAD_UNI_ID_UNIDADE IS NULL OR SETOR_EXEC.CAD_UNI_ID_UNIDADE = pCAD_UNI_ID_UNIDADE)
     AND (pCAD_LAT_ID_LOCAL_ATENDIMENTO IS NULL OR  SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO = pCAD_LAT_ID_LOCAL_ATENDIMENTO)
     AND (pCAD_SET_ID IS NULL OR SETOR_EXEC.CAD_SET_ID = pCAD_SET_ID)
    ORDER BY DBMS_RANDOM.VALUE FETCH NEXT QTD_45 ROWS ONLY
    ) A
    
UNION ALL

SELECT 
        A.CAD_UNI_DS_UNIDADE UNIDADE,
        A.CAD_LAT_DS_LOCAL_ATENDIMENTO LOCAL,
        A.CAD_SET_DS_SETOR SETOR_EXEC,
        A.AUX_EPP_DS_DESCRICAO ESPECIALIDADE,
        A.CAD_PRD_DS_DESCRICAO PROCEDIMENTO, 
        A.ATS_ATE_CD_INTLIB ATENDIMENTO,
        A.ATS_ATE_IN_INTLIB TIPO_ATENDIMENTO,
        A.ATS_ATE_ID NUMERO_EXAME,                       
        A.ATS_ATE_DT_REALIZ_PROCED DT_REALIZ,
        A.ATS_ATE_HR_REALIZ_PROCED HR_REALIZ,
        A.CAD_PES_NM_PESSOA NM_PACIENTE,
        A.CAD_PES_DT_NASCIMENTO DT_NASCIMENTO,
        A.CAD_PRO_NM_NOME NM_PROFISSIONAL,    
        A.CAD_PAC_NR_PRONTUARIO PRONTUARIO,
        A.ATS_ATE_FL_REPETICAO REPETICAO,        
        TOTAL_LAUDOS,
        CASE WHEN TOTAL_LAUDOS  > 0 THEN ROUND((7*TOTAL_LAUDOS )/100) ELSE 0 END QTD_POR_PCT_TOTAL_LAUDOS,
        QTD_56
        
        FROM (
  SELECT
        ATS.ATS_ATE_DT_REALIZ_PROCED,
        ATS.ATS_ATE_HR_REALIZ_PROCED,
        ATS.ATS_ATE_CD_INTLIB,
        ATS.ATS_ATE_IN_INTLIB,
        ATS.ATS_ATE_ID,
        PRD.CAD_PRD_DS_DESCRICAO,
        EPP.AUX_EPP_DS_DESCRICAO,      
        ATS.ATS_ATE_FL_STATUS,
        PES_PAC.CAD_PES_NM_PESSOA ,
        PES_PAC.CAD_PES_DT_NASCIMENTO,
        PRO.CAD_PRO_NM_NOME ,    
        PAC.CAD_PAC_NR_PRONTUARIO,
        ATS.ATS_ATE_FL_REPETICAO,
        UNI.CAD_UNI_DS_UNIDADE,
        LAT.CAD_LAT_DS_LOCAL_ATENDIMENTO,
        SETOR_EXEC.CAD_SET_DS_SETOR 
        
   FROM TB_ATS_ATE_ATENDIMENTO_SADT ATS
   JOIN TB_ATS_APL_ATEN_PROCED_LAUDO APL   ON APL.ATS_ATE_CD_INTLIB = ATS.ATS_ATE_CD_INTLIB
        AND APL.ATS_ATE_ID = ATS.ATS_ATE_ID
        AND APL.CAD_PRD_ID = ATS.CAD_PRD_ID
        AND APL.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
        AND APL.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC
        AND APL.ATS_ATE_IN_INTLIB = ATS.ATS_ATE_IN_INTLIB
  
   JOIN TB_CAD_PRD_PRODUTO PRD                  ON PRD.CAD_PRD_ID = ATS.CAD_PRD_ID
   JOIN TB_AUX_EPP_ESPECPROC EPP                ON EPP.AUX_EPP_CD_ESPECPROC = ATS.AUX_EPP_CD_ESPECPROC AND EPP.TIS_MED_CD_TABELAMEDICA = ATS.TIS_MED_CD_TABELAMEDICA
   JOIN TB_CAD_PAC_PACIENTE PAC                 ON PAC.CAD_PAC_ID_PACIENTE = ATS.CAD_PAC_ID_PACIENTE_INT
   JOIN TB_CAD_PES_PESSOA PES_PAC               ON PES_PAC.CAD_PES_ID_PESSOA = PAC.CAD_PES_ID_PESSOA
    JOIN TB_CAD_PRO_PROFISSIONAL PRO        ON PRO.CAD_PRO_ID_PROFISSIONAL = APL.CAD_PRO_ID_PROF
      JOIN TB_CAD_SET_SETOR SETOR_EXEC        ON SETOR_EXEC.CAD_SET_ID = ATS.CAD_SET_ID_ATEN
   JOIN TB_CAD_UNI_UNIDADE UNI             ON UNI.CAD_UNI_ID_UNIDADE = SETOR_EXEC.CAD_UNI_ID_UNIDADE
   JOIN TB_CAD_LAT_LOCAL_ATENDIMENTO LAT   ON LAT.CAD_LAT_ID_LOCAL_ATENDIMENTO = SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO
   
    WHERE (ATS.ATS_ATE_FL_STATUS <> 'C')
    AND ATS.ATS_ATE_DT_REALIZ_PROCED BETWEEN pDT_INI_CONSULTA AND pDT_FIM_CONSULTA
    AND ((pAUX_EPP_CD_ESPECPROC IS NOT NULL AND PAUX_EPP_CD_ESPECPROC = '56' AND ATS.AUX_EPP_CD_ESPECPROC = '56') OR pAUX_EPP_CD_ESPECPROC IS NULL AND ATS.AUX_EPP_CD_ESPECPROC='56')
    AND (pCAD_UNI_ID_UNIDADE IS NULL OR SETOR_EXEC.CAD_UNI_ID_UNIDADE = pCAD_UNI_ID_UNIDADE)
     AND (pCAD_LAT_ID_LOCAL_ATENDIMENTO IS NULL OR  SETOR_EXEC.CAD_LAT_ID_LOCAL_ATENDIMENTO = pCAD_LAT_ID_LOCAL_ATENDIMENTO)
     AND (pCAD_SET_ID IS NULL OR SETOR_EXEC.CAD_SET_ID = pCAD_SET_ID)
    ORDER BY DBMS_RANDOM.VALUE FETCH NEXT QTD_56 ROWS ONLY
    ) A
        
    ;

  io_cursor := v_cursor;
END PRC_ATS_REL_RANDOM;
