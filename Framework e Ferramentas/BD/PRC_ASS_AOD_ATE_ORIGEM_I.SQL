CREATE OR REPLACE PROCEDURE w
(
       pNewIdt OUT integer,
       pASS_AOD_ATE_ORIGEM IN TB_ASS_AOD_ATE_ORIGEM_DERIVA.ASS_AOD_ATE_ORIGEM%TYPE,
       pASS_AOD_CD_UNID_HOSP_ORIGEM IN TB_ASS_AOD_ATE_ORIGEM_DERIVA.ASS_AOD_CD_UNID_HOSP_ORIGEM%TYPE DEFAULT NULL,
       pASS_AOD_NR_PRONT_ORIGEM IN TB_ASS_AOD_ATE_ORIGEM_DERIVA.ASS_AOD_NR_PRONT_ORIGEM%TYPE
)
IS
 nrAtendimento NUMBER;
 existeOrigem NUMBER;
 numeroAteOrigem NUMBER;
BEGIN

  SELECT SEQATEND.NEXTVAL INTO nrAtendimento FROM DUAL;

  SELECT COUNT(1) INTO existeOrigem FROM TB_ASS_AOD_ATE_ORIGEM_DERIVA AOD
  WHERE AOD.ASS_AOD_ATE_DERIVADO = pASS_AOD_ATE_ORIGEM;
  
  IF (existeOrigem > 0) THEN
   SELECT AOD.ASS_AOD_ATE_ORIGEM INTO numeroAteOrigem
   FROM TB_ASS_AOD_ATE_ORIGEM_DERIVA AOD
   WHERE AOD.ASS_AOD_ATE_DERIVADO = pASS_AOD_ATE_ORIGEM
   GROUP BY AOD.ASS_AOD_ATE_ORIGEM;
  ELSE
    numeroAteOrigem := pASS_AOD_ATE_ORIGEM;
  END IF;

  INSERT INTO TB_ASS_AOD_ATE_ORIGEM_DERIVA
  (
  ASS_AOD_ATE_ORIGEM,
  ASS_AOD_CD_UNID_HOSP_ORIGEM,
  ASS_AOD_NR_PRONT_ORIGEM, 
  ASS_AOD_ATE_DERIVADO
  )
  VALUES
  (
   numeroAteOrigem,
   pASS_AOD_CD_UNID_HOSP_ORIGEM,
   pASS_AOD_NR_PRONT_ORIGEM,
   nrAtendimento);

   pNewIdt := nrAtendimento;

END PRC_ASS_AOD_ATE_ORIGEM_I;
