CREATE OR REPLACE PROCEDURE "PRC_CAD_PES_PESSOA_S"
  (
     pCAD_PES_ID_PESSOA IN TB_CAD_PES_PESSOA.CAD_PES_ID_PESSOA%type DEFAULT NULL,
     pCAD_PES_NR_CNPJ_CPF IN TB_CAD_PES_PESSOA.CAD_PES_NR_CNPJ_CPF%type DEFAULT NULL,
     pCAD_PES_FL_JURIDICA_OK IN TB_CAD_PES_PESSOA.CAD_PES_FL_JURIDICA_OK%type DEFAULT NULL,
     pCAD_PES_NM_PESSOA IN TB_CAD_PES_PESSOA.CAD_PES_NM_PESSOA%type DEFAULT NULL,
     pCAD_PES_NM_RAZAOSOCIAL IN TB_CAD_PES_PESSOA.CAD_PES_NM_RAZAOSOCIAL%type DEFAULT NULL,
     pCAD_PES_DT_NASCIMENTO IN TB_CAD_PES_PESSOA.CAD_PES_DT_NASCIMENTO%type DEFAULT NULL,
     pCAD_PES_TP_SEXO IN TB_CAD_PES_PESSOA.CAD_PES_TP_SEXO%type DEFAULT NULL,
     io_cursor OUT PKG_CURSOR.t_cursor--,
     --TESTE OUT  LONG
  )
  is
  /********************************************************************
  *    Procedure: PRC_CAD_PES_PESSOA_S
  *
  *    Data Alteracao:   05/06/2013       Por: Pedro
  *    Alteracao:     retirado is null or -> V_SELECT
  *
  *******************************************************************/
v_cursor PKG_CURSOR.t_cursor;
  V_WHERE  varchar2(5000);
  V_SELECT  varchar2(10000);
begin
  V_WHERE := NULL;
  IF pCAD_PES_ID_PESSOA IS NOT NULL THEN V_WHERE:= V_WHERE || ' AND CAD_PES_ID_PESSOA = ' || pCAD_PES_ID_PESSOA; END IF;
IF pCAD_PES_NR_CNPJ_CPF IS NOT NULL THEN V_WHERE:= V_WHERE || ' AND CAD_PES_NR_CNPJ_CPF = ' || pCAD_PES_NR_CNPJ_CPF; END IF;
IF pCAD_PES_FL_JURIDICA_OK IS NOT NULL THEN V_WHERE:= V_WHERE || ' AND CAD_PES_FL_JURIDICA_OK = ' || CHR(39) || UPPER(pCAD_PES_FL_JURIDICA_OK) || CHR(39); END IF;
IF pCAD_PES_NM_PESSOA IS NOT NULL THEN V_WHERE:= V_WHERE || ' AND CAD_PES_NM_PESSOA LIKE ' || CHR(39) ||  UPPER(pCAD_PES_NM_PESSOA) || CHR(39); END IF;
IF pCAD_PES_NM_RAZAOSOCIAL IS NOT NULL THEN V_WHERE:= V_WHERE || ' AND CAD_PES_NM_RAZAOSOCIAL = ' || CHR(39) ||  UPPER(pCAD_PES_NM_RAZAOSOCIAL) || CHR(39); END IF;
IF pCAD_PES_DT_NASCIMENTO IS NOT NULL THEN V_WHERE:= V_WHERE || ' AND CAD_PES_DT_NASCIMENTO = TO_DATE('||CHR(39)||TO_CHAR(pCAD_PES_DT_NASCIMENTO,'DDMMYYYY')||CHR(39)||','||CHR(39)||'DDMMYYYY'||CHR(39)|| ')' ; END IF;
IF pCAD_PES_TP_SEXO IS NOT NULL THEN V_WHERE:= V_WHERE || ' AND CAD_PES_TP_SEXO = ' || CHR(39) || pCAD_PES_TP_SEXO || CHR(39); END IF;

 V_SELECT := '
     SELECT
       CAD_PES_ID_PESSOA,
       CAD_PES_NR_CNPJ_CPF,
       CAD_PES_FL_JURIDICA_OK,
       CAD_PES_NM_PESSOA,
       CAD_PES_NM_RAZAOSOCIAL,
       CAD_PES_DT_NASCIMENTO,
       CAD_PES_NR_RG,
       CAD_PES_CD_INSCR_MUNIC,
       CAD_PES_CD_INSCR_ESTAD,
       CAD_PES_TP_SEXO,
       SEG_USU_ID_USUARIO,
       CAD_PES_CD_ESTADOCIVIL,
       CAD_PES_NM_NOMEMAE,
       CAD_PES_CD_ORGAOEMISSORRG,
       CAD_PES_DT_EXPEDICAORG,
       CAD_PES_FL_ATIVO_OK
    FROM TB_CAD_PES_PESSOA

    WHERE 1=1 ' || V_WHERE || '

    ORDER BY CAD_PES_NM_PESSOA, CAD_PES_DT_NASCIMENTO '   ;

--TESTE :=   V_SELECT || V_WHERE ;

OPEN v_cursor FOR

  V_SELECT  ;

  io_cursor := v_cursor;
  end PRC_CAD_PES_PESSOA_S;

 