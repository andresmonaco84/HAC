CREATE OR REPLACE PROCEDURE SGS.PRC_CTS_REL_16_COMP1
(pCTS_RES_RESU_MES IN TB_REP_RPA_RESUMO_PAGTO.REP_RPA_MES_PAGTO%type,
pCTS_RES_RESU_ANO IN TB_REP_RPA_RESUMO_PAGTO.REP_RPA_ANO_PAGTO%type) 
IS
BEGIN
FOR C1 IN
(
SELECT RES.CTS_RES_RESU_TIPO TIPO,
       RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL NIVEL,
       RTRIM(UPPER(RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI)) DESCRICAO,
       RES.CTS_RES_RESU_CAD_CTS_CD_CONTA CONTA,
       'RECEITA DIRETA' DIARIAS,
       ROUND(SUM(RES.CTS_RES_RESU_VL_REC_DIRETA)) VALOR,
       ROUND(DECODE(RES.CTS_RES_RESU_VL_REC_DIRETA +
                    RES.CTS_RES_RESU_VL_REC_INDIRETA +
                    RES.CTS_RES_RESU_VL_REC_INTERMEDI,
                    0,
                    0,
                    (RES.CTS_RES_RESU_VL_REC_DIRETA) /
                    (RES.CTS_RES_RESU_VL_REC_DIRETA +
                    RES.CTS_RES_RESU_VL_REC_INDIRETA +
                    RES.CTS_RES_RESU_VL_REC_INTERMEDI) * 100),
             2) PERCENTUAL,
       RES.CTS_RES_RESU_COD_DESCRICAO,
       1 CODIGO_DIARIA
  FROM TB_CTS_RES_RESUMO_GERAL RES
WHERE RES.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
   AND RES.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
   AND RES.CTS_RES_RESU_TIPO = 'R'
   AND RES.CTS_RES_RESU_CAD_CTS_CD_CONTA != 1
GROUP BY RES.CTS_RES_RESU_TIPO,
          RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL,
          RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI,
          CTS_RES_RESU_CAD_CTS_CD_CONTA,
          RES.CTS_RES_RESU_COD_DESCRICAO,
          DECODE(RES.CTS_RES_RESU_VL_REC_DIRETA +
                 RES.CTS_RES_RESU_VL_REC_INDIRETA +
                 RES.CTS_RES_RESU_VL_REC_INTERMEDI,
                 0,
                 0,
                 (RES.CTS_RES_RESU_VL_REC_DIRETA) /
                 (RES.CTS_RES_RESU_VL_REC_DIRETA +
                 RES.CTS_RES_RESU_VL_REC_INDIRETA +
                 RES.CTS_RES_RESU_VL_REC_INTERMEDI) * 100),
          RES.CTS_RES_RESU_COD_DESCRICAO
UNION ALL
-- RECEITA INDIRETA
SELECT RES.CTS_RES_RESU_TIPO TIPO,
       RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL NIVEL,
       RTRIM(UPPER(RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI)) DESCRICAO,
       UPPER(RES.CTS_RES_RESU_CAD_CTS_CD_CONTA) CONTA,
       'RECEITA INDIRETA' DIARIAS,
       ROUND(SUM(RES.CTS_RES_RESU_VL_REC_INDIRETA)) VALOR,
       ROUND(DECODE((SUM(RES.CTS_RES_RESU_VL_REC_DIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_REC_INDIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_REC_INTERMEDI)),
                    0,
                    0,
                    (SUM(RES.CTS_RES_RESU_VL_REC_INDIRETA)) /
                    (SUM(RES.CTS_RES_RESU_VL_REC_DIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_REC_INDIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_REC_INTERMEDI)) * 100),
             2) PERCENTUAL,
       RES.CTS_RES_RESU_COD_DESCRICAO,
       2 CODIGO_DIARIA
  FROM TB_CTS_RES_RESUMO_GERAL RES
WHERE RES.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
   AND RES.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
   AND RES.CTS_RES_RESU_TIPO = 'R'
   AND RES.CTS_RES_RESU_CAD_CTS_CD_CONTA != 1
GROUP BY RES.CTS_RES_RESU_TIPO,
          RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL,
          RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI,
          CTS_RES_RESU_CAD_CTS_CD_CONTA,
          RES.CTS_RES_RESU_COD_DESCRICAO
UNION ALL
-- RECEITA PROPRIA
SELECT RES.CTS_RES_RESU_TIPO TIPO,
       RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL NIVEL,
       RTRIM(UPPER(RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI)) DESCRICAO,
       UPPER(RES.CTS_RES_RESU_CAD_CTS_CD_CONTA) CONTA,
       'RECEITA PROPRIA' DIARIAS,
       ROUND(SUM(RES.CTS_RES_RESU_VL_REC_DIRETA)) +
       ROUND(SUM(RES.CTS_RES_RESU_VL_REC_INDIRETA)) VALOR,
       ROUND(DECODE(SUM(RES.CTS_RES_RESU_VL_REC_DIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_REC_INDIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_REC_INTERMEDI),
                    0,
                    0,
                    (SUM(RES.CTS_RES_RESU_VL_REC_DIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_REC_INDIRETA)) /
                    (SUM(RES.CTS_RES_RESU_VL_REC_DIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_REC_INDIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_REC_INTERMEDI)) * 100),
             2) PERCENTUAL,
       RES.CTS_RES_RESU_COD_DESCRICAO,
       3 CODIGO_DIARIA
  FROM TB_CTS_RES_RESUMO_GERAL RES
WHERE RES.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
   AND RES.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
   AND RES.CTS_RES_RESU_TIPO = 'R'
   AND RES.CTS_RES_RESU_CAD_CTS_CD_CONTA != 1
GROUP BY RES.CTS_RES_RESU_TIPO,
          RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL,
          RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI,
          CTS_RES_RESU_CAD_CTS_CD_CONTA,
          RES.CTS_RES_RESU_COD_DESCRICAO
UNION ALL
-- DESPESA DIRETA
SELECT RES.CTS_RES_RESU_TIPO TIPO,
       RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL NIVEL,
       RTRIM(UPPER(RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI)) DESCRICAO,
       UPPER(RES.CTS_RES_RESU_CAD_CTS_CD_CONTA) CONTA,
       'DESPESA DIRETA' DIARIAS,
       ROUND(SUM(RES.CTS_RES_RESU_VL_DESP_DIRETA)) VALOR,
       ROUND(DECODE(SUM(RES.CTS_RES_RESU_VL_DESP_DIRETA) +
                   SUM(RES.CTS_RES_RESU_VL_DESP_INDIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_DESP_INTERMEDI),
                    0,
                    0,
                    (SUM(RES.CTS_RES_RESU_VL_DESP_DIRETA) /
                    (SUM(RES.CTS_RES_RESU_VL_DESP_DIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_DESP_INDIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_DESP_INTERMEDI)) * 100)),
             2) PERCENTUAL,
       RES.CTS_RES_RESU_COD_DESCRICAO,
       4 CODIGO_DIARIA
  FROM TB_CTS_RES_RESUMO_GERAL RES
WHERE RES.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
   AND RES.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
   AND RES.CTS_RES_RESU_TIPO = 'R'
   AND RES.CTS_RES_RESU_CAD_CTS_CD_CONTA != 1
GROUP BY RES.CTS_RES_RESU_TIPO,
          RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL,
          RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI,
          CTS_RES_RESU_CAD_CTS_CD_CONTA,
          RES.CTS_RES_RESU_COD_DESCRICAO
UNION ALL
-- DESPESA INDIRETA
SELECT RES.CTS_RES_RESU_TIPO TIPO,
       RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL NIVEL,
       RTRIM(UPPER(RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI)) DESCRICAO,
       UPPER(RES.CTS_RES_RESU_CAD_CTS_CD_CONTA) CONTA,
       'DESPESA INDIRETA' DIARIAS,
       ROUND(SUM(RES.CTS_RES_RESU_VL_DESP_INDIRETA)) VALOR,
       ROUND(DECODE(SUM(RES.CTS_RES_RESU_VL_DESP_DIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_DESP_INDIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_DESP_INTERMEDI),
                    0,
                    0,
                    (SUM(RES.CTS_RES_RESU_VL_DESP_INDIRETA)) /
                    (SUM(RES.CTS_RES_RESU_VL_DESP_DIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_DESP_INDIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_DESP_INTERMEDI)) * 100),
             2) PERCENTUAL,
       RES.CTS_RES_RESU_COD_DESCRICAO,
       5 CODIGO_DIARIA
  FROM TB_CTS_RES_RESUMO_GERAL RES
WHERE RES.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
   AND RES.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
   AND RES.CTS_RES_RESU_TIPO = 'R'
   AND RES.CTS_RES_RESU_CAD_CTS_CD_CONTA != 1
GROUP BY RES.CTS_RES_RESU_TIPO,
          RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL,
          RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI,
          CTS_RES_RESU_CAD_CTS_CD_CONTA,
          RES.CTS_RES_RESU_COD_DESCRICAO
UNION ALL
--DESPESA PROPRIA
SELECT RES.CTS_RES_RESU_TIPO TIPO,
       RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL NIVEL,
       RTRIM(UPPER(RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI)) DESCRICAO,
       UPPER(RES.CTS_RES_RESU_CAD_CTS_CD_CONTA) CONTA,
       'DESPESA PROPRIA' DIARIAS,
       ROUND(SUM(RES.CTS_RES_RESU_VL_DESP_DIRETA)) +
       ROUND(SUM(RES.CTS_RES_RESU_VL_DESP_INDIRETA)) VALOR,
       ROUND(DECODE(SUM(RES.CTS_RES_RESU_VL_DESP_DIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_DESP_INDIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_DESP_INTERMEDI),
                    0,
                    0,
                    (SUM(RES.CTS_RES_RESU_VL_DESP_DIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_DESP_INDIRETA)) /
                    (SUM(RES.CTS_RES_RESU_VL_DESP_DIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_DESP_INDIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_DESP_INTERMEDI)) * 100),
             2) PERCENTUAL,
       RES.CTS_RES_RESU_COD_DESCRICAO,
       6 CODIGO_DIARIA
  FROM TB_CTS_RES_RESUMO_GERAL RES
WHERE RES.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
   AND RES.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
   AND RES.CTS_RES_RESU_TIPO = 'R'
   AND RES.CTS_RES_RESU_CAD_CTS_CD_CONTA != 1
GROUP BY RES.CTS_RES_RESU_TIPO,
          RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL,
          RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI,
          CTS_RES_RESU_CAD_CTS_CD_CONTA,
          RES.CTS_RES_RESU_COD_DESCRICAO
UNION ALL
-- RECEITA INTERMEDIARIA
SELECT RES.CTS_RES_RESU_TIPO TIPO,
       RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL NIVEL,
       RTRIM(UPPER(RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI)) DESCRICAO,
       UPPER(RES.CTS_RES_RESU_CAD_CTS_CD_CONTA) CONTA,
       'RECEITA INTERMEDIARIA' DIARIAS,
       ROUND(SUM(RES.CTS_RES_RESU_VL_REC_INTERMEDI)) VALOR,
       ROUND(DECODE(SUM(RES.CTS_RES_RESU_VL_REC_DIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_REC_INDIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_REC_INTERMEDI),
                    0,
                    0,
                    (SUM(RES.CTS_RES_RESU_VL_REC_INTERMEDI)) /
                    (SUM(RES.CTS_RES_RESU_VL_REC_DIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_REC_INDIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_REC_INTERMEDI)) * 100),
             2) PERCENTUAL,
       RES.CTS_RES_RESU_COD_DESCRICAO,
       7 CODIGO_DIARIA
  FROM TB_CTS_RES_RESUMO_GERAL RES
WHERE RES.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
   AND RES.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
   AND RES.CTS_RES_RESU_TIPO = 'R'
   AND RES.CTS_RES_RESU_CAD_CTS_CD_CONTA != 1
GROUP BY RES.CTS_RES_RESU_TIPO,
          RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL,
          RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI,
          CTS_RES_RESU_CAD_CTS_CD_CONTA,
          RES.CTS_RES_RESU_COD_DESCRICAO
UNION ALL
-- DESPESA INTERMEDIARIA
SELECT RES.CTS_RES_RESU_TIPO TIPO,
       RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL NIVEL,
       RTRIM(UPPER(RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI)) DESCRICAO,
       RES.CTS_RES_RESU_CAD_CTS_CD_CONTA CONTA,
       'DESPESA INTERMEDIARIA' DIARIAS,
       ROUND(SUM(RES.CTS_RES_RESU_VL_DESP_INTERMEDI)) VALOR,
       DECODE(SUM(RES.CTS_RES_RESU_VL_DESP_DIRETA) +
              SUM(RES.CTS_RES_RESU_VL_DESP_INDIRETA) +
              SUM(RES.CTS_RES_RESU_VL_DESP_INTERMEDI),
              0,
              0,
              ROUND((SUM(RES.CTS_RES_RESU_VL_DESP_INTERMEDI) /
                    (SUM(RES.CTS_RES_RESU_VL_DESP_DIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_DESP_INDIRETA) +
                    SUM(RES.CTS_RES_RESU_VL_DESP_INTERMEDI))) * 100,
                    2)) PERCENTUAL,
       RES.CTS_RES_RESU_COD_DESCRICAO,
       8 CODIGO_DIARIA
  FROM TB_CTS_RES_RESUMO_GERAL RES
WHERE RES.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
   AND RES.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
   AND RES.CTS_RES_RESU_TIPO = 'R'
   AND RES.CTS_RES_RESU_CAD_CTS_CD_CONTA != 1
GROUP BY RES.CTS_RES_RESU_TIPO,
          RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL,
          RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI,
          CTS_RES_RESU_CAD_CTS_CD_CONTA,
          RES.CTS_RES_RESU_COD_DESCRICAO
UNION ALL
--INDICE RESULTADO DIRETO
SELECT RES.CTS_RES_RESU_TIPO TIPO,
       RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL NIVEL,
       RTRIM(UPPER(RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI)) DESCRICAO,
       UPPER(RES.CTS_RES_RESU_CAD_CTS_CD_CONTA) CONTA,
       'INDICE RESULTADO DIRETO' DIARIAS,
       ROUND(SUM(RES.CTS_RES_RESU_VL_REC_DIRETA) /
             SUM(RES.CTS_RES_RESU_VL_DESP_DIRETA),
             2) VALOR,
       NULL PERCENTUAL,
       RES.CTS_RES_RESU_COD_DESCRICAO,
       9 CODIGO_DIARIA
  FROM TB_CTS_RES_RESUMO_GERAL RES
WHERE RES.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
   AND RES.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
   AND RES.CTS_RES_RESU_TIPO = 'R'
   AND RES.CTS_RES_RESU_CAD_CTS_CD_CONTA != 1
GROUP BY RES.CTS_RES_RESU_TIPO,
          RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL,
         RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI,
          CTS_RES_RESU_CAD_CTS_CD_CONTA,
          RES.CTS_RES_RESU_COD_DESCRICAO
UNION ALL
--INDICE RESULTADO PROPRIO - (DIRETO + INDIRETO)
SELECT RES.CTS_RES_RESU_TIPO TIPO,
       RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL NIVEL,
       RTRIM(UPPER(RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI)) DESCRICAO,
       UPPER(RES.CTS_RES_RESU_CAD_CTS_CD_CONTA) CONTA,
       'INDICE RESULTADO PROPRIO (DIRETO + INDIRETO)' DIARIAS,
       ROUND((SUM(RES.CTS_RES_RESU_VL_REC_DIRETA) +
             SUM(CTS_RES_RESU_VL_REC_INDIRETA)) /
             (SUM(RES.CTS_RES_RESU_VL_DESP_DIRETA) +
             SUM(RES.CTS_RES_RESU_VL_DESP_INDIRETA)),
             2) VALOR,
       NULL PERCENTUAL,
       RES.CTS_RES_RESU_COD_DESCRICAO,
       10 CODIGO_DIARIA
  FROM TB_CTS_RES_RESUMO_GERAL RES
WHERE RES.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
   AND RES.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
   AND RES.CTS_RES_RESU_TIPO = 'R'
   AND RES.CTS_RES_RESU_CAD_CTS_CD_CONTA != 1
GROUP BY RES.CTS_RES_RESU_TIPO,
          RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL,
          RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI,
          CTS_RES_RESU_CAD_CTS_CD_CONTA,
          RES.CTS_RES_RESU_COD_DESCRICAO
UNION ALL
--INDICE RESULTADO INTERMEDIARIO
SELECT RES.CTS_RES_RESU_TIPO TIPO,
       RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL NIVEL,
       RTRIM(UPPER(RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI)) DESCRICAO,
       UPPER(RES.CTS_RES_RESU_CAD_CTS_CD_CONTA) CONTA,
       'INDICE RESULTADO INTERMEDIARIO' DIARIAS,
       --SUM(RES.CTS_RES_RESU_VL_REC_INTERMEDI) / SUM(RES.CTS_RES_RESU_VL_DESP_INTERMEDI) VALOR,
       ROUND(DECODE(SUM(RES.CTS_RES_RESU_VL_DESP_INTERMEDI),
                    0,
                    0,
                    SUM(RES.CTS_RES_RESU_VL_REC_INTERMEDI) /
                    SUM(RES.CTS_RES_RESU_VL_DESP_INTERMEDI)),
             2) VALOR,
       NULL PERCENTUAL,
       RES.CTS_RES_RESU_COD_DESCRICAO,
       11 CODIGO_DIARIA
  FROM TB_CTS_RES_RESUMO_GERAL RES
WHERE RES.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
   AND RES.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
   AND RES.CTS_RES_RESU_TIPO = 'R'
   AND RES.CTS_RES_RESU_CAD_CTS_CD_CONTA != 1
GROUP BY RES.CTS_RES_RESU_TIPO,
          RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL,
          RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI,
          CTS_RES_RESU_CAD_CTS_CD_CONTA,
          RES.CTS_RES_RESU_COD_DESCRICAO
UNION ALL
-- RECEITA TOTAL
SELECT RES.CTS_RES_RESU_TIPO TIPO,
       RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL NIVEL,
       RTRIM(UPPER(RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI)) DESCRICAO,
       UPPER(RES.CTS_RES_RESU_CAD_CTS_CD_CONTA) CONTA,
       'RECEITA TOTAL' DIARIAS,
       ROUND(SUM(RES.CTS_RES_RESU_VL_REC_DIRETA) +
             SUM(RES.CTS_RES_RESU_VL_REC_INDIRETA) +
             SUM(RES.CTS_RES_RESU_VL_REC_INTERMEDI)) VALOR,
       NULL PERCENTUAL,
       RES.CTS_RES_RESU_COD_DESCRICAO,
       12 CODIGO_DIARIA
  FROM TB_CTS_RES_RESUMO_GERAL RES
WHERE RES.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
   AND RES.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
   AND RES.CTS_RES_RESU_TIPO = 'R'
   AND RES.CTS_RES_RESU_CAD_CTS_CD_CONTA != 1
GROUP BY RES.CTS_RES_RESU_TIPO,
          RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL,
          RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI,
          CTS_RES_RESU_CAD_CTS_CD_CONTA,
          RES.CTS_RES_RESU_COD_DESCRICAO
UNION ALL
-- DESPESA TOTAL
SELECT RES.CTS_RES_RESU_TIPO TIPO,
       RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL NIVEL,
       RTRIM(UPPER(RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI)) DESCRICAO,
       UPPER(RES.CTS_RES_RESU_CAD_CTS_CD_CONTA) CONTA,
       'DESPESA TOTAL' DIARIAS,
       ROUND(SUM(RES.CTS_RES_RESU_VL_DESP_DIRETA) +
             SUM(RES.CTS_RES_RESU_VL_DESP_INDIRETA) +
             SUM(RES.CTS_RES_RESU_VL_DESP_INTERMEDI)) VALOR,
       NULL PERCENTUAL,
       RES.CTS_RES_RESU_COD_DESCRICAO,
       13 CODIGO_DIARIA
  FROM TB_CTS_RES_RESUMO_GERAL RES
WHERE RES.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
   AND RES.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
   AND RES.CTS_RES_RESU_TIPO = 'R'
   AND RES.CTS_RES_RESU_CAD_CTS_CD_CONTA != 1
GROUP BY RES.CTS_RES_RESU_TIPO,
          RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL,
          RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI,
          CTS_RES_RESU_CAD_CTS_CD_CONTA,
          RES.CTS_RES_RESU_COD_DESCRICAO
UNION ALL
-- INDICE RESULTADO TOTAL
SELECT RES.CTS_RES_RESU_TIPO TIPO,
       RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL NIVEL,
       RTRIM(UPPER(RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI)) DESCRICAO,
       UPPER(RES.CTS_RES_RESU_CAD_CTS_CD_CONTA) CONTA,
       'INDICE RESULTADO TOTAL' DIARIAS,
       ROUND((SUM(RES.CTS_RES_RESU_VL_REC_DIRETA) +
             SUM(RES.CTS_RES_RESU_VL_REC_INDIRETA) +
             SUM(RES.CTS_RES_RESU_VL_REC_INTERMEDI)) /
             (SUM(RES.CTS_RES_RESU_VL_DESP_DIRETA) +
             SUM(RES.CTS_RES_RESU_VL_DESP_INDIRETA) +
             SUM(RES.CTS_RES_RESU_VL_DESP_INTERMEDI)),
             2) VALOR,
       NULL PERCENTUAL,
       RES.CTS_RES_RESU_COD_DESCRICAO,
       14 CODIGO_DIARIA
  FROM TB_CTS_RES_RESUMO_GERAL RES
WHERE RES.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
   AND RES.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
   AND RES.CTS_RES_RESU_TIPO = 'R'
   AND RES.CTS_RES_RESU_CAD_CTS_CD_CONTA != 1
GROUP BY RES.CTS_RES_RESU_TIPO,
          RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL,
          RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI,
          CTS_RES_RESU_CAD_CTS_CD_CONTA,
          RES.CTS_RES_RESU_COD_DESCRICAO
UNION ALL
-- PACIENTES DIA
SELECT RES.CTS_RES_RESU_TIPO TIPO,
       RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL NIVEL,
       RTRIM(UPPER(RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI)) DESCRICAO,
       RES.CTS_RES_RESU_CAD_CTS_CD_CONTA CONTA,
       'PACIENTES DIA' DIARIAS,
       ROUND(SUM(RES.CTS_RES_RESU_VL_PACIENTES_DIA)) VALOR,
       NULL PERCENTUAL,
       RES.CTS_RES_RESU_COD_DESCRICAO,
       15 CODIGO_DIARIA
  FROM TB_CTS_RES_RESUMO_GERAL RES
WHERE RES.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
   AND RES.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
   AND RES.CTS_RES_RESU_TIPO = 'R'
   AND RES.CTS_RES_RESU_CAD_CTS_CD_CONTA != 1
GROUP BY RES.CTS_RES_RESU_TIPO,
          RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL,
          RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI,
          CTS_RES_RESU_CAD_CTS_CD_CONTA,
          RES.CTS_RES_RESU_COD_DESCRICAO
-- RESULTADO PACIENTE DIA
UNION ALL
SELECT RES.CTS_RES_RESU_TIPO TIPO,
       RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL NIVEL,
       RTRIM(UPPER(RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI)) DESCRICAO,
       RES.CTS_RES_RESU_CAD_CTS_CD_CONTA CONTA,
       'RESULTADO PACIENTE DIA' DIARIAS,
       DECODE(SUM(RES.CTS_RES_RESU_VL_PACIENTES_DIA),
              0,
              0,
              ((SUM(RES.CTS_RES_RESU_VL_REC_DIRETA) +
              SUM(RES.CTS_RES_RESU_VL_REC_INDIRETA) +
              SUM(RES.CTS_RES_RESU_VL_REC_INTERMEDI)) -
              (SUM(RES.CTS_RES_RESU_VL_DESP_DIRETA) +
              SUM(RES.CTS_RES_RESU_VL_DESP_INDIRETA) +
              SUM(RES.CTS_RES_RESU_VL_DESP_INTERMEDI))) /
              SUM(RES.CTS_RES_RESU_VL_PACIENTES_DIA)) VALOR,
       NULL                           PERCENTUAL,
       RES.CTS_RES_RESU_COD_DESCRICAO,
       16                             CODIGO_DIARIA
  FROM TB_CTS_RES_RESUMO_GERAL RES
WHERE RES.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
   AND RES.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
   AND RES.CTS_RES_RESU_TIPO = 'R'
   AND RES.CTS_RES_RESU_CAD_CTS_CD_CONTA != 1
GROUP BY RES.CTS_RES_RESU_TIPO,
          RES.CTS_RES_RESU_CAD_CTS_CD_NIVEL,
          RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI,
          CTS_RES_RESU_CAD_CTS_CD_CONTA,
          RES.CTS_RES_RESU_COD_DESCRICAO
ORDER BY DESCRICAO
) LOOP
--BEGIN
  INSERT INTO TB_CTS_ANALISE_GERENCIAL_COMP1 CTS_R (CTS_R.DESCRICAO, CTS_R.DIARIA, CTS_R.CONTA, CTS_R.MES, CTS_R.ANO, CTS_R.VALOR_MES, CTS_R.PERCENTUAL_MES, CTS_R.CTS_RES_RESU_COD_DESCRICAO, CTS_R.CTS_RES_RESU_COD_DIARIA)
  VALUES (C1.DESCRICAO, C1.DIARIAS, C1.CONTA, pCTS_RES_RESU_MES, pCTS_RES_RESU_ANO, C1.VALOR, C1.PERCENTUAL, C1.CTS_RES_RESU_COD_DESCRICAO, C1.CODIGO_DIARIA);
  COMMIT;
--END;
END LOOP;
END PRC_CTS_REL_16_COMP1;
/
