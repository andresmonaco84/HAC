CREATE OR REPLACE PROCEDURE "PRC_CAD_REL_05_PROF"
  (
  pCAD_UNI_ID_UNIDADE IN TB_CAD_UNI_UNIDADE.CAD_UNI_ID_UNIDADE%TYPE DEFAULT NULL,
  pCAD_LAT_ID_LOCAL_ATENDIMENTO IN TB_CAD_LAT_LOCAL_ATENDIMENTO.CAD_LAT_ID_LOCAL_ATENDIMENTO%TYPE DEFAULT NULL,
  pCAD_PRO_ID_PROFISSIONAL IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_ID_PROFISSIONAL%TYPE DEFAULT NULL,
  pTIS_CBO_CD_CBOS IN TB_TIS_CBO_CBOS.TIS_CBO_CD_CBOS%TYPE DEFAULT NULL,
  pDT_INICIAL IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_DT_CADASTRO%TYPE DEFAULT NULL,
  PDT_FINAL IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_DT_CADASTRO%TYPE DEFAULT NULL,
  pTIS_CPR_CD_CONSELHOPROF IN TB_CAD_PRO_PROFISSIONAL.TIS_CPR_CD_CONSELHOPROF%TYPE DEFAULT NULL,
 -- pCAD_PRO_FL_ATIVO_OK IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_FL_ATIVO_OK%TYPE DEFAULT NULL,
        io_cursor OUT PKG_CURSOR.t_cursor
  )
  is
  /********************************************************************
  *    Procedure: PRC_CAD_REL_05_PROF
  *
  *    Data Criacao:      Por: Pedro
  *    Data Alteracao:  11/02/2015 Por: Pedro
  *
  *
  *    Funcao: alimentar o rel de cadastro de prof
  *
  *******************************************************************/
  v_cursor PKG_CURSOR.t_cursor;
  begin
    OPEN v_cursor FOR
 SELECT PRO.CAD_PRO_NM_NOME ,
       TRIM(PRO.TIS_CPR_CD_CONSELHOPROF) TIS_CPR_CD_CONSELHOPROF,
       PRO.CAD_PRO_NR_CONSELHO ,
       PES.CAD_PES_NR_RG,
       DECODE(PES.CAD_PES_NR_CNPJ_CPF, 0, NULL, PES.CAD_PES_NR_CNPJ_CPF) CAD_PES_NR_CNPJ_CPF,
       CBOS.TIS_CBO_DS_CBOS_HAC,
       PRO.CAD_PRO_FL_ATIVO_OK,
       PRO.CAD_PRO_DT_CADASTRO,
       USU.SEG_USU_ID_USUARIO,
       USU.SEG_USU_DS_NOME,
       PEM.ASS_PEM_NM_FUNCAO,
       PEM.ASS_PEM_NM_EMAIL,
       PRO.CAD_PES_ID_PESSOA
   FROM TB_CAD_PRO_PROFISSIONAL      PRO
  JOIN TB_CAD_PES_PESSOA            PES ON PES.CAD_PES_ID_PESSOA = PRO.CAD_PES_ID_PESSOA
  JOIN TB_ASS_PCB_PROFISSIONAL_CBOS ASS ON ASS.CAD_PRO_ID_PROFISSIONAL = PRO.CAD_PRO_ID_PROFISSIONAL
  JOIN TB_TIS_CBO_CBOS              CBOS ON CBOS.TIS_CBO_CD_CBOS = ASS.TIS_CBO_CD_CBOS
  JOIN TB_SEG_USU_USUARIO           USU ON USU.SEG_USU_ID_USUARIO = PRO.SEG_USU_ID_USUARIO
  LEFT JOIN TB_ASS_PEM_PESSOA_EMAIL    PEM ON PEM.CAD_PES_ID_PESSOA = PRO.CAD_PES_ID_PESSOA     
 WHERE (PRO.CAD_PRO_FL_ATIVO_OK = 'S')
   AND (pDT_INICIAL IS NULL OR PRO.CAD_PRO_DT_CADASTRO >= pDT_INICIAL)
   AND (PDT_FINAL IS NULL OR PRO.CAD_PRO_DT_CADASTRO <= PDT_FINAL)
   AND (pTIS_CBO_CD_CBOS IS NULL OR CBOS.TIS_CBO_CD_CBOS = pTIS_CBO_CD_CBOS)
   AND (pCAD_PRO_ID_PROFISSIONAL IS NULL OR PRO.CAD_PRO_ID_PROFISSIONAL = pCAD_PRO_ID_PROFISSIONAL)
   AND (TRIM(pTIS_CPR_CD_CONSELHOPROF) IS NULL OR TRIM(PRO.TIS_CPR_CD_CONSELHOPROF) = TRIM(pTIS_CPR_CD_CONSELHOPROF))
 ORDER BY PRO.CAD_PRO_NM_NOME
        ;
    io_cursor := v_cursor;
  end PRC_CAD_REL_05_PROF;
