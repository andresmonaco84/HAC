create or replace procedure PRC_ASS_CCP_CONV_CLIN_PROCED_S
  (
     pASS_CCP_ID IN TB_ASS_CCP_CONV_CLINICA_PROCED.ASS_CCP_ID%type DEFAULT NULL,
     pCAD_CNV_ID_CONVENIO IN TB_ASS_CCP_CONV_CLINICA_PROCED.CAD_CNV_ID_CONVENIO%TYPE DEFAULT NULL,
     pCAD_CLC_ID IN TB_ASS_CCP_CONV_CLINICA_PROCED.CAD_CLC_ID%TYPE DEFAULT NULL,
     pAUX_EEP_CD_ESPECPROCED IN TB_ASS_CCP_CONV_CLINICA_PROCED.AUX_EEP_CD_ESPECPROCED%TYPE DEFAULT NULL,
     pAUX_GPC_CD_GRUPOPROCED IN TB_ASS_CCP_CONV_CLINICA_PROCED.AUX_GPC_CD_GRUPOPROCED%TYPE DEFAULT NULL,
     pCAD_PRD_CD_CODIGO IN TB_ASS_CCP_CONV_CLINICA_PROCED.CAD_PRD_CD_CODIGO%TYPE DEFAULT NULL,
     pTIS_MED_CD_TABELAMEDICA IN TB_TIS_MED_TABELAMEDICA.TIS_MED_CD_TABELAMEDICA%TYPE DEFAULT NULL,
     io_cursor OUT PKG_CURSOR.t_cursor
  )
  is
  /********************************************************************
  *    Procedure: PRC_ASS_CCP_CONV_CLIN_PROCED_S
  *
  *    Data Criacao:  25/01/2008   Por: Fabiola Lopes
  *    Data Alteracao: 23/05/2008  Por: Andrea Cazuca
  *    Alteracao:   Incluido o group by
  *
  *    Data Alteracao:  04/02/2009  Por Andrea Cazuca
  *    Alteracao:  Incluido o campo TIS_MED_CD_TABELAMEDICA
  *
  *    Funcao: Listar as associacoes de convenio x clinca x procedimento
  *
  *******************************************************************/
  v_cursor PKG_CURSOR.t_cursor;
  begin
    OPEN v_cursor FOR
    SELECT
       CCP.ASS_CCP_ID,
       CCP.CAD_CNV_ID_CONVENIO,
       CCP.AUX_EEP_CD_ESPECPROCED,
       CCP.AUX_GPC_CD_GRUPOPROCED,
       CCP.CAD_PRD_CD_CODIGO,
       CCP.CAD_CLC_ID,
       CCP.ASS_CCP_DT_ULTIMA_ATUALIZACAO,
       CCP.SEG_USU_ID_USUARIO,
       CCP.ASS_CCP_FL_STATUS,
       PRD.CAD_PRD_DS_DESCRICAO,
       CCP.TIS_MED_CD_TABELAMEDICA,
       CLC.CAD_CLC_DS_RESUMIDA,
       EPP.AUX_EPP_DS_DESCRICAO,
       GRP.AUX_GPC_DS_DESCRICAO,
       TAB.TIS_MED_DS_TABELAMEDICA
       
    FROM
         TB_ASS_CCP_CONV_CLINICA_PROCED CCP,
         TB_CAD_PRD_PRODUTO PRD,
         TB_CAD_CLC_CLINICA_CREDENCIADA CLC,
         TB_AUX_EPP_ESPECPROC EPP,
         TB_AUX_GPC_GRUPOPROC GRP,
         TB_TIS_MED_TABELAMEDICA TAB
    WHERE
         (pASS_CCP_ID IS NULL OR CCP.ASS_CCP_ID = pASS_CCP_ID)
     AND (CCP.CAD_PRD_CD_CODIGO = PRD.CAD_PRD_CD_CODIGO(+))
     AND (CCP.CAD_CLC_ID = CLC.CAD_CLC_ID (+))
     AND (CCP.AUX_EEP_CD_ESPECPROCED = EPP.AUX_EPP_CD_ESPECPROC (+))
     AND (GRP.AUX_EPP_CD_ESPECPROC = EPP.AUX_EPP_CD_ESPECPROC)
     AND (CCP.AUX_GPC_CD_GRUPOPROCED = GRP.AUX_GPC_CD_GRUPOPROC (+))
     AND (CCP.TIS_MED_CD_TABELAMEDICA = TAB.TIS_MED_CD_TABELAMEDICA (+))
     
     AND (pCAD_CNV_ID_CONVENIO IS NULL OR CCP.CAD_CNV_ID_CONVENIO = pCAD_CNV_ID_CONVENIO)
     AND (pCAD_CLC_ID IS NULL OR CCP.CAD_CLC_ID = pCAD_CLC_ID)
     AND (pAUX_EEP_CD_ESPECPROCED IS NULL OR CCP.AUX_EEP_CD_ESPECPROCED = pAUX_EEP_CD_ESPECPROCED)
     AND (pAUX_GPC_CD_GRUPOPROCED IS NULL OR CCP.AUX_GPC_CD_GRUPOPROCED = pAUX_GPC_CD_GRUPOPROCED)
     AND (pCAD_PRD_CD_CODIGO IS NULL OR CCP.CAD_PRD_CD_CODIGO = pCAD_PRD_CD_CODIGO)
     AND (pTIS_MED_CD_TABELAMEDICA IS NULL OR CCP.TIS_MED_CD_TABELAMEDICA = pTIS_MED_CD_TABELAMEDICA)
    GROUP BY CCP.ASS_CCP_ID,
       CCP.CAD_CNV_ID_CONVENIO,
       CCP.AUX_EEP_CD_ESPECPROCED,
       CCP.AUX_GPC_CD_GRUPOPROCED,
       CCP.CAD_PRD_CD_CODIGO,
       CCP.CAD_CLC_ID,
       CCP.ASS_CCP_DT_ULTIMA_ATUALIZACAO,
       CCP.SEG_USU_ID_USUARIO,
       CCP.ASS_CCP_FL_STATUS,
       PRD.CAD_PRD_DS_DESCRICAO,
       CCP.TIS_MED_CD_TABELAMEDICA,
       CLC.CAD_CLC_DS_RESUMIDA,
       EPP.AUX_EPP_DS_DESCRICAO,
       GRP.AUX_GPC_DS_DESCRICAO,
       TAB.TIS_MED_DS_TABELAMEDICA 
       ;
    io_cursor := v_cursor;
  end PRC_ASS_CCP_CONV_CLIN_PROCED_S;
/
