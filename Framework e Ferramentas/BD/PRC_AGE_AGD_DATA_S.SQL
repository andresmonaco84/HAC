CREATE OR REPLACE PROCEDURE PRC_AGE_AGD_DATA_S
(
  pAGE_ESM_ID IN TB_AGE_AGD_AGENDA.AGE_ESM_ID%TYPE,
  pAGE_AGD_DT_AGENDA IN TB_AGE_AGD_AGENDA.AGE_AGD_DT_AGENDA%TYPE,
  io_cursor OUT PKG_CURSOR.t_cursor
)
 IS
  v_cursor PKG_CURSOR.t_cursor;
BEGIN
 OPEN V_CURSOR FOR 
 SELECT 
 AGD.AGE_AGD_ID                     
, AGD.AGE_AGD_DT_AGENDA              
, AGD.AGE_AGD_HR_AGENDA              
, AGD.AGE_AGD_TP_AGENDA              
, AGD.AGE_AGD_CD_AMBESP              
, AGD.AGE_AGD_CD_AMBGRP              
, AGD.AGE_AGD_CD_AMBSEQ              
, AGD.AGE_AGD_CD_AMBTP               
, AGD.AGE_AGD_DT_ATENDIMENTO         
, AGD.AGE_AGD_HR_ATENDIMENTO         
, AGD.AGE_AGD_FL_STATUS              
, AGD.AGE_AGD_DS_OBSERVACAO          
, AGD.SEG_USU_ID_USUARIO             
, AGD.AGE_AGD_DT_ULTIMA_ATUALIZACAO
, AGD.AGE_AGD_CD_INTAMB              
, AGD.AGE_AGD_IN_INTAMB              
, AGD.AGE_ESM_ID                     
, AGD.CAD_PAC_ID_PACIENTE            
, AGD.CAD_PRO_ID_PROFISSIONALEXEC    
, AGD.CAD_PRO_ID_PROFISSIONALSOLIC   
, AGD.AGE_AGD_DT_LIMITE_RETORNO      
, AGD.AGE_AGG_ID                     
, AGD.CAD_PRD_ID                     
, AGD.SEG_USU_ID_DESBLOQUEIO         
, AGD.SEG_USU_ID_AGENENCESP   
, PES.CAD_PES_NM_PESSOA
, PES.CAD_PES_ID_PESSOA,
  AGD.age_agd_fl_confirma_status,
  AGD.age_agd_fl_confirma_tipo,
  AGD.age_agd_ds_confirma_obs,
  AGD.seg_usu_id_confirma,
  AGD.age_agd_dt_confirma
 FROM TB_AGE_AGD_AGENDA AGD
 INNER JOIN TB_CAD_PAC_PACIENTE PAC
       ON AGD.CAD_PAC_ID_PACIENTE = PAC.CAD_PAC_ID_PACIENTE
 INNER JOIN TB_CAD_PES_PESSOA PES
       ON PAC.CAD_PES_ID_PESSOA  = PES.CAD_PES_ID_PESSOA 
WHERE AGD.AGE_ESM_ID = pAGE_ESM_ID AND AGD.AGE_AGD_DT_ATENDIMENTO = pAGE_AGD_DT_AGENDA
  AND AGD.AGE_AGD_FL_STATUS != 'C';

io_cursor := v_cursor;
END PRC_AGE_AGD_DATA_S;

