CREATE OR REPLACE PROCEDURE "PRC_CTS_ATUALIZA_TOTAL_DIARIAS"
(pCTS_RES_RESU_MES IN TB_CTS_RES_RESULTADO_CUSTOS.CTS_RES_MES%TYPE,
 pCTS_RES_RESU_ANO IN TB_CTS_RES_RESULTADO_CUSTOS.CTS_RES_ANO%TYPE) 
IS
  /********************************************************************
  *
  *    PROCEDURE: PRC_CTS_ATUALIZA_TOTAL_DIARIAS
  *    DATA: 11/11/2014             POR: Fabiola
  *
  *********************************************************************/
  --ATUALIZA TOTAL DIARIAS DE UTI = UTI ADULTO + PEDIATRICA + NEONATAL + CARDIOLOGICA
BEGIN
  DECLARE
    CURSOR ATU IS
      SELECT SUM(CTS.CTS_RES_RESU_VL_PACIENTES_DIA) QUANTIDADE,
             '110004' CONTA
        FROM TB_CTS_RES_RESUMO_GERAL CTS
       WHERE CTS.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
         AND CTS.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
         AND CTS.CTS_RES_RESU_CAD_CTS_CD_CONTA IN
             ('1100040001', '1100040002', '1100040003', '1100040004');
  BEGIN
    FOR A IN ATU LOOP
      UPDATE TB_CTS_RES_RESUMO_GERAL CTS
         SET CTS.CTS_RES_RESU_VL_PACIENTES_DIA = A.QUANTIDADE
       WHERE CTS.CTS_RES_RESU_CAD_CTS_CD_CONTA = A.CONTA
         AND CTS.CTS_RES_RESU_TIPO = 'R'
         AND CTS.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
         AND CTS.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO;
    END LOOP;
  END;
  COMMIT;

  -- ATUALIZA TOTAL RECEITA PACIENTE EXTERNO = AMBULATORIO + EXTERNINHO + PRONTO SOCORRO E PRONTO ATENDIMENTO
  DECLARE
    CURSOR ATU IS
      SELECT SUM(CTS.CTS_RES_RESU_VL_PACIENTES_DIA) QUANTIDADE,
             '180' CONTA
        FROM TB_CTS_RES_RESUMO_GERAL CTS
       WHERE CTS.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
         AND CTS.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
         AND CTS.CTS_RES_RESU_CAD_CTS_CD_CONTA IN
             ('180001', '180002', '180003');
  BEGIN
    FOR A IN ATU LOOP
      UPDATE TB_CTS_RES_RESUMO_GERAL CTS
         SET CTS.CTS_RES_RESU_VL_PACIENTES_DIA = A.QUANTIDADE
       WHERE CTS.CTS_RES_RESU_CAD_CTS_CD_CONTA = A.CONTA
         AND CTS.CTS_RES_RESU_TIPO = 'R'
         AND CTS.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
         AND CTS.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO;
    END LOOP;
  END;
  COMMIT;

  -- ATUALIZA TOTAL DE DIARIAS = DIARIAS DE UTI, APARTAMENTO, ENFERMARIA, BERCARIO, HOSPITAL DAY, HOME CARE E PACOTE
  DECLARE
    CURSOR ATU IS
      SELECT SUM(CTS.CTS_RES_RESU_VL_PACIENTES_DIA) QUANTIDADE,
             '110' CONTA
        FROM TB_CTS_RES_RESUMO_GERAL CTS
       WHERE CTS.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
         AND CTS.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
         AND CTS.CTS_RES_RESU_CAD_CTS_CD_CONTA IN
             ('110004',
              '110001',
              '110002',
              '110003',
              '110005',
              '110006',
              '110007');
  BEGIN
    FOR A IN ATU LOOP
      UPDATE TB_CTS_RES_RESUMO_GERAL CTS
         SET CTS.CTS_RES_RESU_VL_PACIENTES_DIA = A.QUANTIDADE
       WHERE CTS.CTS_RES_RESU_CAD_CTS_CD_CONTA = A.CONTA
         AND CTS.CTS_RES_RESU_TIPO = 'R'
         AND CTS.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
         AND CTS.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO;
    END LOOP;
  END;
  COMMIT;

END PRC_CTS_ATUALIZA_TOTAL_DIARIAS;
/
