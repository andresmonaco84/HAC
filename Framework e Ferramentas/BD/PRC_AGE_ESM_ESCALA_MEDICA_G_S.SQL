CREATE OR REPLACE PROCEDURE "PRC_AGE_ESM_ESCALA_MEDICA_G_S"
  (
     pAGE_ESM_ID IN TB_AGE_ESM_ESCALA_MEDICA.AGE_ESM_ID%type DEFAULT NULL,
     pCAD_UNI_ID_UNIDADE IN TB_AGE_ESM_ESCALA_MEDICA.CAD_UNI_ID_UNIDADE%type DEFAULT NULL,
     pCAD_LAT_ID_LOCAL_ATENDIMENTO IN TB_AGE_ESM_ESCALA_MEDICA.CAD_LAT_ID_LOCAL_ATENDIMENTO%type DEFAULT NULL,
     pTIS_CBO_CD_CBOS IN TB_AGE_ESM_ESCALA_MEDICA.TIS_CBO_CD_CBOS%type DEFAULT NULL,
     pCAD_PRO_ID_PROFISSIONAL IN TB_AGE_ESM_ESCALA_MEDICA.CAD_PRO_ID_PROFISSIONAL%type DEFAULT NULL,
     pAGE_ESM_FL_SITUACAO IN TB_AGE_ESM_ESCALA_MEDICA.AGE_ESM_FL_SITUACAO%type DEFAULT NULL,
     io_cursor OUT PKG_CURSOR.t_cursor
  )
  is
  /********************************************************************
  *    Procedure: PRC_AGE_ESM_ESCALA_MEDICA_S
  *
  *******************************************************************/
  v_cursor PKG_CURSOR.t_cursor;
  begin
    OPEN v_cursor FOR
    SELECT
       ESM.AGE_ESM_ID,
       ESM.AGE_SAU_ID,
       ESM.AGE_ESM_DT_INI_ESCALA,
       ESM.AGE_ESM_HR_INI_ESCALA,
       ESM.AGE_ESM_DT_FIM_ESCALA,
       ESM.AGE_ESM_HR_FIM_ESCALA,
       ESM.AGE_ESM_NR_DIA_SEMANA,
       ESM.AGE_ESM_FL_SITUACAO,
       ESM.AGE_ESM_QT_DIAS_CRIACAO,
       ESM.AGE_ESM_QT_AGE_PERM_PHORA,
       ESM.AGE_ESM_FL_PERM_ENCAIXE,
       ESM.AGE_ESM_FL_PERM_ENCAIXE_ESP,
       ESM.AGE_ESM_FL_PERM_RETORNO,
       ESM.AGE_ESM_DT_CRIACAO_ESCALA,
       ESM.AGE_ESM_QT_ENCAIXE,
       ESM.AGE_ESM_QT_ENCAIXE_PHORA,
       ESM.AGE_ESM_QT_ENCAIXE_ESP,
       ESM.AGE_ESM_QT_ENCAIXE_ESP_PHORA,
       ESM.AGE_ESM_DS_OBS,
       ESM.SEG_USU_ID_USUARIO,
       ESM.AGE_ESM_DT_ULTIMA_ATUALIZACAO,
       ESM.AGE_ESM_FL_TRANSF,
       ESM.TIS_CBO_CD_CBOS,
       ESM.CAD_PRO_ID_PROFISSIONAL,
       ESM.CAD_UNI_ID_UNIDADE,
       ESM.CAD_LAT_ID_LOCAL_ATENDIMENTO,
       ESM.AGE_PEE_ID,
       ESM.AGE_ESM_QT_RET_PERM_PHORA,
       ESM.AGE_ESM_FL_PERM_AGENDA_SP,
       ESM.AGE_ESM_QT_AGE_PERM_PHORA_SP,
       ESM.AGE_ESM_QT_DIAS_INTERVALO,
       ESM.AGE_ESM_FL_AGENDAGERADA_OK,
       ESM.AGE_ESM_DT_PROXIMA_DATA,
       ESM.AGE_ESM_ENDER_ATEND_ESCALA,
       ESM.AGE_ESM_TP_ESCALA,
       ESM.AGE_ESM_FL_PERM_TELEMEDICINA,
       ESM.AGE_ESM_QT_TELEMEDICINA_PHORA,
       ESM.AGE_ESM_QT_BLOQUEIO_PHORA,
       ESM.AGE_ESM_FL_AGEND_GRUPO
       
    FROM TB_AGE_ESM_ESCALA_MEDICA ESM
    WHERE
        (pAGE_ESM_ID is null OR ESM.AGE_ESM_ID = pAGE_ESM_ID)
        AND ESM.AGE_ESM_FL_AGENDAGERADA_OK = 'S'
        AND ((trunc(ESM.AGE_ESM_DT_FIM_ESCALA) >= trunc(SYSDATE)) OR (ESM.AGE_ESM_DT_FIM_ESCALA IS NULL))
        AND ((pCAD_UNI_ID_UNIDADE is null) OR (ESM.CAD_UNI_ID_UNIDADE = pCAD_UNI_ID_UNIDADE))
        AND ((pCAD_LAT_ID_LOCAL_ATENDIMENTO is null) OR (ESM.CAD_LAT_ID_LOCAL_ATENDIMENTO = pCAD_LAT_ID_LOCAL_ATENDIMENTO))
        AND ((pTIS_CBO_CD_CBOS is null) OR (ESM.TIS_CBO_CD_CBOS = pTIS_CBO_CD_CBOS))
        AND ((pCAD_PRO_ID_PROFISSIONAL is null) OR (ESM.CAD_PRO_ID_PROFISSIONAL = pCAD_PRO_ID_PROFISSIONAL))
        AND ((pAGE_ESM_FL_SITUACAO is null) OR (ESM.AGE_ESM_FL_SITUACAO = pAGE_ESM_FL_SITUACAO))
        order by ESM.AGE_ESM_DT_INI_ESCALA;
    io_cursor := v_cursor;
  end PRC_AGE_ESM_ESCALA_MEDICA_G_S;
