CREATE OR REPLACE PROCEDURE PRC_ASS_RPG_REG_REGRA_FIN
(
  pCAD_REP_DT_FIM_VIGENCIA       IN TB_ASS_RPG_REGRA_PAGTO.CAD_REP_DT_FIM_VIGENCIA%TYPE,
  pCAD_CLC_ID                    IN TB_ASS_CPR_CLINICA_PROF.CAD_CLC_ID%TYPE,
  pCAD_PRO_ID_PROFISSIONAL       IN TB_ASS_CPR_CLINICA_PROF.CAD_PRO_ID_PROFISSIONAL%TYPE,
  pCAD_REP_DT_ULTIMA_ATUALIZACAO IN TB_ASS_RPG_REGRA_PAGTO.CAD_REP_DT_ULTIMA_ATUALIZACAO%TYPE,
  pSEG_USU_ID_USUARIO            IN TB_ASS_RPG_REGRA_PAGTO.SEG_USU_ID_USUARIO%TYPE,
  pASS_CPR_ID                    IN TB_ASS_RPG_REGRA_PAGTO.ASS_CPR_ID%TYPE
) IS

BEGIN
  UPDATE (SELECT RPG.*
            FROM TB_ASS_RPG_REGRA_PAGTO RPG
           INNER JOIN TB_ASS_CPR_CLINICA_PROF CPR
              ON CPR.ASS_CPR_ID = RPG.ASS_CPR_ID
           WHERE CPR.CAD_CLC_ID = pCAD_CLC_ID
             AND CPR.CAD_PRO_ID_PROFISSIONAL = pCAD_PRO_ID_PROFISSIONAL
             AND RPG.CAD_REP_DT_FIM_VIGENCIA IS NULL
             AND RPG.ASS_CPR_ID = pASS_CPR_ID) RPG
     SET RPG.CAD_REP_DT_FIM_VIGENCIA       = pCAD_REP_DT_FIM_VIGENCIA,
         RPG.CAD_REP_DT_ULTIMA_ATUALIZACAO = pCAD_REP_DT_ULTIMA_ATUALIZACAO,
         RPG.SEG_USU_ID_USUARIO            = pSEG_USU_ID_USUARIO;
END PRC_ASS_RPG_REG_REGRA_FIN;
/
