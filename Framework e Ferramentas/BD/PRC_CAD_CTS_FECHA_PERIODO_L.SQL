CREATE OR REPLACE PROCEDURE PRC_CAD_CTS_FECHA_PERIODO_L(PCAD_CTS_MES_FECHAMENTO        IN TB_CAD_CTS_FECHA_PERIODO.CAD_CTS_MES_FECHAMENTO%TYPE DEFAULT NULL,
                                                        PCAD_CTS_ANO_FECHAMENTO        IN TB_CAD_CTS_FECHA_PERIODO.CAD_CTS_ANO_FECHAMENTO%TYPE DEFAULT NULL,
                                                        PCAD_CTS_STATUS                IN TB_CAD_CTS_FECHA_PERIODO.CAD_CTS_STATUS%TYPE DEFAULT NULL,
                                                        PCAD_CTS_DT_ULTIMA_ATUALIZACAO IN TB_CAD_CTS_FECHA_PERIODO.CAD_CTS_DT_ULTIMA_ATUALIZACAO%TYPE DEFAULT NULL,
                                                        PSEG_USU_ID_USUARIO            IN TB_CAD_CTS_FECHA_PERIODO.SEG_USU_ID_USUARIO%TYPE DEFAULT NULL,
                                                        IO_CURSOR                      OUT PKG_CURSOR.T_CURSOR) IS
  /********************************************************************
  *    PROCEDURE: PRC_CAD_CTS_FECHA_PERIODO_L
  * 
  *    DATA CRIACAO:  DATA DA  CRIAÇÃO   POR: NOME DO ANALISTA
  *    DATA ALTERACAO:  DATA DA ALTERAÇÃO  POR: NOME DO ANALISTA
  *
  *    FUNCAO: DESCRIÇÃO DA FUNCIONALIDADE DA STORED PROCEDURE
  *
  *******************************************************************/
  V_CURSOR PKG_CURSOR.T_CURSOR;
  V_WHERE  VARCHAR2(5000);
  V_SELECT VARCHAR2(5000);
BEGIN
  V_WHERE := NULL;
  IF PCAD_CTS_MES_FECHAMENTO IS NOT NULL THEN
    V_WHERE := V_WHERE || ' AND CAD_CTS_MES_FECHAMENTO = ' ||
               PCAD_CTS_MES_FECHAMENTO;
  END IF;
  IF PCAD_CTS_ANO_FECHAMENTO IS NOT NULL THEN
    V_WHERE := V_WHERE || ' AND CAD_CTS_ANO_FECHAMENTO = ' ||
               PCAD_CTS_ANO_FECHAMENTO;
  END IF;
  IF PCAD_CTS_STATUS IS NOT NULL THEN
    V_WHERE := V_WHERE || ' AND CAD_CTS_STATUS = ' || CHR(39) ||
               PCAD_CTS_STATUS || CHR(39);
  END IF;
  IF PCAD_CTS_DT_ULTIMA_ATUALIZACAO IS NOT NULL THEN
    V_WHERE := V_WHERE || ' AND CAD_CTS_DT_ULTIMA_ATUALIZACAO = ' ||
               CHR(39) || PCAD_CTS_DT_ULTIMA_ATUALIZACAO || CHR(39);
  END IF;
  IF PSEG_USU_ID_USUARIO IS NOT NULL THEN
    V_WHERE := V_WHERE || ' AND SEG_USU_ID_USUARIO = ' ||
               PSEG_USU_ID_USUARIO;
  END IF;

  V_SELECT := '
SELECT	
       CAD_CTS_MES_FECHAMENTO,
       CAD_CTS_ANO_FECHAMENTO,
       CAD_CTS_STATUS,
       CAD_CTS_DT_ULTIMA_ATUALIZACAO,
       SEG_USU_ID_USUARIO
FROM TB_CAD_CTS_FECHA_PERIODO
WHERE NULL IS NULL  ';

  OPEN V_CURSOR FOR V_SELECT || V_WHERE;
  IO_CURSOR := V_CURSOR;
END PRC_CAD_CTS_FECHA_PERIODO_L;
