create or replace procedure PRC_AUX_EPP_ESPECPROC_ULP_S
  (
     pAUX_EPP_CD_ESPECPROC IN TB_AUX_EPP_ESPECPROC.AUX_EPP_CD_ESPECPROC%type DEFAULT NULL,
     pAUX_EPP_DS_DESCRICAO IN TB_AUX_EPP_ESPECPROC.AUX_EPP_DS_DESCRICAO%type DEFAULT NULL,
     pCAD_UNI_ID_UNIDADE IN TB_ASS_ULP_UNID_LOCAL_PROCED.CAD_UNI_ID_UNIDADE%type DEFAULT NULL,
     pCAD_LAT_ID_LOCAL_ATENDIMENTO IN TB_ASS_ULP_UNID_LOCAL_PROCED.CAD_LAT_ID_LOCAL_ATENDIMENTO%type DEFAULT NULL,
     pCAD_SET_ID IN TB_ASS_ULP_UNID_LOCAL_PROCED.CAD_SET_ID%type DEFAULT NULL,
     pAGE_SAU_ID IN TB_ASS_ULP_UNID_LOCAL_PROCED.AGE_SAU_ID%type DEFAULT NULL,
     pAUX_EPP_FL_ATENDSADT IN TB_AUX_EPP_ESPECPROC.AUX_EPP_FL_ATENDSADT%type DEFAULT NULL,
     pTIS_MED_CD_TABELAMEDICA IN TB_AUX_EPP_ESPECPROC.TIS_MED_CD_TABELAMEDICA%type DEFAULT NULL,
     io_cursor OUT PKG_CURSOR.t_cursor
  )
  is
  /********************************************************************
  *    Procedure: PRC_AUX_EPP_ESPECPROC_ULP_S
  *
  *    Data Criacao:     17/06/2008         Por: Davi Silvestre
  *    Data Alteracao:   data da alteragco  Por: Nome do Analista
  *
  *    Funcao: Listar as Especialidades cadastradas, associadas
  *            a uma determinada combinacao Unidade x Local x Setor
  *
  *    Data Alteração: 22/03/2010    Por: Davi Silvestre M. dos Reis
  *    Alteracao: Inclusao dos campos AUX_EPP_FL_ATENDSADT e TIS_MED_CD_TABELAMEDICA
  *
   *    Data Alteracao:   30/03/2010  Por: PEDRO
  *     Alteracao:     AUX_EPP_FL_ATENDSADT   e TIS_MED_CD_TABELAMEDICA no Select
  *******************************************************************/
  v_cursor PKG_CURSOR.t_cursor;
  begin
    OPEN v_cursor FOR
    SELECT DISTINCT
           EPP.AUX_EPP_CD_ESPECPROC,
           EPP.AUX_EPP_DS_DESCRICAO,
           EPP.AUX_EPP_FL_ATENDSADT,
           EPP.TIS_MED_CD_TABELAMEDICA
      FROM 
           TB_AUX_EPP_ESPECPROC EPP
     INNER JOIN TB_ASS_ULP_UNID_LOCAL_PROCED ULP
        ON EPP.AUX_EPP_CD_ESPECPROC = ULP.AUX_EPP_CD_ESPECPROCED
        and epp.tis_med_cd_tabelamedica = ULP.TIS_MED_CD_TABELAMEDICA
     WHERE
           (pAUX_EPP_CD_ESPECPROC IS NULL OR AUX_EPP_CD_ESPECPROC = pAUX_EPP_CD_ESPECPROC)
       AND (pAUX_EPP_DS_DESCRICAO IS NULL OR AUX_EPP_DS_DESCRICAO LIKE UPPER(pAUX_EPP_DS_DESCRICAO))
       AND (pCAD_UNI_ID_UNIDADE IS NULL OR CAD_UNI_ID_UNIDADE = pCAD_UNI_ID_UNIDADE)
       AND (pCAD_LAT_ID_LOCAL_ATENDIMENTO IS NULL OR CAD_LAT_ID_LOCAL_ATENDIMENTO = pCAD_LAT_ID_LOCAL_ATENDIMENTO)
       AND (pCAD_SET_ID IS NULL OR CAD_SET_ID = pCAD_SET_ID)
       AND (pAGE_SAU_ID IS NULL OR AGE_SAU_ID = pAGE_SAU_ID)
       AND (pAUX_EPP_FL_ATENDSADT IS NULL OR AUX_EPP_FL_ATENDSADT = pAUX_EPP_FL_ATENDSADT)
       AND (pTIS_MED_CD_TABELAMEDICA IS NULL OR EPP.TIS_MED_CD_TABELAMEDICA = pTIS_MED_CD_TABELAMEDICA);
       
  io_cursor := v_cursor;
    
  end PRC_AUX_EPP_ESPECPROC_ULP_S;
/