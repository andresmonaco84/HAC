create or replace procedure PRC_ATS_RETORNA_PROCEDENCIA_S
  (
     pCAD_UNI_CD_UNID_HOSPITALAR IN TB_CAD_UNI_UNIDADE.CAD_UNI_CD_UNID_HOSPITALAR%TYPE DEFAULT NULL,
     pCAD_LAT_ID_LOCAL_ATENDIMENTO IN TB_CAD_SET_SETOR.CAD_LAT_ID_LOCAL_ATENDIMENTO%TYPE DEFAULT NULL,
     pCAD_SET_ID                   IN TB_CAD_SET_SETOR.CAD_SET_ID%TYPE DEFAULT NULL,
     io_cursor OUT PKG_CURSOR.t_cursor
  )
  is
  /********************************************************************
  *    Procedure: PRC_ATS_RETORNA_PROCEDENCIA_S
  *
  *    Data Criacao:   03/10/2008   Por: Fabíola Lopes
  *    Funcao: Retorna a Procedência
  *
  *******************************************************************/
  v_cursor PKG_CURSOR.t_cursor;
  begin
    OPEN v_cursor FOR

   SELECT SETOR.CAD_SET_ID, SETOR.CAD_SET_DS_PROCEDENCIA
     FROM TB_CAD_SET_SETOR SETOR, TB_CAD_UNI_UNIDADE UNI
    WHERE SETOR.CAD_UNI_ID_UNIDADE = UNI.CAD_UNI_ID_UNIDADE
      AND (PCAD_UNI_CD_UNID_HOSPITALAR IS NULL OR UNI.CAD_UNI_CD_UNID_HOSPITALAR = PCAD_UNI_CD_UNID_HOSPITALAR)
      AND (PCAD_LAT_ID_LOCAL_ATENDIMENTO IS NULL OR SETOR.CAD_LAT_ID_LOCAL_ATENDIMENTO = PCAD_LAT_ID_LOCAL_ATENDIMENTO)
      AND SETOR.CAD_SET_DS_PROCEDENCIA IS NOT NULL
      AND (pCAD_SET_ID IS NULL OR SETOR.CAD_SET_ID = pCAD_SET_ID)
    ORDER BY 1;
    
   io_cursor := v_cursor;
  end PRC_ATS_RETORNA_PROCEDENCIA_S;