create or replace procedure PRC_INT_PAC_CNV_PLA_MD5_S
  (
     pASS_PMD_CD_MD5_ATUAL IN TB_ASS_PMD_PESSOA_MD5.ASS_PMD_CD_MD5%type DEFAULT NULL,
     io_cursor OUT PKG_CURSOR.t_cursor
  )
  is
  /********************************************************************
  *    Procedure: PRC_INT_PAC_CNV_PLA_MD5_S
  *
  *    Data Criacao:   data da  criac?o   Por: Nome do Analista
  *    Data Alteracao:  data da alterac?o  Por: Nome do Analista
  *
  *    Funcao: Descric?o da funcionalidade da Stored Procedure
  *
  *******************************************************************/
  v_cursor PKG_CURSOR.t_cursor;
  begin
    OPEN v_cursor FOR
    SELECT DISTINCT
       PAC.CAD_PAC_ID_PACIENTE,
       PAC.CAD_CNV_ID_CONVENIO,
       PAC.CAD_PLA_ID_PLANO,
       PAC.CAD_PAC_CD_CREDENCIAL CREDENCIAL,
       PAC.CAD_EMP_ID_EMPRESA,
       PAC.CAD_PAC_NR_PRONTUARIO CODPAC,
       PAC.CAD_PAC_NM_TITULAR,
       PAC.CAD_PAC_DT_VALIDADECREDENCIAL,
       PAC.CAD_PAC_CD_CNS,
       PAC.CAD_PAC_DS_OBSERVACAO,
       PAC.CAD_PAC_FL_VIP_OK,
       PAC.CAD_PAC_CD_CODCIP,
       PAC.CAD_PAC_CD_CODBEN,
       PAC.CAD_PAC_CD_CODBENSEQ,
       PAC.SEG_USU_ID_USUARIO,
       PAC.CAD_PAC_DT_ULTIMA_ATUALIZACAO,
       PAC.CAD_PES_ID_PESSOA,
       PAC.CAD_PAC_CD_SUBPLANO,
       PAC.CAD_PAC_TP_SANGUINEO,
       PAC.AUX_PRF_CD_CODIGO,
       PAC.AUX_NAC_CD_CODIGO,
       PAC.CAD_PAC_FL_DOADORORGAOS_OK,
       PAC.CAD_PAC_FL_ATIVO_OK,
       PAC.CAD_PAC_CD_AUTORIZADOR,
       
       CNV.CAD_CNV_CD_HAC_PRESTADOR CODCON,
       PLA.CAD_PLA_CD_PLANO CODPLA,
       MD5.ASS_PMD_CD_MD5,

       PES.CAD_PES_NR_CNPJ_CPF CPFBEN,
       PES.CAD_PES_NR_RG RGBEN,
       PES.CAD_PES_NM_PESSOA NOMBEN,
       PES.CAD_PES_CD_ESTADOCIVIL,
       PES.CAD_PES_DT_NASCIMENTO,
       PES.CAD_PES_NM_PESSOA,
       PES.CAD_PES_TP_SEXO,
       PES.CAD_PES_NM_NOMEMAE,
       PES.CAD_PES_CD_ORGAOEMISSORRG,
       PES.CAD_PES_DT_EXPEDICAORG,
       PES.CAD_PES_TP_SANGUINEO,
       PES.AUX_PRF_CD_CODIGO,
       PES.AUX_NAC_CD_CODIGO,
       PES.CAD_PES_FL_DOADORORGAOS_OK,
       PES.CAD_PES_NM_NATURALIDADE,
       PES.AUX_ESC_CD_CODIGO,
       PES.CAD_PES_NM_NOMEPAI,
       PES.CAD_PES_NM_CONJUGE,
       CASE PES.CAD_PES_CD_ESTADOCIVIL
      WHEN '1' THEN 'SOLTEIRO'
      WHEN '2' THEN 'CASADO'
      WHEN '3' THEN 'SEPARADO'
      WHEN '4' THEN 'DIVORCIADO'
      WHEN '5' THEN 'VIUVO'
      WHEN '6' THEN 'UNIAO ESTAVEL'
      ELSE ''
    END ESTCIVBEN,
    PES.CAD_PES_FL_ATIVO_OK

  FROM TB_ASS_PMD_PESSOA_MD5 MD5
  INNER JOIN TB_CAD_PES_PESSOA     PES
        ON MD5.ASS_PMD_CD_MD5 = pASS_PMD_CD_MD5_ATUAL
       AND PES.CAD_PES_ID_PESSOA = MD5.CAD_PES_ID_PESSOA

  INNER JOIN TB_CAD_PAC_PACIENTE   PAC
        ON  PAC.CAD_PES_ID_PESSOA = PES.CAD_PES_ID_PESSOA

  INNER JOIN TB_CAD_CNV_CONVENIO   CNV
        ON CNV.CAD_CNV_ID_CONVENIO = PAC.CAD_CNV_ID_CONVENIO

  INNER JOIN TB_CAD_PLA_PLANO      PLA
        ON PLA.CAD_PLA_ID_PLANO = PAC.CAD_PLA_ID_PLANO
       AND PLA.CAD_CNV_ID_CONVENIO = PAC.CAD_CNV_ID_CONVENIO;

    io_cursor := v_cursor;
  end PRC_INT_PAC_CNV_PLA_MD5_S;
 