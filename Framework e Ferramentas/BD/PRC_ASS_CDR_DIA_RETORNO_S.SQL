CREATE OR REPLACE PROCEDURE "PRC_ASS_CDR_DIA_RETORNO_S"
  (
     pASS_CDR_ID_DIA_RETORNO IN TB_ASS_CDR_DIA_RETORNO.ASS_CDR_ID_DIA_RETORNO%type DEFAULT NULL,
     pCAD_CNV_ID_CONVENIO IN TB_CAD_CNV_CONVENIO.CAD_CNV_ID_CONVENIO%type DEFAULT NULL,
     io_cursor OUT PKG_CURSOR.t_cursor
  )
  is
  /********************************************************************
  *    Procedure: PRC_ASS_CDR_DIA_RETORNO_S
  *
  *    Data Criacao: 	data da  criac?o   Por: Nome do Analista
  *    Data Alteracao:	data da alterac?o  Por: Nome do Analista
  *
  *    Funcao: Descric?o da funcionalidade da Stored Procedure
  *
  *******************************************************************/
  v_cursor PKG_CURSOR.t_cursor;
  begin

    OPEN v_cursor FOR
    SELECT
       CDR.ASS_CDR_ID_DIA_RETORNO,
       CDR.ASS_CDR_FL_ESPECIALIDADE_OK,
       CDR.ASS_CDR_FL_UNIDADE_OK,
       CDR.ASS_CDR_FL_PROFISSIONAL_OK,
       CDR.ASS_CDR_QT_DIAS,
       CDR.ASS_CUL_ID,
       LAT.CAD_LAT_DS_LOCAL_ATENDIMENTO,
       PES.CAD_PES_NM_PESSOA,  --Nome fantasia da Unidade
       CDR.TIS_CBO_CD_CBOS,
       CBO.TIS_CBO_DS_CBOS_HAC
    FROM TB_ASS_CDR_DIA_RETORNO CDR,
         TB_CAD_CNV_CONVENIO    CNV,
         TB_ASS_CNU_CONVENIO_UNIDADE CNU,
         TB_ASS_CUL_CONV_UNI_LOCATEND CUL,
         TB_CAD_LAT_LOCAL_ATENDIMENTO LAT,
         TB_CAD_UNI_UNIDADE UNI,
         TB_CAD_PES_PESSOA PES,
         TB_TIS_CBO_CBOS CBO
    WHERE CNU.CAD_CNV_ID_CONVENIO = CNV.CAD_CNV_ID_CONVENIO
    AND   CUL.ASS_CNU_ID          = CNU.ASS_CNU_ID
    AND   CDR.ASS_CUL_ID          = CUL.ASS_CUL_ID
    AND   CNU.CAD_UNI_ID_UNIDADE  = UNI.CAD_UNI_ID_UNIDADE
    AND   UNI.CAD_PES_ID_PESSOA   = PES.CAD_PES_ID_PESSOA
    AND   CUL.CAD_LAT_ID_LOCAL_ATENDIMENTO = LAT.CAD_LAT_ID_LOCAL_ATENDIMENTO
    AND   (pASS_CDR_ID_DIA_RETORNO is null OR CDR.ASS_CDR_ID_DIA_RETORNO = pASS_CDR_ID_DIA_RETORNO)
    AND   (pCAD_CNV_ID_CONVENIO is null OR CNV.CAD_CNV_ID_CONVENIO = pCAD_CNV_ID_CONVENIO)
    AND   CBO.TIS_CBO_CD_CBOS(+) = CDR.TIS_CBO_CD_CBOS;
    /*
    SELECT
       DIA.ASS_CDR_ID_DIA_RETORNO,
       DIA.ASS_CDR_FL_ESPECIALIDADE_OK,
       DIA.ASS_CDR_FL_UNIDADE_OK,
       DIA.ASS_CDR_FL_PROFISSIONAL_OK,
       DIA.ASS_CDR_QT_DIAS,
       DIA.ASS_CDR_DT_ULTIMA_ATUALIZACAO,
       DIA.SEG_USU_ID_USUARIO,
       DIA.ASS_CUL_ID
    FROM TB_ASS_CDR_DIA_RETORNO DIA,
         TB_CAD_CNV_CONVENIO    CNV,
         TB_ASS_CNU_CONVENIO_UNIDADE UNI,
         TB_ASS_CUL_CONV_UNI_LOCATEND LOC
    WHERE UNI.CAD_CNV_ID_CONVENIO = CNV.CAD_CNV_ID_CONVENIO
    AND   LOC.ASS_CNU_ID          = UNI.ASS_CNU_ID
    AND   DIA.ASS_CUL_ID          = LOC.ASS_CUL_ID
    AND   (pASS_CDR_ID_DIA_RETORNO is null OR DIA.ASS_CDR_ID_DIA_RETORNO = pASS_CDR_ID_DIA_RETORNO)
    AND   (pCAD_CNV_ID_CONVENIO is null OR CNV.CAD_CNV_ID_CONVENIO = pCAD_CNV_ID_CONVENIO);
    */
    io_cursor := v_cursor;
  end PRC_ASS_CDR_DIA_RETORNO_S;
 
