CREATE OR REPLACE PROCEDURE PRC_CTS_RES_CAD_ATU_CODIGO
(
  pCTS_RES_RESU_MES IN TB_CTS_RES_RESUMO_GERAL.CTS_RES_RESU_MES%TYPE,
  pCTS_RES_RESU_ANO IN TB_CTS_RES_RESUMO_GERAL.CTS_RES_RESU_ANO%TYPE
) 
IS
BEGIN
  DECLARE
    V_CONTADOR  NUMBER;
    V_CONTA_ANT VARCHAR2(40);
  BEGIN
    V_CONTADOR := 0;
    FOR I IN (SELECT RES.CTS_RES_RESU_CAD_CTS_CD_CONTA
                FROM TB_CTS_RES_RESUMO_GERAL RES
               WHERE RES.CTS_RES_RESU_TIPO = 'R'
                 AND RES.CTS_RES_RESU_CAD_CTS_CD_CONTA != 1
                 AND RES.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
                 AND RES.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
               ORDER BY RES.CTS_RES_RESU_CAD_CTS_DS_DESCRI) LOOP
      IF (I.CTS_RES_RESU_CAD_CTS_CD_CONTA != V_CONTA_ANT) OR (V_CONTA_ANT IS NULL) THEN
        V_CONTADOR := V_CONTADOR + 1;
      END IF;
      UPDATE TB_CTS_RES_RESUMO_GERAL RES
         SET RES.CTS_RES_RESU_COD_DESCRICAO = V_CONTADOR
       WHERE RES.CTS_RES_RESU_TIPO = 'R'
         AND RES.CTS_RES_RESU_CAD_CTS_CD_CONTA != 1
         AND RES.CTS_RES_RESU_MES = pCTS_RES_RESU_MES
         AND RES.CTS_RES_RESU_ANO = pCTS_RES_RESU_ANO
         AND RES.CTS_RES_RESU_CAD_CTS_CD_CONTA = I.CTS_RES_RESU_CAD_CTS_CD_CONTA;
      V_CONTA_ANT := I.CTS_RES_RESU_CAD_CTS_CD_CONTA;
    END LOOP;
  END;
END PRC_CTS_RES_CAD_ATU_CODIGO;
/
