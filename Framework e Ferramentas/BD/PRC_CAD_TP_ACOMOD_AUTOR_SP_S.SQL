create or replace procedure PRC_CAD_TP_ACOMOD_AUTOR_SP_S
(
  pCAD_CNV_ID_CONVENIO          IN TB_ASS_CNU_CONVENIO_UNIDADE.CAD_CNV_ID_CONVENIO%TYPE,
  pCAD_PLA_ID_PLANO             IN TB_ASS_CTP_CNV_UN_TPACOM_PLA.CAD_PLA_ID_PLANO%TYPE,
  pCAD_UNI_ID_UNIDADE           IN TB_ASS_UTA_UNID_TPACOMOD.CAD_UNI_ID_UNIDADE%TYPE,
  io_cursor                     OUT PKG_CURSOR.t_cursor
)
  is
  /********************************************************************
  *    Procedure: PRC_CAD_TP_ACOMOD_AUTOR_SP_S
  *
  *    Data Criacao:   23/05/2011          Por: Fabiola Lopes
  *    Data Alteracao:                     Por:
  *
  *    Funcao: Listar os Tipo de Acomodacoes permitidas para convenio/plano do paciente
  *
  *******************************************************************/
  v_cursor PKG_CURSOR.t_cursor;
BEGIN
  OPEN V_CURSOR FOR
  SELECT TAC.TIS_TAC_CD_TIPO_ACOMODACAO, TAC.TIS_TAC_DS_TIPO_ACOMODACAO
    FROM TB_ASS_CUT_CONV_UNI_TPACOMOD CUT,
         TB_ASS_CTP_CNV_UN_TPACOM_PLA CTP,
         TB_ASS_UTA_UNID_TPACOMOD     UTA,
         TB_ASS_CNU_CONVENIO_UNIDADE  CNU,
         TB_TIS_TAC_TIPO_ACOMODACAO   TAC
   WHERE TAC.TIS_TAC_CD_TIPO_ACOMODACAO = UTA.TIS_TAC_CD_TIPO_ACOMODACAO
     AND CUT.ASS_CUT_ID = CTP.ASS_CUT_ID
     AND (TRUNC(CTP.ASS_CTP_DT_INI_VIGENCIA) <= TRUNC(SYSDATE) 
     AND (CTP.ASS_CTP_DT_FIM_VIGENCIA IS NULL OR TRUNC(CTP.ASS_CTP_DT_FIM_VIGENCIA) >= TRUNC(SYSDATE)))
     AND UTA.ASS_UTA_ID_UNID_TPACOMOD = CUT.ASS_UTA_ID_UNID_TPACOMOD
     AND CUT.ASS_CNU_ID = CNU.ASS_CNU_ID
     AND (TRUNC(CNU.ASS_CNU_DT_INI_VIGENCIA) <= TRUNC(SYSDATE) 
     AND (CNU.ASS_CNU_DT_FIM_VIGENCIA IS NULL OR TRUNC(CNU.ASS_CNU_DT_FIM_VIGENCIA) >= TRUNC(SYSDATE)))
     AND (TRUNC(CUT.ASS_CUT_DT_INI_VIGENCIA) <= TRUNC(SYSDATE) 
     AND (CUT.ASS_CUT_DT_FIM_VIGENCIA IS NULL OR TRUNC(CUT.ASS_CUT_DT_FIM_VIGENCIA) >= TRUNC(SYSDATE)))
     AND CNU.CAD_CNV_ID_CONVENIO = pCAD_CNV_ID_CONVENIO
     AND CTP.CAD_PLA_ID_PLANO = pCAD_PLA_ID_PLANO
     AND UTA.CAD_UNI_ID_UNIDADE = pCAD_UNI_ID_UNIDADE
     AND UTA.ASS_UTA_FL_ATIVO_OK = 'S'     
     AND EXISTS
     (SELECT QLE.TIS_TAC_CD_TIPO_ACOMODACAO 
        FROM TB_CAD_QLE_QUARTO_LEITO QLE,
             TB_CAD_SET_SETOR SETOR
       WHERE QLE.CAD_SET_ID = SETOR.CAD_SET_ID
         AND SETOR.CAD_UNI_ID_UNIDADE = UTA.CAD_UNI_ID_UNIDADE
         AND QLE.TIS_TAC_CD_TIPO_ACOMODACAO = TAC.TIS_TAC_CD_TIPO_ACOMODACAO);
  IO_CURSOR := V_CURSOR;
END PRC_CAD_TP_ACOMOD_AUTOR_SP_S;