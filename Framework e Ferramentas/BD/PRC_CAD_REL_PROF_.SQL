create or replace procedure PRC_CAD_REL_PROF
  (
     pCAD_UNI_ID_UNIDADE IN TB_CAD_UNI_UNIDADE.CAD_UNI_ID_UNIDADE%type DEFAULT NULL,
     pCAD_LAT_ID_LOCAL_ATENDIMENTO IN TB_CAD_LAT_LOCAL_ATENDIMENTO.CAD_LAT_ID_LOCAL_ATENDIMENTO%type DEFAULT NULL,
     pTIS_CBO_CD_CBOS IN TB_TIS_CBO_CBOS.TIS_CBO_CD_CBOS%type DEFAULT NULL,
     pCAD_PRO_ID_PROFISSIONAL IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_ID_PROFISSIONAL%TYPE DEFAULT NULL,
     pCAD_PRO_FL_ATIVO_OK IN TB_CAD_PRO_PROFISSIONAL.CAD_PRO_FL_ATIVO_OK%type DEFAULT NULL,
     pTIS_CPR_CD_CONSELHOPROF IN TB_CAD_PRO_PROFISSIONAL.TIS_CPR_CD_CONSELHOPROF%type DEFAULT NULL,
     io_cursor OUT PKG_CURSOR.t_cursor
  )
  is
  /********************************************************************
  *    Procedure: PRC_CAD_REL_PROF
  *
  *    Data Criacao:   09/02/2009   Por: Pedro
  *    Funcao: Alimentar o Rel. de Profissionais,
  *
  *******************************************************************/
  v_cursor PKG_CURSOR.t_cursor;
  begin
    OPEN v_cursor FOR
  SELECT DISTINCT
   PES_PRO.CAD_PES_NM_PESSOA NM_PRO,
PRO.CAD_PRO_NR_CONSELHO,
PES_UNI.CAD_PES_NM_PESSOA UNIDADE,
LAT.CAD_LAT_DS_LOCAL_ATENDIMENTO,
CBOS.TIS_CBO_DS_CBOS_HAC,

PRO.CAD_PRO_SG_UF_CONSELHO

 FROM TB_AGE_ESM_ESCALA_MEDICA ESM

INNER JOIN TB_CAD_PRO_PROFISSIONAL PRO
ON PRO.CAD_PRO_ID_PROFISSIONAL = ESM.CAD_PRO_ID_PROFISSIONAL

INNER JOIN TB_CAD_PES_PESSOA PES_PRO
ON PES_PRO.CAD_PES_ID_PESSOA = PRO.CAD_PES_ID_PESSOA

INNER JOIN TB_CAD_UNI_UNIDADE UNI
ON UNI.CAD_UNI_ID_UNIDADE = ESM.CAD_UNI_ID_UNIDADE

INNER JOIN TB_CAD_PES_PESSOA PES_UNI
ON PES_UNI.CAD_PES_ID_PESSOA = UNI.CAD_PES_ID_PESSOA

INNER JOIN TB_CAD_LAT_LOCAL_ATENDIMENTO LAT
ON LAT.CAD_LAT_ID_LOCAL_ATENDIMENTO = ESM.CAD_LAT_ID_LOCAL_ATENDIMENTO

INNER JOIN TB_TIS_CBO_CBOS CBOS
ON CBOS.TIS_CBO_CD_CBOS = ESM.TIS_CBO_CD_CBOS


WHERE            
            
      PRO.CAD_PRO_FL_ATIVO_OK = 'S'    
    AND   ESM.AGE_ESM_ENDER_ATEND_ESCALA IS NULL
    AND   ESM.AGE_ESM_FL_SITUACAO = 'A'
    AND   UNI.CAD_UNI_FL_STATUS = 'A'
    AND   LAT.CAD_LAT_FL_ATIVO_OK = 'S'          
    AND   (pCAD_UNI_ID_UNIDADE is null OR ESM.CAD_UNI_ID_UNIDADE = pCAD_UNI_ID_UNIDADE)
    AND   (pCAD_LAT_ID_LOCAL_ATENDIMENTO is null OR ESM.CAD_LAT_ID_LOCAL_ATENDIMENTO = pCAD_LAT_ID_LOCAL_ATENDIMENTO)
    AND   (pTIS_CBO_CD_CBOS is null OR ESM.TIS_CBO_CD_CBOS = pTIS_CBO_CD_CBOS)
    AND   (pCAD_PRO_ID_PROFISSIONAL is null OR PRO.CAD_PRO_ID_PROFISSIONAL = pCAD_PRO_ID_PROFISSIONAL)
    AND   (pCAD_PRO_FL_ATIVO_OK is null OR PRO.CAD_PRO_FL_ATIVO_OK = pCAD_PRO_FL_ATIVO_OK)
    AND   (pTIS_CPR_CD_CONSELHOPROF is null OR PRO.TIS_CPR_CD_CONSELHOPROF = pTIS_CPR_CD_CONSELHOPROF)
;

    io_cursor := v_cursor;
  end PRC_CAD_REL_PROF;
/
